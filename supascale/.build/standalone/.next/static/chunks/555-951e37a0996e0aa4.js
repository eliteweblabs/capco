"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{1275:(e,t,a)=>{a.d(t,{d:()=>p,t:()=>m});var s=a(95155),r=a(12115),n=a(42529),o=a(6132),l=a(52056),i=a(23327),d=a(65229),c=a(64269);let u=(0,r.createContext)(void 0);function m(e){let{children:t}=e,[a,n]=(0,r.useState)([]),o=(0,r.useCallback)(e=>{var t;let a=Math.random().toString(36).slice(2,11);return n(t=>[...t,{...e,id:a}]),setTimeout(()=>{n(e=>e.filter(e=>e.id!==a))},null!=(t=e.duration)?t:e.action?1e4:5e3),a},[]),l=(0,r.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]);return(0,s.jsxs)(u.Provider,{value:{toasts:a,addToast:o,removeToast:l},children:[t,(0,s.jsx)(h,{toasts:a,onRemove:l})]})}function p(){let e=(0,r.useContext)(u);if(!e)throw Error("useToast must be used within a ToastProvider");return{toast:e.addToast,success:(t,a)=>e.addToast({type:"success",title:t,description:a}),error:(t,a)=>e.addToast({type:"error",title:t,description:a}),warning:(t,a)=>e.addToast({type:"warning",title:t,description:a}),info:(t,a)=>e.addToast({type:"info",title:t,description:a})}}function h(e){let{toasts:t,onRemove:a}=e;return(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-[100] flex flex-col gap-2 max-w-sm w-full",children:t.map(e=>(0,s.jsx)(g,{toast:e,onRemove:a},e.id))})}let x={success:n.A,error:o.A,warning:l.A,info:i.A},f={success:"text-success",error:"text-error",warning:"text-warning",info:"text-info"};function g(e){let{toast:t,onRemove:a}=e,r=x[t.type];return(0,s.jsxs)("div",{className:(0,c.cn)("flex items-start gap-3 p-4 rounded-lg shadow-lg border","bg-background-elevated border-border","animate-in slide-in-from-right-full"),role:"alert",children:[(0,s.jsx)(r,{className:(0,c.cn)("h-5 w-5 flex-shrink-0 mt-0.5",f[t.type])}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:t.title}),t.description&&(0,s.jsx)("p",{className:"text-sm text-foreground-secondary mt-1",children:t.description}),t.action&&(0,s.jsx)("button",{onClick:()=>{var e;null==(e=t.action)||e.onClick(),a(t.id)},className:"mt-2 text-sm font-medium text-brand hover:text-brand/80 transition-colors",children:t.action.label})]}),(0,s.jsxs)("button",{onClick:()=>a(t.id),className:"flex-shrink-0 text-foreground-muted hover:text-foreground transition-colors",children:[(0,s.jsx)(d.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Dismiss"})]})]})}},3998:(e,t,a)=>{a.d(t,{Button:()=>l});var s=a(95155),r=a(12115),n=a(64269),o=a(35299);let l=(0,r.forwardRef)((e,t)=>{let{className:a,variant:r="primary",size:l="md",loading:i,disabled:d,children:c,...u}=e;return(0,s.jsxs)("button",{ref:t,className:(0,n.cn)("\n      inline-flex items-center justify-center font-medium\n      transition-all duration-150 focus-visible:outline-none focus-visible:ring-1\n      focus-visible:ring-brand focus-visible:ring-offset-1\n      disabled:pointer-events-none disabled:opacity-50\n      rounded-lg\n    ",{primary:"\n        bg-brand text-white hover:bg-brand/90\n        border border-brand-secondary\n        shadow-xs active:shadow-none active:bg-brand-secondary\n      ",secondary:"\n        bg-background-tertiary text-foreground\n        border border-border hover:border-border-hover\n        hover:bg-background-elevated shadow-xs\n        active:shadow-none\n      ",ghost:"\n        text-foreground-secondary hover:text-foreground\n        hover:bg-background-tertiary\n        border border-transparent\n        active:bg-background-secondary\n      ",destructive:"\n        bg-error text-white hover:bg-error/90\n        border border-red-700\n        shadow-xs active:shadow-none active:bg-red-700\n      ",outline:"\n        border border-brand text-brand\n        hover:bg-brand/10\n        active:bg-brand/20\n      "}[r],{sm:"h-8 px-3 text-sm gap-1.5",md:"h-10 px-4 text-sm gap-2",lg:"h-12 px-6 text-base gap-2",icon:"h-10 w-10"}[l],a),disabled:d||i,...u,children:[i&&(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),c]})});l.displayName="Button"},18653:(e,t,a)=>{a.d(t,{y:()=>n});var s=a(95155),r=a(64269);function n(e){let{size:t="md",className:a}=e;return(0,s.jsx)("div",{className:(0,r.cn)("animate-spin rounded-full border-2 border-current border-t-transparent text-brand",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[t],a),children:(0,s.jsx)("span",{className:"sr-only",children:"Loading..."})})}},64269:(e,t,a)=>{a.d(t,{Ye:()=>c,Yq:()=>d,cn:()=>n,fw:()=>l,mo:()=>i,z3:()=>o});var s=a(2821),r=a(75889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}let o=function(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(2))," ").concat(["B","KB","MB","GB","TB"][t])};function l(e){let t=new Date,a=new Date(e),s=Math.floor((t.getTime()-a.getTime())/1e3);return s<60?"just now":s<3600?"".concat(Math.floor(s/60),"m ago"):s<86400?"".concat(Math.floor(s/3600),"h ago"):s<604800?"".concat(Math.floor(s/86400),"d ago"):a.toLocaleDateString()}function i(e){let t,a=new Date,s=new Date(e),r=s.getTime()-a.getTime(),n=Math.abs(Math.floor(r/1e3));if(n<60)t="less than a minute";else if(n<3600){let e=Math.floor(n/60);t="".concat(e," minute").concat(e>1?"s":"")}else if(n<86400){let e=Math.floor(n/3600);t="".concat(e," hour").concat(e>1?"s":"")}else{if(!(n<604800))return s.toLocaleDateString();let e=Math.floor(n/86400);t="".concat(e," day").concat(e>1?"s":"")}return r>0?"in ".concat(t):"".concat(t," ago")}function d(e){return new Date(e).toLocaleString()}function c(e){return e.toLowerCase().replace(/[^a-z0-9_-]/g,"-").replace(/^[^a-z0-9]/,"").replace(/-+/g,"-").slice(0,50)}},80555:(e,t,a)=>{a.d(t,{L:()=>d,x:()=>i});var s=a(95155),r=a(12115),n=a(1275),o=a(85160);let l=(0,r.createContext)(void 0);function i(){let e=(0,r.useContext)(l);if(!e)throw Error("useUpdate must be used within UpdateProvider");return e}function d(e){let{children:t}=e,a=(0,n.d)(),[i,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(!1),[h,x]=(0,r.useState)(!1),[f,g]=(0,r.useState)(0),[b,v]=(0,r.useState)(!1),[w,j]=(0,r.useState)(!1),[y,N]=(0,r.useState)(null),k=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];u(!0),N(null);try{let t=await fetch("/api/v1/system/updates?force=".concat(e)),a=await t.json();if(a.success)return d(a.data),a.data;N(a.error||"Failed to check for updates")}catch(e){console.error("Failed to check for updates:",e),N("Unable to reach update server")}finally{u(!1)}return null},[]),E=(0,r.useCallback)(async()=>{p(!0),g(0),x(!1);try{let e=await fetch("/api/v1/system/updates/download",{method:"POST"}),t=await e.json();if(!t.success)throw Error(t.error||"Download failed");g(100),a.success("Download Complete","Update downloaded successfully. Ready to install."),await k()}catch(t){let e=t instanceof Error?t.message:"Failed to download update";throw a.error("Download Failed",e),t}finally{p(!1)}},[a,k]),C=(0,r.useCallback)(async()=>{x(!0);try{let e=await fetch("/api/v1/system/updates/apply",{method:"POST"}),t=await e.json();if(!t.success)throw Error(t.error||"Failed to apply update")}catch(t){let e=t instanceof Error?t.message:"Failed to apply update";throw a.error("Update Failed",e),x(!1),t}},[a]),T=(0,r.useCallback)(async()=>{if(null==i?void 0:i.latestVersion)try{await fetch("/api/v1/system/updates",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({version:i.latestVersion})}),d(e=>e?{...e,dismissed:!0}:null)}catch(e){console.error("Failed to dismiss update:",e)}},[i]),D=(0,r.useCallback)(()=>{x(!1),v(!0)},[]),S=(0,r.useCallback)(()=>{x(!1)},[]);return(0,r.useEffect)(()=>{k()},[k]),(0,r.useEffect)(()=>{if((null==i?void 0:i.updateAvailable)&&!i.dismissed&&!w){j(!0);let e=setTimeout(()=>{a.toast({type:"info",title:"Update Available",description:"Version ".concat(i.latestVersion," is available"),duration:15e3,action:{label:"View Update",onClick:()=>v(!0)}})},2e3);return()=>clearTimeout(e)}},[i,w,a]),(0,s.jsxs)(l.Provider,{value:{updateInfo:i,isChecking:c,isDownloading:m,isApplying:h,downloadProgress:f,checkError:y,checkForUpdates:k,downloadUpdate:E,applyUpdate:C,dismissUpdate:T,showUpdateDialog:D},children:[t,(0,s.jsx)(o.s,{open:b,onOpenChange:v,updateInfo:i,isDownloading:m,isApplying:h,downloadProgress:f,onDownload:E,onApply:C,onDismiss:T,onError:S})]})}},85160:(e,t,a)=>{a.d(t,{s:()=>f});var s=a(95155),r=a(12115),n=a(3998),o=a(18653),l=a(42529),i=a(52056),d=a(48314),c=a(68695),u=a(65229),m=a(39867),p=a(85921),h=a(89559);let x={idle:"Ready to install",preparing:"Preparing update...",backing_up:"Backing up your data...",stopping:"Stopping application...",extracting:"Extracting new version...",restoring:"Restoring your data...",restarting:"Starting application...",complete:"Update complete!",error:"Update failed",rolling_back:"Rolling back to previous version...",rolled_back:"Rollback complete"};function f(e){var t;let{open:a,onOpenChange:f,updateInfo:g,isDownloading:b,isApplying:v,downloadProgress:w,onDownload:j,onApply:y,onDismiss:N,onError:k}=e,[E,C]=(0,r.useState)("info"),[T,D]=(0,r.useState)(null),[S,A]=(0,r.useState)(null),[U,B]=(0,r.useState)(null),[M,F]=(0,r.useState)(5),[L,_]=(0,r.useState)(0);(0,r.useEffect)(()=>{a&&"applying"!==E&&"complete"!==E&&(fetch("/api/v1/system/updates/status",{method:"DELETE"}).catch(()=>{}),D(null),A(null),_(0),"error"===E&&C("info"))},[a]);let z=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/v1/system/updates/status");if(e.ok){let t=await e.json();if(t.success&&t.data){let e=t.data;_(t=>{let a=Math.max(t,e.progress),s=["complete","error","rolled_back"].includes(e.status);return(e.progress>=t||s)&&(A(e),"complete"===e.status?(C("complete"),setTimeout(()=>{fetch("/api/v1/system/updates/status",{method:"DELETE"})},5e3)):"error"===e.status?(C("error"),D(e.message),null==k||k()):"rolled_back"===e.status&&(C("error"),D("Update failed and was rolled back to the previous version."),null==k||k())),a})}}}catch(e){A(e=>e||{status:"restarting",message:"Waiting for server...",progress:0,timestamp:new Date().toISOString()})}},[k]);if((0,r.useEffect)(()=>{if("applying"!==E||U)"applying"!==E&&U&&(clearInterval(U),B(null));else{z();let e=setInterval(z,1e3);return B(e),()=>{clearInterval(e),B(null)}}},[E,U,z]),(0,r.useEffect)(()=>()=>{U&&clearInterval(U)},[U]),(0,r.useEffect)(()=>{if("complete"===E&&M>0){let e=setTimeout(()=>{F(e=>e-1)},1e3);return()=>clearTimeout(e)}},[E,M]),!a||!g)return null;let R=async()=>{C("downloading"),D(null);try{await j(),C("ready")}catch(e){D(e instanceof Error?e.message:"Download failed"),C("info")}},P=async()=>{C("applying"),D(null),A(null),_(0);try{await fetch("/api/v1/system/updates/status",{method:"DELETE"})}catch(e){}try{await y()}catch(e){D(e instanceof Error?e.message:"Update failed"),C("ready")}},V=()=>{b||"applying"===E||(("error"===E||"complete"===E)&&fetch("/api/v1/system/updates/status",{method:"DELETE"}).catch(()=>{}),C("info"),D(null),A(null),_(0),f(!1))},I=async()=>{await N(),V()},O=async()=>{try{await fetch("/api/v1/system/updates/status",{method:"DELETE"})}catch(e){}C("info"),D(null),A(null),_(0)};return(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:"applying"!==E?V:void 0}),(0,s.jsxs)("div",{className:"relative bg-background-secondary border border-border rounded-lg shadow-xl max-w-lg w-full mx-4 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-full bg-brand/10",children:(0,s.jsx)(c.A,{className:"h-5 w-5 text-brand"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold",children:"complete"===E?"Update Complete":"error"===E?"Update Failed":"Update Available"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-muted",children:["v",g.currentVersion," â†’ v",g.latestVersion]})]})]}),"applying"!==E&&(0,s.jsx)("button",{onClick:V,className:"p-1 rounded hover:bg-background-tertiary transition-colors",children:(0,s.jsx)(u.A,{className:"h-5 w-5 text-foreground-muted"})})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[T&&"applying"!==E&&"error"!==E&&(0,s.jsxs)("div",{className:"p-3 bg-error/10 border border-error/20 rounded-lg flex items-start gap-2",children:[(0,s.jsx)(i.A,{className:"h-5 w-5 text-error shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-error",children:"Update Error"}),(0,s.jsx)("p",{className:"text-sm text-foreground-muted",children:T})]})]}),"info"===E&&(0,s.jsxs)(s.Fragment,{children:[g.releaseNotes&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-2",children:"What's New"}),(0,s.jsx)("div",{className:"p-3 bg-background-tertiary rounded-lg text-sm max-h-40 overflow-auto whitespace-pre-wrap",children:g.releaseNotes})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-foreground-muted",children:[(0,s.jsxs)("span",{children:["Download size: ",(t=g.size)?"".concat((t/1048576).toFixed(1)," MB"):"Unknown size"]}),g.releaseDate&&(0,s.jsxs)("span",{children:["Released: ",new Date(g.releaseDate).toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"p-3 bg-warning/10 border border-warning/20 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(i.A,{className:"h-4 w-4 text-warning mt-0.5 shrink-0"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-warning",children:"Before updating"}),(0,s.jsx)("p",{className:"text-foreground-muted mt-1",children:"The application will restart during the update. Your data (database, backups, configuration) will be preserved."})]})]})})]}),"downloading"===E&&(0,s.jsxs)("div",{className:"py-8 text-center",children:[(0,s.jsx)(o.y,{size:"lg",className:"mx-auto mb-4"}),(0,s.jsx)("p",{className:"font-medium",children:"Downloading update..."}),(0,s.jsxs)("p",{className:"text-sm text-foreground-muted mt-1",children:[w,"% complete"]}),(0,s.jsx)("div",{className:"mt-4 h-2 bg-background-tertiary rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-brand transition-all duration-300",style:{width:"".concat(w,"%")}})})]}),"ready"===E&&(0,s.jsxs)("div",{className:"py-4 text-center",children:[(0,s.jsx)("div",{className:"p-3 rounded-full bg-success/10 w-fit mx-auto mb-4",children:(0,s.jsx)(l.A,{className:"h-8 w-8 text-success"})}),(0,s.jsx)("p",{className:"font-medium",children:"Download Complete"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-muted mt-1",children:["Ready to install v",g.latestVersion]}),(0,s.jsx)("p",{className:"text-xs text-foreground-muted mt-4",children:"The application will restart automatically after the update is applied."})]}),"applying"===E&&(0,s.jsxs)("div",{className:"py-6 text-center",children:[(0,s.jsx)("div",{className:"mb-4 flex justify-center",children:(()=>{if(!S)return(0,s.jsx)(o.y,{size:"lg"});switch(S.status){case"complete":return(0,s.jsx)(l.A,{className:"h-10 w-10 text-success"});case"error":case"rolled_back":return(0,s.jsx)(i.A,{className:"h-10 w-10 text-error"});case"rolling_back":return(0,s.jsx)(d.A,{className:"h-10 w-10 text-warning animate-spin"});default:return(0,s.jsx)(o.y,{size:"lg"})}})()}),(0,s.jsx)("p",{className:"font-medium",children:(null==S?void 0:S.status)?x[S.status]||S.message:"Starting update..."}),(null==S?void 0:S.message)&&"complete"!==S.status&&(0,s.jsx)("p",{className:"text-sm text-foreground-muted mt-1",children:S.message}),(0,s.jsx)("div",{className:"mt-4 h-2 bg-background-tertiary rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-brand transition-all duration-500",style:{width:"".concat(L,"%")}})}),(0,s.jsxs)("p",{className:"text-xs text-foreground-muted mt-2",children:[L,"% complete"]}),(0,s.jsx)("p",{className:"text-xs text-foreground-muted mt-4",children:"Do not close this window. The application will restart shortly."})]}),"complete"===E&&(0,s.jsxs)("div",{className:"py-6 text-center",children:[(0,s.jsx)("div",{className:"p-3 rounded-full bg-success/10 w-fit mx-auto mb-4",children:(0,s.jsx)(l.A,{className:"h-10 w-10 text-success"})}),(0,s.jsx)("p",{className:"font-medium text-lg",children:"Update Complete!"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-muted mt-2",children:["Supascale has been updated to v",g.latestVersion]}),(0,s.jsx)("p",{className:"text-sm text-foreground-muted mt-3",children:M>0?"The page will be ready to refresh in ".concat(M," seconds..."):"Click the button below to load the new version."})]}),"error"===E&&(0,s.jsxs)("div",{className:"py-6 text-center",children:[(0,s.jsx)("div",{className:"p-3 rounded-full bg-error/10 w-fit mx-auto mb-4",children:(0,s.jsx)(i.A,{className:"h-10 w-10 text-error"})}),(0,s.jsx)("p",{className:"font-medium text-lg text-error",children:"Update Failed"}),(0,s.jsx)("p",{className:"text-sm text-foreground-muted mt-2",children:T||(null==S?void 0:S.message)||"An error occurred during the update."}),(null==S?void 0:S.status)==="rolled_back"&&(0,s.jsx)("p",{className:"text-sm text-foreground-secondary mt-2",children:"Your previous version has been restored and should be running."})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-t border-border bg-background-tertiary",children:[(0,s.jsx)("div",{children:"info"===E&&!b&&(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:I,children:"Remind me later"})}),(0,s.jsxs)("div",{className:"flex gap-2",children:["info"===E&&(0,s.jsxs)(n.Button,{onClick:R,disabled:b,children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Download Update"]}),"ready"===E&&(0,s.jsxs)(n.Button,{onClick:P,disabled:v,children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Install Now"]}),"complete"===E&&(0,s.jsxs)(n.Button,{onClick:()=>{window.location.reload()},disabled:M>0,children:[(0,s.jsx)(h.A,{className:"h-4 w-4 mr-2"}),M>0?"Wait ".concat(M,"s..."):"Refresh Page"]}),"error"===E&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Button,{onClick:V,variant:"secondary",children:"Close"}),(0,s.jsxs)(n.Button,{onClick:O,children:[(0,s.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})]})]})]})]})}}}]);