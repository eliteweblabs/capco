(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8244],{1275:(e,r,s)=>{"use strict";s.d(r,{d:()=>u,t:()=>x});var t=s(95155),a=s(12115),n=s(42529),i=s(6132),l=s(52056),o=s(23327),c=s(65229),d=s(64269);let m=(0,a.createContext)(void 0);function x(e){let{children:r}=e,[s,n]=(0,a.useState)([]),i=(0,a.useCallback)(e=>{var r;let s=Math.random().toString(36).slice(2,11);return n(r=>[...r,{...e,id:s}]),setTimeout(()=>{n(e=>e.filter(e=>e.id!==s))},null!=(r=e.duration)?r:e.action?1e4:5e3),s},[]),l=(0,a.useCallback)(e=>{n(r=>r.filter(r=>r.id!==e))},[]);return(0,t.jsxs)(m.Provider,{value:{toasts:s,addToast:i,removeToast:l},children:[r,(0,t.jsx)(h,{toasts:s,onRemove:l})]})}function u(){let e=(0,a.useContext)(m);if(!e)throw Error("useToast must be used within a ToastProvider");return{toast:e.addToast,success:(r,s)=>e.addToast({type:"success",title:r,description:s}),error:(r,s)=>e.addToast({type:"error",title:r,description:s}),warning:(r,s)=>e.addToast({type:"warning",title:r,description:s}),info:(r,s)=>e.addToast({type:"info",title:r,description:s})}}function h(e){let{toasts:r,onRemove:s}=e;return(0,t.jsx)("div",{className:"fixed bottom-4 right-4 z-[100] flex flex-col gap-2 max-w-sm w-full",children:r.map(e=>(0,t.jsx)(f,{toast:e,onRemove:s},e.id))})}let p={success:n.A,error:i.A,warning:l.A,info:o.A},j={success:"text-success",error:"text-error",warning:"text-warning",info:"text-info"};function f(e){let{toast:r,onRemove:s}=e,a=p[r.type];return(0,t.jsxs)("div",{className:(0,d.cn)("flex items-start gap-3 p-4 rounded-lg shadow-lg border","bg-background-elevated border-border","animate-in slide-in-from-right-full"),role:"alert",children:[(0,t.jsx)(a,{className:(0,d.cn)("h-5 w-5 flex-shrink-0 mt-0.5",j[r.type])}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:r.title}),r.description&&(0,t.jsx)("p",{className:"text-sm text-foreground-secondary mt-1",children:r.description}),r.action&&(0,t.jsx)("button",{onClick:()=>{var e;null==(e=r.action)||e.onClick(),s(r.id)},className:"mt-2 text-sm font-medium text-brand hover:text-brand/80 transition-colors",children:r.action.label})]}),(0,t.jsxs)("button",{onClick:()=>s(r.id),className:"flex-shrink-0 text-foreground-muted hover:text-foreground transition-colors",children:[(0,t.jsx)(c.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Dismiss"})]})]})}},16230:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>P});var t=s(95155),a=s(12115),n=s(20063),i=s(62927),l=s(89405),o=s(86948),c=s(65142),d=s(64269);let m=(0,a.forwardRef)((e,r)=>{let{className:s,error:a,...n}=e;return(0,t.jsx)("textarea",{className:(0,d.cn)("\n          w-full min-h-[80px] px-3 py-2\n          bg-background-tertiary text-foreground\n          border border-border rounded-lg shadow-2xs\n          placeholder:text-foreground-muted\n          hover:border-border-hover\n          focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-brand focus-visible:border-transparent\n          disabled:cursor-not-allowed disabled:opacity-50\n          transition-all duration-150 resize-y\n          ",a&&"border-error focus-visible:ring-error hover:border-error",s),ref:r,...n})});m.displayName="Textarea";var x=s(3998),u=s(51834),h=s(1275),p=s(61704),j=s(85710),f=s(26989),g=s(12108),b=s(24033),N=s(52987),v=s(61362),y=s(78874),w=s(35299),k=s(6132),C=s(58702),S=s(71360),A=s(18514),T=s(99051);let D=["Validating project configuration","Creating project directory","Cloning Supabase repository","Generating secure credentials","Configuring environment variables","Configuring enabled services","Finalizing project setup"];function P(){let e=(0,n.useRouter)(),{error:r,success:s}=(0,h.d)(),[T,P]=(0,a.useState)(""),[B,F]=(0,a.useState)(""),[I,R]=(0,a.useState)(""),[z,O]=(0,a.useState)((0,p._)()),[_,W]=(0,a.useState)(!1),[Z,q]=(0,a.useState)(!1),[G,J]=(0,a.useState)(!1),[U,Y]=(0,a.useState)(null),[L,M]=(0,a.useState)(!1),[V,H]=(0,a.useState)({phase:"form",steps:D.map((e,r)=>({step:r+1,total:D.length,status:"pending",message:e})),currentStep:0}),K=(0,a.useCallback)((e,r,s)=>{H(t=>({...t,currentStep:e,steps:t.steps.map((t,a)=>a+1===e?{...t,status:r,detail:s}:t)}))},[]),Q=async e=>{try{let r=await fetch("/api/v1/projects/check-directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to check directory")}let s=await r.json();if(s.exists)return s;return null}catch(e){return r("Error",e.message),null}},X=async()=>{if(U){M(!0);try{let e=await fetch("/api/v1/projects/check-directory",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:B})}),t=await e.json();if(!e.ok){if(403===e.status)r("Permission Denied",t.suggestion||t.error);else throw Error(t.error||"Failed to delete directory");return}s("Directory Deleted","The existing directory has been removed."),J(!1),Y(null),await $()}catch(e){r("Error",e.message)}finally{M(!1)}}},$=async()=>{q(!0),H(e=>({...e,phase:"creating",steps:D.map((e,r)=>({step:r+1,total:D.length,status:"pending",message:e})),currentStep:0,error:void 0}));try{var t;let a=await fetch("/api/v1/projects/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:B,name:T.trim(),description:I.trim()||void 0,services:z})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to create project")}let n=null==(t=a.body)?void 0:t.getReader();if(!n)throw Error("Failed to read response stream");let i=new TextDecoder,l="";for(;;){let{done:t,value:a}=await n.read();if(t)break;let o=(l+=i.decode(a,{stream:!0})).split("\n\n");for(let t of(l=o.pop()||"",o))if(t.startsWith("data: "))try{let a=JSON.parse(t.slice(6));if("progress"===a.type){let e=a.data;K(e.step,e.status,e.detail)}else if("error"===a.type){let e=a.data.error;H(r=>({...r,phase:"error",error:e})),r("Error",e)}else"complete"===a.type&&(H(e=>({...e,phase:"completed"})),s("Project Created","".concat(T," has been created successfully")),setTimeout(()=>{e.push("/projects/".concat(B))},1500))}catch(e){}}}catch(s){let e=s.message;H(r=>({...r,phase:"error",error:e})),r("Error",e)}finally{q(!1)}},ee=async e=>{if(e.preventDefault(),!T.trim()||!B.trim())return void r("Validation Error","Name and Project ID are required");q(!0);let s=await Q(B);if(q(!1),s){Y(s),J(!0);return}await $()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Header,{title:"New Project",showCreateButton:!1}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)(l.Breadcrumb,{items:[{label:"Projects",href:"/projects"},{label:"New Project"}]}),(0,t.jsxs)("div",{className:"max-w-2xl",children:["form"===V.phase?(0,t.jsxs)(o.Zp,{children:[(0,t.jsx)(o.aR,{children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl bg-brand/10 flex items-center justify-center",children:(0,t.jsx)(j.A,{className:"h-6 w-6 text-brand"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.ZB,{children:"Create a new Supabase instance"}),(0,t.jsx)(o.BT,{children:"This will clone the Supabase repository and set up a new Docker environment"})]})]})}),(0,t.jsx)(o.Wu,{children:(0,t.jsxs)("form",{onSubmit:ee,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"name",className:"text-sm font-medium text-foreground",children:"Project Name"}),(0,t.jsx)(c.Input,{id:"name",type:"text",placeholder:"My Supabase Project",value:T,onChange:e=>{let r=e.target.value;P(r),F((0,d.Ye)(r))},required:!0,autoFocus:!0}),(0,t.jsx)("p",{className:"text-sm text-foreground-muted",children:"A friendly name for your project"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"projectId",className:"text-sm font-medium text-foreground",children:"Project ID"}),(0,t.jsx)(c.Input,{id:"projectId",type:"text",placeholder:"my-supabase-project",value:B,onChange:e=>F((0,d.Ye)(e.target.value)),required:!0,className:"font-mono"}),(0,t.jsx)("p",{className:"text-sm text-foreground-muted",children:"Used for Docker container names and directory. Lowercase letters, numbers, hyphens, and underscores only."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{htmlFor:"description",className:"text-sm font-medium text-foreground",children:["Description",(0,t.jsx)("span",{className:"text-foreground-muted font-normal",children:" (optional)"})]}),(0,t.jsx)(m,{id:"description",placeholder:"What is this project for?",value:I,onChange:e=>R(e.target.value),rows:3})]}),(0,t.jsxs)("div",{className:"border-t border-border pt-6",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>W(!_),className:"flex items-center justify-between w-full text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-brand/10 flex items-center justify-center",children:(0,t.jsx)(f.A,{className:"h-5 w-5 text-brand"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-foreground",children:"Configure Services"}),(0,t.jsxs)("p",{className:"text-xs text-foreground-muted",children:[z.length," services selected"]})]})]}),_?(0,t.jsx)(g.A,{className:"h-5 w-5 text-foreground-muted"}):(0,t.jsx)(b.A,{className:"h-5 w-5 text-foreground-muted"})]}),_&&(0,t.jsx)("div",{className:"mt-4 p-4 bg-background-tertiary rounded-lg",children:(0,t.jsx)(p.I,{value:z,onChange:O})})]}),(0,t.jsxs)("div",{className:"pt-4 flex justify-end gap-3",children:[(0,t.jsx)(x.Button,{type:"button",variant:"secondary",onClick:()=>e.back(),children:"Cancel"}),(0,t.jsxs)(x.Button,{type:"submit",disabled:Z||!T||!B,children:["Create Project",(0,t.jsx)(N.A,{className:"h-4 w-4 ml-2"})]})]})]})})]}):(0,t.jsxs)(o.Zp,{children:[(0,t.jsx)(o.aR,{children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:["completed"===V.phase?(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl bg-success/10 flex items-center justify-center",children:(0,t.jsx)(v.A,{className:"h-6 w-6 text-success"})}):"error"===V.phase?(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl bg-error/10 flex items-center justify-center",children:(0,t.jsx)(y.A,{className:"h-6 w-6 text-error"})}):(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl bg-brand/10 flex items-center justify-center",children:(0,t.jsx)(w.A,{className:"h-6 w-6 text-brand animate-spin"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.ZB,{children:"completed"===V.phase?"Project Created!":"error"===V.phase?"Creation Failed":"Creating ".concat(T,"...")}),(0,t.jsx)(o.BT,{children:"completed"===V.phase?"Your Supabase instance is ready. Redirecting...":"error"===V.phase?"An error occurred during project creation":"Setting up your new Supabase instance"})]})]})}),(0,t.jsxs)(o.Wu,{children:[(0,t.jsx)("div",{className:"space-y-3",children:V.steps.map((e,r)=>(0,t.jsx)(E,{step:e},r))}),"error"===V.phase&&V.error&&(0,t.jsx)("div",{className:"mt-6 p-4 rounded-lg bg-error/10 border border-error/20",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(k.A,{className:"h-5 w-5 text-error flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-error",children:"Error Details"}),(0,t.jsx)("p",{className:"text-sm text-foreground-secondary mt-1",children:V.error})]})]})}),"error"===V.phase&&(0,t.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,t.jsx)(x.Button,{variant:"secondary",onClick:()=>e.push("/projects"),children:"Back to Projects"}),(0,t.jsx)(x.Button,{onClick:()=>{H({phase:"form",steps:D.map((e,r)=>({step:r+1,total:D.length,status:"pending",message:e})),currentStep:0,error:void 0})},children:"Try Again"})]}),"completed"===V.phase&&(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)(x.Button,{onClick:()=>e.push("/projects/".concat(B)),children:["Go to Project",(0,t.jsx)(N.A,{className:"h-4 w-4 ml-2"})]})})]})]}),(0,t.jsx)(o.Zp,{className:"mt-6 bg-background-tertiary border-dashed",children:(0,t.jsxs)(o.Wu,{className:"pt-6",children:[(0,t.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"What happens next?"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm text-foreground-secondary",children:[(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-brand mt-1",children:"1."}),"A new directory will be created for your project"]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-brand mt-1",children:"2."}),"The official Supabase repository will be cloned"]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-brand mt-1",children:"3."}),"Secure credentials will be automatically generated"]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-brand mt-1",children:"4."}),"Unique ports will be assigned to avoid conflicts"]})]})]})})]})]}),(0,t.jsxs)(u.lG,{open:G,onClose:()=>{L||(J(!1),Y(null))},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-warning/10 flex items-center justify-center",children:(0,t.jsx)(C.A,{className:"h-5 w-5 text-warning"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Directory Already Exists"}),(0,t.jsx)("p",{className:"text-sm text-foreground-secondary mt-1",children:(null==U?void 0:U.inDatabase)?(0,t.jsxs)(t.Fragment,{children:["A project with ID ",(0,t.jsx)("code",{className:"text-foreground font-mono bg-background-tertiary px-1 rounded",children:B})," already exists in the database."]}):(null==U?void 0:U.isSupabaseProject)?(0,t.jsx)(t.Fragment,{children:"The directory contains an existing Supabase project that is not registered in Supascale."}):(0,t.jsx)(t.Fragment,{children:"A directory already exists at this location but is not a Supabase project."})})]})]}),U&&(0,t.jsxs)("div",{className:"p-3 bg-background-tertiary rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-foreground-muted mb-1",children:"Directory path:"}),(0,t.jsx)("code",{className:"text-sm text-foreground font-mono break-all",children:U.directory})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[!(null==U?void 0:U.inDatabase)&&(0,t.jsx)("div",{className:"p-3 border border-border rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(S.A,{className:"h-5 w-5 text-error mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Delete existing directory"}),(0,t.jsx)("p",{className:"text-xs text-foreground-muted mt-1",children:"Remove the existing directory and create a fresh project. This will permanently delete all files in the directory."}),(0,t.jsx)(x.Button,{variant:"secondary",size:"sm",className:"mt-3 text-error hover:text-error hover:bg-error/10",onClick:X,disabled:L,children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Delete & Continue"]})})]})]})}),(0,t.jsx)("div",{className:"p-3 border border-border rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(A.A,{className:"h-5 w-5 text-brand mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Use a different Project ID"}),(0,t.jsx)("p",{className:"text-xs text-foreground-muted mt-1",children:"Change the Project ID to create the project in a different directory."}),(0,t.jsxs)(x.Button,{variant:"secondary",size:"sm",className:"mt-3",onClick:()=>{J(!1),Y(null);let e=document.getElementById("projectId");e&&e.focus()},disabled:L,children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Change Project ID"]})]})]})})]}),(0,t.jsx)("div",{className:"flex items-center justify-end gap-3 mt-6",children:(0,t.jsx)(x.Button,{variant:"secondary",onClick:()=>{J(!1),Y(null)},disabled:L,children:"Cancel"})})]})]})}function E(e){let{step:r}=e;return(0,t.jsxs)("div",{className:"flex items-start gap-3 py-2",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{switch(r.status){case"completed":return(0,t.jsx)(v.A,{className:"h-5 w-5 text-success"});case"running":return(0,t.jsx)(w.A,{className:"h-5 w-5 text-brand animate-spin"});case"error":return(0,t.jsx)(y.A,{className:"h-5 w-5 text-error"});default:return(0,t.jsx)(T.A,{className:"h-5 w-5 text-foreground-muted"})}})()}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm ".concat((()=>{switch(r.status){case"completed":return"text-foreground";case"running":return"text-foreground font-medium";case"error":return"text-error";default:return"text-foreground-muted"}})()),children:r.message}),r.detail&&(0,t.jsx)("p",{className:"text-xs text-foreground-muted mt-0.5",children:r.detail})]}),"running"===r.status&&(0,t.jsx)("span",{className:"text-xs text-brand font-medium",children:"In progress"})]})}},51834:(e,r,s)=>{"use strict";s.d(r,{Es:()=>c,lG:()=>o});var t=s(95155),a=s(12115),n=s(65229),i=s(64269),l=s(3998);function o(e){let{open:r,onClose:s,children:o,className:c,title:d}=e;return r?(0,t.jsxs)(a.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:s,"aria-hidden":"true"}),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:(0,i.cn)("relative w-full max-w-lg max-h-[90vh] flex flex-col bg-background-secondary rounded-xl shadow-lg border border-border","animate-in fade-in-0 zoom-in-95 duration-200",c),role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:[d&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 pb-0 flex-shrink-0",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:d}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8 text-foreground-muted hover:text-foreground",children:[(0,t.jsx)(n.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]}),(0,t.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:o})]})})]}):null}function c(e){let{children:r,className:s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex items-center justify-end gap-3 p-6 pt-0",s),children:r})}},65142:(e,r,s)=>{"use strict";s.d(r,{Input:()=>i});var t=s(95155),a=s(12115),n=s(64269);let i=(0,a.forwardRef)((e,r)=>{let{className:s,type:a="text",error:i,icon:l,...o}=e;return(0,t.jsxs)("div",{className:"relative",children:[l&&(0,t.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground-muted",children:l}),(0,t.jsx)("input",{type:a,className:(0,n.cn)("\n            w-full h-10 px-3 py-2\n            bg-background-tertiary text-foreground\n            border border-border rounded-lg shadow-2xs\n            placeholder:text-foreground-muted\n            hover:border-border-hover\n            focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-brand focus-visible:border-transparent\n            disabled:cursor-not-allowed disabled:opacity-50\n            transition-all duration-150\n            ",l&&"pl-10",i&&"border-error focus-visible:ring-error hover:border-error",s),ref:r,...o})]})});i.displayName="Input"},86208:(e,r,s)=>{Promise.resolve().then(s.bind(s,16230))}},e=>{e.O(0,[2903,2619,797,6563,8441,1255,7358],()=>e(e.s=86208)),_N_E=e.O()}]);