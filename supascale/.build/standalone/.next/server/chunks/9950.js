exports.id=9950,exports.ids=[9950],exports.modules={3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(71237),e=c(55088),f=c(17679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},10389:(a,b,c)=>{"use strict";c.d(b,{j2:()=>k,Y9:()=>h});var d=c(61665),e=c(14838),f=c(35552);let g=new Map;setInterval(()=>{let a=Date.now();for(let[b,c]of g.entries())a-c.lastAttempt>36e5&&c.lockedUntil<a&&g.delete(b)},3e5);let{handlers:h,signIn:i,signOut:j,auth:k}=(0,d.Ay)({providers:[(0,e.A)({name:"Credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(a){if(!a?.username||!a?.password)return null;let b=a.username,c=function(a){let b=Date.now(),c=g.get(a);if(!c)return{limited:!1};if(c.lockedUntil>b){let a=Math.ceil((c.lockedUntil-b)/1e3);return{limited:!0,retryAfter:a,message:`Too many failed attempts. Try again in ${Math.ceil(a/60)} minutes.`}}return b-c.lastAttempt>36e5&&g.delete(a),{limited:!1}}(b);if(c.limited)throw(0,f.logActivity)("auth","login_blocked_rate_limit","system",{username:b.substring(0,3)+"***",retryAfter:c.retryAfter}),Error(c.message||"Too many failed attempts");if(!(0,f.hasValidLicense)())throw Error("LICENSE_REQUIRED");let d=(0,f.validateUser)(b,a.password);return d?(g.delete(b),(0,f.logActivity)("auth","login_success",d.id,{}),{id:d.id,name:d.username,email:`${d.username}@supascale.local`,role:d.role}):(!function(a){let b=Date.now(),c=g.get(a);if(!c)return g.set(a,{attempts:1,lastAttempt:b,lockedUntil:0});if(b-c.lastAttempt>36e5){c.attempts=1,c.lastAttempt=b,c.lockedUntil=0;return}if(c.attempts++,c.lastAttempt=b,c.attempts>=5){let d=Math.pow(2,Math.floor(c.attempts/5)-1);c.lockedUntil=b+9e5*d,console.warn(`Rate limit lockout applied for identifier: ${a.substring(0,3)}*** (attempts: ${c.attempts})`)}}(b),(0,f.logActivity)("auth","login_failed","system",{username:b.substring(0,3)+"***"}),null)}})],pages:{signIn:"/login",error:"/login"},callbacks:{jwt:async({token:a,user:b})=>(b&&(a.id=b.id,a.role=b.role),a),session:async({session:a,token:b})=>(a.user&&(a.user.id=b.id,a.user.role=b.role),a)},session:{strategy:"jwt",maxAge:86400},trustHost:!0})},29685:(a,b,c)=>{"use strict";c.d(b,{QE:()=>x,Ux:()=>t,Ig:()=>u,MB:()=>w,lP:()=>y});var d=c(29021),e=c.n(d),f=c(33873),g=c.n(f),h=c(79646),i=c(28354),j=c(35552);let k="1.1.33",l="v1.1.33-01242026";var m=c(2328);let n=(0,i.promisify)(h.exec),o=process.env.UPDATE_SERVER_URL||"https://www.supascale.app",p=(0,m.mC)(),q=(0,m.Ag)();function r(){try{if(e().existsSync(p)){let a=e().readFileSync(p,"utf-8");return JSON.parse(a)}}catch(a){console.error("Error reading update state:",a)}return null}function s(a){try{e().writeFileSync(p,JSON.stringify(a,null,2))}catch(a){console.error("Error writing update state:",a)}}async function t(a=!1){let b=new Date().toISOString(),c=r();if(!a&&c?.updateInfo){let a=new Date(c.lastChecked).getTime();if(Date.now()-a<864e5)return c.dismissedVersion===c.updateInfo.latestVersion?{...c.updateInfo,dismissed:!0}:c.updateInfo}let d={currentVersion:k,latestVersion:k,updateAvailable:!1,lastChecked:b};try{let a=(0,j.getUpdateCredentials)();if(!a)return console.warn("No update credentials found, skipping update check"),d;let b=await fetch(`${o}/api/v1/updates/check`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":`Supascale/${l}`},body:JSON.stringify({email:a.email,updateToken:a.updateToken,currentVersion:k})});if(b.ok){let a=await b.json();a.success&&a.version&&(d.latestVersion=a.version,d.updateAvailable=0>function(a,b){let c=a.replace(/^v/,"").split(".").map(Number),d=b.replace(/^v/,"").split(".").map(Number);for(let a=0;a<Math.max(c.length,d.length);a++){let b=c[a]||0,e=d[a]||0;if(b<e)return -1;if(b>e)return 1}return 0}(k,a.version),d.releaseDate=a.releaseDate,d.releaseNotes=a.releaseNotes,d.checksum=a.checksum,d.size=a.size)}}catch(a){if(console.error("Error checking for updates:",a),c?.updateInfo)return{...c.updateInfo,lastChecked:b}}return s({lastChecked:b,updateInfo:d,dismissedVersion:c?.dismissedVersion}),d}function u(a){let b=r();b&&(b.dismissedVersion=a,s(b))}async function v(){try{let a=(0,j.getUpdateCredentials)();if(!a)throw Error("No update credentials found. Please re-validate your license.");let b=await fetch(`${o}/api/v1/updates/download-url`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":`Supascale/${l}`},body:JSON.stringify({email:a.email,updateToken:a.updateToken,currentVersion:k})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to get download URL")}let c=await b.json();if(!c.success||!c.url)throw Error(c.error||"Invalid response from update server");return{url:c.url,expiresAt:c.expiresAt||new Date(Date.now()+36e5).toISOString()}}catch(a){throw console.error("Error requesting signed download URL:",a),a}}async function w(a){e().existsSync(q)||e().mkdirSync(q,{recursive:!0});let b=await v();if(!b)throw Error("Failed to get download URL");let d=await t(),f=g().join(q,`supascale-${d.latestVersion}.tar.gz`),h=await fetch(b.url);if(!h.ok)throw Error(`Download failed: ${h.statusText}`);let i=parseInt(h.headers.get("content-length")||"0",10),j=h.body?.getReader();if(!j)throw Error("Failed to get response reader");let k=[],l=0;for(;;){let{done:b,value:c}=await j.read();if(b)break;k.push(c),l+=c.length,a&&i>0&&a(Math.round(l/i*100),l,i)}let m=Buffer.concat(k);if(e().writeFileSync(f,m),d.checksum){let a=await Promise.resolve().then(c.t.bind(c,55511,23)),b=e().readFileSync(f);if(a.createHash("sha256").update(b).digest("hex")!==d.checksum)throw e().unlinkSync(f),Error("Checksum verification failed - download may be corrupted")}let n=r();return n&&(n.downloadPath=f,s(n)),f}async function x(){let a=r();if(!a?.downloadPath||!e().existsSync(a.downloadPath))throw Error("No update downloaded");let b=g().join(process.cwd(),"scripts","apply-update.sh");if(!e().existsSync(b))throw Error("Update script not found");await n(`chmod +x "${b}"`);let c=(0,m.LV)(),d=g().join(c,"update-exec.log"),f=`setsid nohup bash "${b}" "${a.downloadPath}" > "${d}" 2>&1 &`;await n(f),a.downloadPath=void 0,a.updateInfo=null,s(a)}function y(){return r()}},78335:()=>{},95736:(a,b,c)=>{"use strict";a.exports=c(44870)},96487:()=>{}};