"use strict";exports.id=2875,exports.ids=[2875],exports.modules={42875:(a,b,c)=>{c.d(b,{runStartupOnce:()=>n});var d=c(1717),e=c(28041);async function f(a,b,c,d={}){let g=`${a}/supabase/docker`,h=await k(),i=`${h} -p ${(0,e.io)(b)}`;switch(c){case"up":i+=" up",!1!==d.detached&&(i+=" -d");break;case"down":i+=" down",d.removeVolumes&&(i+=" -v"),d.removeOrphans&&(i+=" --remove-orphans");break;case"stop":i+=" stop";break;case"start":i+=" start";break;case"restart":i+=" restart";break;case"ps":i+=" ps --format json";break;case"logs":i+=" logs",d.follow&&(i+=" -f"),d.tail&&(i+=` --tail ${d.tail}`);break;case"pull":i+=" pull"}return d.services&&d.services.length>0&&(i+=" "+d.services.map(e.io).join(" ")),(0,e.NK)(i,{cwd:g,timeout:3e5})}async function g(a,b){if(await j()){let a=await (0,e.NK)('podman ps -a --format "{{.Names}}|{{.State}}"');if(0!==a.exitCode||!a.stdout.trim())return"stopped";let c=a.stdout.trim().split("\n").filter(Boolean),d=b.toLowerCase(),f=c.filter(a=>(a.split("|")[0]||"").toLowerCase().includes(d));if(0===f.length)return"stopped";let g=f.map(a=>a.split("|")[1]||""),h=g.filter(a=>"running"===a.toLowerCase()).length,i=g.filter(a=>"created"===a.toLowerCase()).length,j=g.filter(a=>"exited"===a.toLowerCase()).length,k=g.length;return h===k?"running":h>0&&i>0&&0===j||i>0&&0===h&&0===j?"starting":h>0&&j>0?"degraded":j===k||0===h&&0===i?"stopped":"unknown"}let c=await f(a,b,"ps");if(0!==c.exitCode)return"unknown";try{let a=c.stdout.trim().split("\n").filter(Boolean);if(0===a.length)return"stopped";let b=a.map(a=>{try{return JSON.parse(a)}catch{return null}}).filter(Boolean);if(0===b.length)return"stopped";let d=b.map(a=>a.State?.toLowerCase());if(d.every(a=>"running"===a))return"running";if(d.every(a=>"exited"===a||"stopped"===a))return"stopped";if(d.some(a=>"restarting"===a))return"error";return"unknown"}catch{return"unknown"}}async function h(a,b){return f(a,b,"up",{detached:!0})}let i=null;async function j(){if(null!==i)return i;let a=(await (0,e.NK)("docker --version")).stdout.toLowerCase().includes("podman"),b=0===(await (0,e.NK)("which podman-compose")).exitCode;return i=a||b}async function k(){return await j()&&0===(await (0,e.NK)("which podman-compose")).exitCode?"podman-compose":"docker compose"}async function l(){let a=[],b=(0,d.wS)();if(0===b.length)return console.log("[Startup] No projects configured for auto-start"),a;for(let c of(console.log(`[Startup] Found ${b.length} project(s) with auto-start enabled`),b))try{let b=await g(c.directory,c.id);if("running"===b){console.log(`[Startup] Project "${c.name}" is already running, skipping`),a.push({projectId:c.id,projectName:c.name,success:!0,alreadyRunning:!0});continue}console.log(`[Startup] Starting project "${c.name}"...`);let e=await h(c.directory,c.id);if(0===e.exitCode)console.log(`[Startup] Project "${c.name}" started successfully`),(0,d.Mx)("project","project.auto_started","system",{projectId:c.id,projectName:c.name},c.id),a.push({projectId:c.id,projectName:c.name,success:!0});else{let b=e.stderr||"Unknown error";console.error(`[Startup] Failed to start project "${c.name}": ${b}`),(0,d.Mx)("project","project.auto_start_failed","system",{projectId:c.id,projectName:c.name,error:b},c.id,"failure",b),a.push({projectId:c.id,projectName:c.name,success:!1,error:b})}}catch(d){let b=d instanceof Error?d.message:"Unknown error";console.error(`[Startup] Error starting project "${c.name}": ${b}`),a.push({projectId:c.id,projectName:c.name,success:!1,error:b})}let c=a.filter(a=>a.success).length,e=a.filter(a=>!a.success).length;return console.log(`[Startup] Auto-start complete: ${c} succeeded, ${e} failed`),a}let m=!1;async function n(){if(m)return null;let a=await l();return m=!0,a}}};