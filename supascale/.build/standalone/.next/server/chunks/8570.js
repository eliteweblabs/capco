"use strict";exports.id=8570,exports.ids=[8570],exports.modules={20942:(a,b,c)=>{c.d(b,{NK:()=>i,Ys:()=>j,hx:()=>k,io:()=>h});var d=c(79646);let e=(0,c(28354).promisify)(d.exec),f=["docker","docker-compose","podman","podman-compose","git","certbot","openssl","pg_dump","pg_restore","psql","tar","gzip","gunzip","which","npx"];function g(a){let b=a.trim().split(/\s+/)[0];return f.some(a=>b===a||b.endsWith(`/${a}`))}function h(a){return`'${a.replace(/'/g,"'\\''")}'`}async function i(a,b={}){if(!g(a))throw Error(`Command not allowed: ${a.split(/\s+/)[0]}`);try{let{stdout:c,stderr:d}=await e(a,{cwd:b.cwd,timeout:b.timeout||12e4,env:{...process.env,...b.env},maxBuffer:0xa00000});return{stdout:c,stderr:d,exitCode:0}}catch(a){return{stdout:a.stdout||"",stderr:a.stderr||a.message,exitCode:a.code||1}}}async function j(a){try{let{exitCode:b}=await i(`which ${a}`);return 0===b}catch{return!1}}async function k(a,b={}){if(!g(a))throw Error(`Command not allowed: ${a.split(/\s+/)[0]}`);return new Promise(c=>{let e=(0,d.spawn)(a,[],{cwd:b.cwd,env:{...process.env,...b.env},shell:!0}),f="",g="",h="",i="",j=a=>{let b=[],c=a.split("\n"),d=c.pop()||"";for(let a of c){let c=a.split("\r"),d=c[c.length-1].trim();d&&b.push(d)}return{lines:b,remainder:d}};e.stdout?.on("data",a=>{let c=a.toString();f+=c;let{lines:d,remainder:e}=j(h+=c);for(let a of(h=e,d))b.onStdout&&b.onStdout(a)}),e.stderr?.on("data",a=>{let c=a.toString();g+=c;let{lines:d,remainder:e}=j(i+=c);for(let a of(i=e,d))b.onStderr&&b.onStderr(a)});let k=b.timeout?setTimeout(()=>{e.kill("SIGTERM")},b.timeout):null;e.on("close",a=>{k&&clearTimeout(k),h.trim()&&b.onStdout&&b.onStdout(h),i.trim()&&b.onStderr&&b.onStderr(i),c({stdout:f,stderr:g,exitCode:a||0})}),e.on("error",a=>{k&&clearTimeout(k),c({stdout:f,stderr:a.message,exitCode:1})})})}},68570:(a,b,c)=>{c.d(b,{B8:()=>o,Ec:()=>k,F_:()=>u,SI:()=>m,Sf:()=>f,YI:()=>l,e3:()=>g,eo:()=>s,ht:()=>n,lW:()=>h,mG:()=>j,oE:()=>q,u4:()=>i,ur:()=>p});var d=c(20942);async function e(a,b,c,f={}){let g=`${a}/supabase/docker`,h=await t(),i=`${h} -p ${(0,d.io)(b)}`;switch(c){case"up":i+=" up",!1!==f.detached&&(i+=" -d");break;case"down":i+=" down",f.removeVolumes&&(i+=" -v"),f.removeOrphans&&(i+=" --remove-orphans");break;case"stop":i+=" stop";break;case"start":i+=" start";break;case"restart":i+=" restart";break;case"ps":i+=" ps --format json";break;case"logs":i+=" logs",f.follow&&(i+=" -f"),f.tail&&(i+=` --tail ${f.tail}`);break;case"pull":i+=" pull"}return f.services&&f.services.length>0&&(i+=" "+f.services.map(d.io).join(" ")),(0,d.NK)(i,{cwd:g,timeout:3e5})}async function f(a,b){if(await s()){let a=await (0,d.NK)('podman ps -a --format "{{.Names}}|{{.State}}"');if(0!==a.exitCode||!a.stdout.trim())return"stopped";let c=a.stdout.trim().split("\n").filter(Boolean),e=b.toLowerCase(),f=c.filter(a=>(a.split("|")[0]||"").toLowerCase().includes(e));if(0===f.length)return"stopped";let g=f.map(a=>a.split("|")[1]||""),h=g.filter(a=>"running"===a.toLowerCase()).length,i=g.filter(a=>"created"===a.toLowerCase()).length,j=g.filter(a=>"exited"===a.toLowerCase()).length,k=g.length;return h===k?"running":h>0&&i>0&&0===j||i>0&&0===h&&0===j?"starting":h>0&&j>0?"degraded":j===k||0===h&&0===i?"stopped":"unknown"}let c=await e(a,b,"ps");if(0!==c.exitCode)return"unknown";try{let a=c.stdout.trim().split("\n").filter(Boolean);if(0===a.length)return"stopped";let b=a.map(a=>{try{return JSON.parse(a)}catch{return null}}).filter(Boolean);if(0===b.length)return"stopped";let d=b.map(a=>a.State?.toLowerCase());if(d.every(a=>"running"===a))return"running";if(d.every(a=>"exited"===a||"stopped"===a))return"stopped";if(d.some(a=>"restarting"===a))return"error";return"unknown"}catch{return"unknown"}}async function g(a,b){if(await s()){let a=await (0,d.NK)('podman ps -a --format "{{.Names}}|{{.Image}}|{{.State}}"');if(0!==a.exitCode||!a.stdout.trim())return[];let c=a.stdout.trim().split("\n").filter(Boolean),e=b.toLowerCase(),f=c.filter(a=>(a.split("|")[0]||"").toLowerCase().includes(e));return 0===f.length?[]:f.map(a=>{let c=a.split("|"),d=c[0]||"",e=c[1]||"",f=c[2]||"",g=d,h=g.match(RegExp(`^${b}[_-]`,"i"));h&&(g=g.slice(h[0].length)),g=g.replace(/[_-]\d+$/,"");let i=e.includes(":")&&e.split(":").pop()||"latest";return{service:g,image:e,currentVersion:i,status:v(f)}})}let c=await e(a,b,"ps");if(0!==c.exitCode||!c.stdout.trim())return[];try{return c.stdout.trim().split("\n").filter(Boolean).map(a=>{try{return JSON.parse(a)}catch{return null}}).filter(Boolean).map(a=>{let b=a.Image||"",c=b.includes(":")&&b.split(":").pop()||"latest",d=v(a.State||"");return{service:a.Service,image:b,currentVersion:c,status:d}})}catch{return[]}}async function h(a,b,c,d=100){let f=await e(a,b,"logs",{services:c?[c]:void 0,tail:d});return f.stdout||f.stderr}async function i(a,b){return e(a,b,"up",{detached:!0})}async function j(a,b,c={}){let e=`${a}/supabase/docker`,f=await t(),g=`${f} -p ${(0,d.io)(b)} up -d`,h=new Set,i=new Set,k=a=>!!(/^[a-f0-9]{12}$/i.test(a)||/^[a-f0-9]{12}\s+(Waiting|Downloading|Extracting|Pull complete|Already exists)?$/i.test(a)||/^\[[\s=>#-]+\]\s*[\d.]+[KMGT]?B?\/[\d.]+[KMGT]?B?/.test(a)||/^\d+\s*s$/.test(a)||/^[a-f0-9]{12}\s+\[/.test(a)||/^[\d.]+[KMGT]?B\/[\d.]+[KMGT]?B$/.test(a)),l=a=>{let b=a.trim();if(!b||k(b))return;let d=b.match(/Image\s+(\S+)\s+(Pulling|Pulled)/i);if(d){let a=`${d[1]}-${d[2]}`;h.has(a)||(h.add(a),c.onOutput?.(b,"pull"),c.onProgress?.(d[1],d[2]));return}if(b.includes("Network")&&(b.includes("Creating")||b.includes("Created"))||b.includes("Volume")&&(b.includes("Creating")||b.includes("Created")))return void c.onOutput?.(b,"create");let e=b.match(/Container\s+(\S+)\s+(Creating|Created)/i);if(e){let a=`${e[1]}-${e[2]}`;i.has(a)||(i.add(a),c.onOutput?.(b,"create"),c.onProgress?.(e[1],e[2]));return}let f=b.match(/Container\s+(\S+)\s+(Starting|Started)/i);if(f){let a=`${f[1]}-${f[2]}`;i.has(a)||(i.add(a),c.onOutput?.(`${f[1]}: ${f[2]}`,"start"),c.onProgress?.(f[1],f[2]));return}return b.includes("Waiting")||b.includes("Healthy")?void c.onOutput?.(b,"info"):(a=>{let b=a.toLowerCase();return!!(b.includes("error:")||b.includes("failed")||b.includes("cannot ")||b.includes("unable to")||b.includes("permission denied")||b.includes("no such")||b.includes("not found")||b.includes("refused")||b.includes("timeout")||b.includes("fatal")||b.includes("panic")||a.includes("âœ—"))})(b)?void c.onOutput?.(b,"error"):void(b.length>3&&!k(b)&&c.onOutput?.(b,"info"))};return(0,d.hx)(g,{cwd:e,timeout:6e5,onStdout:a=>l(a),onStderr:a=>l(a)})}async function k(a,b){return e(a,b,"stop")}async function l(a,b){let c=await s();return(0,d.NK)(`${c?"podman":"docker"} start ${(0,d.io)(b)}`)}async function m(a,b){let c=await s();return(0,d.NK)(`${c?"podman":"docker"} stop ${(0,d.io)(b)}`)}async function n(a,b){let c=await s();return(0,d.NK)(`${c?"podman":"docker"} restart ${(0,d.io)(b)}`)}async function o(a,b=100){let c=await s(),e=await (0,d.NK)(`${c?"podman":"docker"} logs --tail ${b} ${(0,d.io)(a)}`);return e.stdout||e.stderr}async function p(a,b){let c=await s();return(0,d.NK)(`${c?"podman":"docker"} exec ${(0,d.io)(a)} sh -c ${(0,d.io)(b)}`,{timeout:6e4})}async function q(a,b,c=!1){return e(a,b,"down",{removeVolumes:c,removeOrphans:!0})}let r=null;async function s(){if(null!==r)return r;let a=(await (0,d.NK)("docker --version")).stdout.toLowerCase().includes("podman"),b=0===(await (0,d.NK)("which podman-compose")).exitCode;return r=a||b}async function t(){return await s()&&0===(await (0,d.NK)("which podman-compose")).exitCode?"podman-compose":"docker compose"}async function u(a){let b=await s(),c=[];if(b){let b=await (0,d.NK)('podman ps --format "{{.Names}}" --filter status=running');if(0!==b.exitCode||!b.stdout.trim())return[];let e=b.stdout.trim().split("\n").filter(Boolean),f=a.toLowerCase();c=e.filter(a=>a.toLowerCase().includes(f))}else{let b=await (0,d.NK)(`docker ps --filter "label=com.docker.compose.project=${(0,d.io)(a)}" --format "{{.Names}}"`);if(0!==b.exitCode||!b.stdout.trim())return[];c=b.stdout.trim().split("\n").filter(Boolean)}if(0===c.length)return[];let e=await (0,d.NK)(`${b?"podman":"docker"} stats --no-stream --format "{{.ID}}|{{.Name}}|{{.CPUPerc}}|{{.MemUsage}}|{{.MemPerc}}|{{.NetIO}}|{{.BlockIO}}|{{.PIDs}}" ${c.map(a=>(0,d.io)(a)).join(" ")}`);if(0!==e.exitCode||!e.stdout.trim())return[];let f=[];for(let b of e.stdout.trim().split("\n")){let c=b.split("|");if(c.length<8)continue;let[d,e,g,h,i,j,k,l]=c,m=parseFloat(g.replace("%",""))||0,n=h.split(" / "),o=w(n[0]||"0"),p=w(n[1]||"0"),q=parseFloat(i.replace("%",""))||0,r=j.split(" / "),s=w(r[0]||"0"),t=w(r[1]||"0"),u=k.split(" / "),v=w(u[0]||"0"),x=w(u[1]||"0"),y=parseInt(l,10)||0,z=e,A=z.match(RegExp(`^${a}[_-]`,"i"));A&&(z=z.slice(A[0].length)),z=z.replace(/[_-]\d+$/,""),f.push({service:z,containerId:d,name:e,cpuPercent:m,memoryUsage:o,memoryLimit:p,memoryPercent:q,networkRx:s,networkTx:t,blockRead:v,blockWrite:x,pids:y})}return f}function v(a){let b=(a||"").toLowerCase().trim();return"running"===b||b.includes("up")?"running":"created"===b?"created":"restarting"===b?"restarting":"exited"===b||b.includes("exited")?"exited":("paused"===b,"stopped")}function w(a){let b=a.trim().match(/^([\d.]+)\s*([KMGT]?i?B)?$/i);if(!b)return 0;let c=parseFloat(b[1]);return c*(({B:1,KB:1024,KIB:1024,MB:1048576,MIB:1048576,GB:0x40000000,GIB:0x40000000,TB:0x10000000000,TIB:0x10000000000})[(b[2]||"B").toUpperCase()]||1)}}};