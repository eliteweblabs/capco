(()=>{var a={};a.id=2589,a.ids=[2589],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(71237),e=c(55088),f=c(17679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20942:(a,b,c)=>{"use strict";c.d(b,{NK:()=>i,Ys:()=>j,hx:()=>k,io:()=>h});var d=c(79646);let e=(0,c(28354).promisify)(d.exec),f=["docker","docker-compose","podman","podman-compose","git","certbot","openssl","pg_dump","pg_restore","psql","tar","gzip","gunzip","which","npx"];function g(a){let b=a.trim().split(/\s+/)[0];return f.some(a=>b===a||b.endsWith(`/${a}`))}function h(a){return`'${a.replace(/'/g,"'\\''")}'`}async function i(a,b={}){if(!g(a))throw Error(`Command not allowed: ${a.split(/\s+/)[0]}`);try{let{stdout:c,stderr:d}=await e(a,{cwd:b.cwd,timeout:b.timeout||12e4,env:{...process.env,...b.env},maxBuffer:0xa00000});return{stdout:c,stderr:d,exitCode:0}}catch(a){return{stdout:a.stdout||"",stderr:a.stderr||a.message,exitCode:a.code||1}}}async function j(a){try{let{exitCode:b}=await i(`which ${a}`);return 0===b}catch{return!1}}async function k(a,b={}){if(!g(a))throw Error(`Command not allowed: ${a.split(/\s+/)[0]}`);return new Promise(c=>{let e=(0,d.spawn)(a,[],{cwd:b.cwd,env:{...process.env,...b.env},shell:!0}),f="",g="",h="",i="",j=a=>{let b=[],c=a.split("\n"),d=c.pop()||"";for(let a of c){let c=a.split("\r"),d=c[c.length-1].trim();d&&b.push(d)}return{lines:b,remainder:d}};e.stdout?.on("data",a=>{let c=a.toString();f+=c;let{lines:d,remainder:e}=j(h+=c);for(let a of(h=e,d))b.onStdout&&b.onStdout(a)}),e.stderr?.on("data",a=>{let c=a.toString();g+=c;let{lines:d,remainder:e}=j(i+=c);for(let a of(i=e,d))b.onStderr&&b.onStderr(a)});let k=b.timeout?setTimeout(()=>{e.kill("SIGTERM")},b.timeout):null;e.on("close",a=>{k&&clearTimeout(k),h.trim()&&b.onStdout&&b.onStdout(h),i.trim()&&b.onStderr&&b.onStderr(i),c({stdout:f,stderr:g,exitCode:a||0})}),e.on("error",a=>{k&&clearTimeout(k),c({stdout:f,stderr:a.message,exitCode:1})})})}},21820:a=>{"use strict";a.exports=require("os")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50233:(a,b,c)=>{"use strict";c.d(b,{$0:()=>q,c6:()=>p});var d=c(20942),e=c(15995),f=c(79748),g=c(33873),h=c(21820);function i(a){return a.includes("-----BEGIN CERTIFICATE-----")&&a.includes("-----END CERTIFICATE-----")}async function j(a,b=".pem"){let c=await f.mkdtemp(g.join(h.tmpdir(),"cert-")),d=g.join(c,`temp${b}`);return await f.writeFile(d,a,{mode:384}),d}async function k(a){try{await f.unlink(a),await f.rmdir(g.dirname(a))}catch{}}async function l(a){if(!i(a))return{valid:!1,error:"Invalid certificate format. Expected PEM-encoded certificate."};let b=await j(a);try{let a=await (0,d.NK)(`openssl x509 -in ${(0,d.io)(b)} -noout -subject -issuer -dates -text`);if(0!==a.exitCode)return{valid:!1,error:`Invalid certificate: ${a.stderr}`};let c=a.stdout,e=c.match(/Subject:.*CN\s*=\s*([^\n,]+)/),f=e?e[1].trim():"Unknown",g=c.match(/Issuer:.*(?:O|CN)\s*=\s*([^\n,]+)/),h=g?g[1].trim():"Unknown",i=c.match(/Not Before:\s*(.+)/),j=c.match(/Not After\s*:\s*(.+)/),k=i?new Date(i[1]):new Date,l=j?new Date(j[1]):new Date,m=[];e&&m.push(e[1].trim());let n=c.match(/DNS:([^,\n]+)/g);if(n)for(let a of n){let b=a.replace("DNS:","").trim();m.includes(b)||m.push(b)}return{valid:!0,info:{subject:f,issuer:h,validFrom:k,validTo:l,domains:m}}}finally{await k(b)}}async function m(a){if(!(a.includes("-----BEGIN PRIVATE KEY-----")&&a.includes("-----END PRIVATE KEY-----")||a.includes("-----BEGIN RSA PRIVATE KEY-----")&&a.includes("-----END RSA PRIVATE KEY-----")||a.includes("-----BEGIN EC PRIVATE KEY-----")&&a.includes("-----END EC PRIVATE KEY-----")))return{valid:!1,error:"Invalid private key format. Expected PEM-encoded private key."};let b=await j(a);try{let a=await (0,d.NK)(`openssl rsa -in ${(0,d.io)(b)} -noout -text 2>&1`);if(0===a.exitCode){let b=a.stdout.match(/Private-Key: \((\d+) bit/);return{valid:!0,info:{keyType:"RSA",keySize:b?parseInt(b[1]):2048}}}if(a=await (0,d.NK)(`openssl ec -in ${(0,d.io)(b)} -noout -text 2>&1`),0===a.exitCode){let b=a.stdout.match(/NIST CURVE: P-(\d+)/i)||a.stdout.match(/(\d+) bit/);return{valid:!0,info:{keyType:"ECDSA",keySize:b?parseInt(b[1]):256}}}if(a=await (0,d.NK)(`openssl pkey -in ${(0,d.io)(b)} -noout 2>&1`),0===a.exitCode)return{valid:!0,info:{keyType:"Unknown",keySize:0}};return{valid:!1,error:"Invalid or corrupted private key."}}finally{await k(b)}}async function n(a,b){let c=await j(a,".crt"),e=await j(b,".key");try{let a=await (0,d.NK)(`openssl x509 -in ${(0,d.io)(c)} -noout -modulus 2>&1 || openssl x509 -in ${(0,d.io)(c)} -noout -pubkey 2>&1`),b=await (0,d.NK)(`openssl rsa -in ${(0,d.io)(e)} -noout -modulus 2>&1 || openssl ec -in ${(0,d.io)(e)} -noout -pubout 2>&1 || openssl pkey -in ${(0,d.io)(e)} -pubout 2>&1`);if(a.stdout.includes("Modulus=")&&b.stdout.includes("Modulus=")){let c=a.stdout.match(/Modulus=([A-F0-9]+)/)?.[1],d=b.stdout.match(/Modulus=([A-F0-9]+)/)?.[1];if(c&&d&&c===d)return{valid:!0};return{valid:!1,error:"Certificate and private key do not match (modulus mismatch)."}}let g=await j("test-data",".txt"),h=g+".sig";try{let a=await (0,d.NK)(`openssl dgst -sha256 -sign ${(0,d.io)(e)} -out ${(0,d.io)(h)} ${(0,d.io)(g)}`);if(0!==a.exitCode)return{valid:!1,error:"Failed to sign test data with private key."};let b=await (0,d.NK)(`openssl dgst -sha256 -verify <(openssl x509 -in ${(0,d.io)(c)} -pubkey -noout) -signature ${(0,d.io)(h)} ${(0,d.io)(g)}`);if(0===b.exitCode||b.stdout.includes("Verified OK"))return{valid:!0};return{valid:!1,error:"Certificate and private key do not match (signature verification failed)."}}finally{await k(g);try{await f.unlink(h)}catch{}}}finally{await k(c),await k(e)}}async function o(a,b){if(!b)return{valid:!0};let c=await j(a,".crt"),e=await j(b,".chain");try{let a=await (0,d.NK)(`openssl verify -CAfile ${(0,d.io)(e)} ${(0,d.io)(c)}`);if(0===a.exitCode||a.stdout.includes(": OK"))return{valid:!0};let b=await (0,d.NK)(`openssl verify -partial_chain -CAfile ${(0,d.io)(e)} ${(0,d.io)(c)}`);if(0===b.exitCode||b.stdout.includes(": OK"))return{valid:!0};return{valid:!1,error:"Certificate chain verification failed. Ensure intermediate certificates are correct."}}finally{await k(c),await k(e)}}async function p(a){let b=[],c=[],d=await l(a.certificate);d.valid||b.push(d.error||"Invalid certificate");let e=await m(a.privateKey);if(e.valid||b.push(e.error||"Invalid private key"),0===b.length){let c=await n(a.certificate,a.privateKey);c.valid||b.push(c.error||"Certificate and key do not match")}let f=!1;if(a.intermediates)if(f=!0,i(a.intermediates)){let b=await o(a.certificate,a.intermediates);b.valid||c.push(b.error||"Chain verification warning")}else b.push("Invalid intermediate certificate format");if(d.info){let a=new Date,e=(d.info.validTo.getTime()-a.getTime())/864e5;e<0?b.push("Certificate has expired"):e<30&&c.push(`Certificate expires in ${Math.floor(e)} days`),d.info.validFrom>a&&c.push("Certificate is not yet valid (starts in the future)")}return{valid:0===b.length,errors:b,warnings:c,info:0===b.length&&d.info&&e.info?{subject:d.info.subject,issuer:d.info.issuer,validFrom:d.info.validFrom,validTo:d.info.validTo,domains:d.info.domains,keyType:e.info.keyType,keySize:e.info.keySize,hasIntermediates:f}:void 0}}async function q(a,b){let c=g.join("/etc/supascale/certificates",a);try{await f.mkdir(c,{recursive:!0,mode:448});let a=g.join(c,"cert.pem"),d=g.join(c,"privkey.pem.enc"),h=b.intermediates?g.join(c,"chain.pem"):void 0,i=g.join(c,"fullchain.pem");await f.writeFile(a,b.certificate,{mode:420}),await f.writeFile(d,(0,e.w)(b.privateKey),{mode:384}),b.intermediates&&h&&await f.writeFile(h,b.intermediates,{mode:420});let j=b.intermediates?b.certificate+"\n"+b.intermediates:b.certificate;await f.writeFile(i,j,{mode:420});let k=g.join(c,"metadata.json");return await f.writeFile(k,JSON.stringify({source:"custom",uploadedAt:new Date().toISOString(),hasIntermediates:!!b.intermediates}),{mode:420}),{success:!0,certPath:a,keyPath:d,chainPath:h,fullchainPath:i}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to save certificate"}}}},55511:a=>{"use strict";a.exports=require("crypto")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63516:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>D,patchFetch:()=>C,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var d={};c.r(d),c.d(d,{POST:()=>x});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(35552),w=c(50233);async function x(a,{params:b}){try{let{id:c}=await b,d=(0,v.getProject)(c);if(!d)return u.NextResponse.json({success:!1,error:"Project not found"},{status:404});let e=await a.json();if(!e.certificate)return u.NextResponse.json({success:!1,error:"Certificate is required"},{status:400});if(!e.privateKey)return u.NextResponse.json({success:!1,error:"Private key is required"},{status:400});let f=await (0,w.c6)({certificate:e.certificate,privateKey:e.privateKey,intermediates:e.intermediates}),g=!0,h="";if(d.domain?.name&&f.info){let a=d.domain.name.toLowerCase(),b=f.info.domains.map(a=>a.toLowerCase());(g=b.some(b=>{if(b===a)return!0;if(b.startsWith("*.")){let c=b.slice(2);return a.endsWith(c)||a===c}return!1}))||(h=`Certificate domains (${b.join(", ")}) do not match project domain (${a})`)}return u.NextResponse.json({success:!0,data:{valid:f.valid&&g,errors:[...f.errors,...g?[]:[h]],warnings:f.warnings,info:f.info?{subject:f.info.subject,issuer:f.info.issuer,validFrom:f.info.validFrom.toISOString(),validTo:f.info.validTo.toISOString(),domains:f.info.domains,keyType:f.info.keyType,keySize:f.info.keySize,hasIntermediates:f.info.hasIntermediates,domainMatch:g}:void 0}})}catch(a){return console.error("Error validating certificate:",a),u.NextResponse.json({success:!1,error:"Failed to validate certificate"},{status:500})}}let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/v1/projects/[id]/certificate/validate/route",pathname:"/api/v1/projects/[id]/certificate/validate",filename:"route",bundlePath:"app/api/v1/projects/[id]/certificate/validate/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/kevin/MAC_Desktop/Projects/Supascale-App/src/app/api/v1/projects/[id]/certificate/validate/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function C(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function D(a,b,c){var d;let e="/api/v1/projects/[id]/certificate/validate/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},78335:()=>{},79646:a=>{"use strict";a.exports=require("child_process")},79748:a=>{"use strict";a.exports=require("fs/promises")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87550:a=>{"use strict";a.exports=require("better-sqlite3")},95736:(a,b,c)=>{"use strict";a.exports=c(44870)},96487:()=>{}};var b=require("../../../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4586,9919,5552],()=>b(b.s=63516));module.exports=c})();