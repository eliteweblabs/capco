---
// Define requireAuthRedirect
const requireAuthRedirect = undefined;
// Make sure to check above value before redirecting
import { checkAuth } from "../lib/auth";
// Handle OAuth callback if code is present
const { currentUser, session, supabase } = await checkAuth(Astro.cookies);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "./api/global/global-company-data";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
  globalCompanyLogoDark,
  globalCompanyLogoLight,
} = globalCompanyData();
import App from "../components/common/App.astro";
import SlideToggle from "../components/common/SlideToggle.astro";
import Button from "../components/common/Button.astro";
---

<App
  title=`Cookie Preferences - ${globalCompanyName}`
  description=`Manage your cookie preferences and learn about how ${globalCompanyName} uses cookies to enhance your experience.`
  {globalCompanyName}
  {globalCompanySlogan}
  {globalCompanyAddress}
  {globalCompanyPhone}
  {globalCompanyEmail}
  {globalCompanyWebsite}
  {globalCompanyLogo}
  {globalCompanyLogoDark}
  {globalCompanyLogoLight}
>
  <div class="container mx-auto max-w-4xl px-4 py-8">
    <div class="prose prose-lg dark:prose-invert max-w-none">
      <h1 class="mb-8 text-3xl font-bold text-gray-900 dark:text-white">Cookie Preferences</h1>

      <div
        class="mb-8 rounded-lg border border-primary-200 bg-primary-50 p-6 dark:border-primary-800 dark:bg-primary-900/20"
      >
        <p class="mb-0 text-primary-800 dark:text-primary-200">
          <strong>Last Updated:</strong>
          {new Date().toLocaleDateString()}
        </p>
      </div>

      <p class="mb-8 text-gray-600 dark:text-gray-400">
        We use cookies and similar technologies to enhance your browsing experience, provide
        personalized content, and analyze our traffic. You can manage your cookie preferences below
        or learn more about our cookie usage in our <a
          href="/privacy-policy"
          class="text-primary-600 hover:underline dark:text-primary-400">Privacy Policy</a
        >.
      </p>

      <!-- Cookie Categories -->
      <div class="mb-8 space-y-6">
        <!-- Essential Cookies -->
        <div
          class="border-border-light dark:border-border-dark rounded-lg border p-6 dark:bg-gray-800"
        >
          <div class="mb-4 flex items-center justify-between">
            <div>
              <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">
                Essential Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                These cookies are necessary for the website to function and cannot be switched off.
              </p>
            </div>
            <div class="flex items-center">
              <span
                class="rounded-full bg-success-100 px-3 py-1 text-sm font-medium text-success-800 dark:bg-success-900/30 dark:text-success-200"
              >
                Always Active
              </span>
            </div>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            <p class="mb-2">These cookies enable basic functions like:</p>
            <ul class="list-inside list-disc space-y-1">
              <li>User authentication and session management</li>
              <li>Security features and fraud prevention</li>
              <li>Remembering your login status</li>
              <li>Basic website functionality</li>
            </ul>
          </div>
        </div>

        <!-- Analytics Cookies -->
        <div
          class="border-border-light dark:border-border-dark rounded-lg border p-6 dark:bg-gray-800"
        >
          <div class="mb-4 flex items-center justify-between">
            <div>
              <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">
                Analytics Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                These cookies help us understand how visitors interact with our website.
              </p>
            </div>
            <div class="flex items-center">
              <label class="relative inline-flex cursor-pointer items-center">
                <SlideToggle id="analytics-toggle" checked={true} />
                <!-- <input type="checkbox" class="peer sr-only" id="analytics-toggle" checked /> -->
                <!-- <div
                  class="peer h-6 w-11 rounded-full bg-neutral-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-neutral-300 after:bg-gray-100 after:transition-all after:content-[''] peer-checked:bg-primary-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:border-neutral-600 dark:bg-neutral-700 dark:peer-focus:ring-primary-800"
                > -->
              </label>
            </div>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            <p class="mb-2">These cookies collect anonymous information about:</p>
            <ul class="list-inside list-disc space-y-1">
              <li>Page views and user interactions</li>
              <li>Website performance and loading times</li>
              <li>Popular content and features</li>
              <li>Error tracking and debugging</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Functional Cookies -->
      <div
        class="border-border-light dark:border-border-dark rounded-lg border p-6 dark:bg-gray-800"
      >
        <div class="mb-4 flex items-center justify-between">
          <div>
            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">
              Functional Cookies
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              These cookies enable enhanced functionality and personalization.
            </p>
          </div>
          <div class="flex items-center">
            <label class="relative inline-flex cursor-pointer items-center">
              <!-- <input type="checkbox" class="peer sr-only" id="functional-toggle" checked /> -->
              <SlideToggle id="functional-toggle" checked={true} />
              <!-- <div
                  class="peer h-6 w-11 rounded-full bg-neutral-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-neutral-300 after:bg-gray-100 after:transition-all after:content-[''] peer-checked:bg-primary-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:border-neutral-600 dark:bg-neutral-700 dark:peer-focus:ring-primary-800"
                > -->
            </label>
          </div>
        </div>
        <div class="text-sm text-gray-500 dark:text-gray-400">
          <p class="mb-2">These cookies remember your preferences for:</p>
          <ul class="list-inside list-disc space-y-1">
            <li>Language and region settings</li>
            <li>Theme preferences (light/dark mode)</li>
            <li>Customized dashboard layouts</li>
            <li>Form auto-completion</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Marketing Cookies -->
    <div class="border-border-light dark:border-border-dark rounded-lg border p-6 dark:bg-gray-800">
      <div class="mb-4 flex items-center justify-between">
        <div>
          <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">
            Marketing Cookies
          </h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            These cookies are used to deliver relevant advertisements and track marketing campaigns.
          </p>
        </div>
        <div class="flex items-center">
          <label class="relative inline-flex cursor-pointer items-center">
            <!-- <input type="checkbox" class="peer sr-only" id="marketing-toggle" /> -->
            <SlideToggle id="marketing-toggle" checked={true} />
            <!-- <div
                  class="peer h-6 w-11 rounded-full bg-neutral-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-neutral-300 after:bg-gray-100 after:transition-all after:content-[''] peer-checked:bg-primary-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:border-neutral-600 dark:bg-neutral-700 dark:peer-focus:ring-primary-800"
                > -->
          </label>
        </div>
      </div>
      <div class="text-sm text-gray-500 dark:text-gray-400">
        <p class="mb-2">These cookies may be used to:</p>
        <ul class="list-inside list-disc space-y-1">
          <li>Show relevant advertisements</li>
          <li>Track campaign effectiveness</li>
          <li>Limit ad frequency</li>
          <li>Measure ad performance</li>
        </ul>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mb-8 flex flex-col gap-4 sm:flex-row">
      <Button id="save-preferences" variant="primary" size="md"> Save Preferences </Button>
      <Button id="accept-all" variant="success" size="md"> Accept All Cookies </Button>
      <Button id="reject-all" variant="secondary" size="md"> Reject All Optional </Button>
    </div>

    <!-- Additional Information -->
    <div class="rounded-lg bg-gray-50 p-6 dark:bg-gray-800">
      <h3 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">
        Additional Information
      </h3>
      <div class="space-y-4 text-sm text-gray-600 dark:text-gray-400">
        <p>
          <strong>Browser Settings:</strong> You can also manage cookies through your browser settings.
          Most browsers allow you to refuse cookies or delete them. However, disabling cookies may affect
          the functionality of our website.
        </p>
        <p>
          <strong>Third-Party Cookies:</strong> Some cookies on our website are set by third-party services
          that appear on our pages. We do not control these cookies, and you should check the third-party
          websites for more information about their cookies and how to manage them.
        </p>
        <p>
          <strong>Updates:</strong> We may update this Cookie Preferences page from time to time. Any
          changes will be posted on this page with an updated revision date.
        </p>
      </div>
    </div>

    <div class="mt-8 border-t border-gray-200 pt-6 dark:border-gray-700">
      <p class="text-sm text-gray-500 dark:text-gray-400">
        For more detailed information about our data practices, please review our
        <a href="/privacy-policy" class="text-primary-600 hover:underline dark:text-primary-400"
          >Privacy Policy</a
        >.
      </p>
    </div>
  </div>
</App>

<script>
  // Cookie preference management
  document.addEventListener("DOMContentLoaded", function () {
    const analyticsToggle = document.getElementById("analytics-toggle") as HTMLInputElement;
    const functionalToggle = document.getElementById("functional-toggle") as HTMLInputElement;
    const marketingToggle = document.getElementById("marketing-toggle") as HTMLInputElement;
    const saveBtn = document.getElementById("save-preferences") as HTMLButtonElement;
    const acceptAllBtn = document.getElementById("accept-all") as HTMLButtonElement;
    const rejectAllBtn = document.getElementById("reject-all") as HTMLButtonElement;

    // Load current preferences
    function loadPreferences() {
      const prefs = JSON.parse(localStorage.getItem("cookiePreferences") || "{}");
      analyticsToggle.checked = prefs.analytics !== false;
      functionalToggle.checked = prefs.functional !== false;
      marketingToggle.checked = prefs.marketing === true;
    }

    // Save preferences
    function savePreferences() {
      const preferences = {
        analytics: analyticsToggle.checked,
        functional: functionalToggle.checked,
        marketing: marketingToggle.checked,
        timestamp: new Date().toISOString(),
      };
      localStorage.setItem("cookiePreferences", JSON.stringify(preferences));

      // Show confirmation using unified notification
      if ((window as any).showModal) {
        (window as any).showModal(
          "success",
          "Preferences Saved",
          "Your cookie preferences have been saved successfully!",
          3000
        );
      } else {
        alert("Your cookie preferences have been saved!");
      }
    }

    // Accept all
    function acceptAll() {
      analyticsToggle.checked = true;
      functionalToggle.checked = true;
      marketingToggle.checked = true;
      savePreferences();
    }

    // Reject all optional
    function rejectAll() {
      analyticsToggle.checked = false;
      functionalToggle.checked = false;
      marketingToggle.checked = false;
      savePreferences();
    }

    // Event listeners
    saveBtn.addEventListener("click", savePreferences);
    acceptAllBtn.addEventListener("click", acceptAll);
    rejectAllBtn.addEventListener("click", rejectAll);

    // Load preferences on page load
    loadPreferences();
  });
</script>
