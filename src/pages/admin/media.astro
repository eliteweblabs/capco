---
/**
 * Media Manager Admin Page
 * Uses AdminMedia component for the main content
 */
const requireAuthRedirect = "/auth/login";
import { checkAuth } from "../../lib/auth";

const { currentUser, session, supabase } = await checkAuth(Astro.cookies);
const currentRole = currentUser?.profile?.role;

// Handle auth redirect - Admin only
if (requireAuthRedirect && (!session || !currentUser || currentRole !== "Admin")) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "../api/global/global-company-data";
const { globalCompanyName, globalCompanySlogan, globalCompanyLogo } = await globalCompanyData();

import { globalClasses } from "../api/global/global-classes";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

import App from "../../components/ui/App.astro";
import AdminMedia from "../../components/admin/AdminMedia.astro";
---

<App
  title={`Media Manager - ${globalCompanyName}`}
  description="Manage all media files"
  {currentUser}
  {session}
  {supabase}
  isBackend={true}
  {globalCompanyName}
  {globalCompanySlogan}
  {globalCompanyLogo}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalInputClasses}
>
  <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <AdminMedia
      {currentUser}
      {supabase}
      {globalInputClasses}
    />
  </div>
</App>
