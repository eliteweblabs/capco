---
import { checkAuth } from "../../lib/auth";
import { supabaseAdmin } from "../../lib/supabase-admin";
import App from "../../components/common/App.astro";
import Alert from "../../components/partials/Alert.astro";

import { globalCompanyData } from "../api/global/global-company-data";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
} = await globalCompanyData();

import { globalClasses } from "../api/global/global-classes";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

// Check authentication
const { currentUser, session, supabase } = await checkAuth(Astro.cookies);

if (!currentUser) {
  return Astro.redirect("/auth/login");
}

// Check if user is admin
const { data: profile } = await supabase
  .from("profiles")
  .select("role")
  .eq("id", currentUser.id)
  .single();

if (profile?.role !== "Admin") {
  return Astro.redirect("/dashboard");
}

// Get all banner alerts
let bannerAlerts: any[] = [];
if (supabaseAdmin) {
  const { data, error } = await supabaseAdmin
    .from("bannerAlerts")
    .select("*")
    .order("createdAt", { ascending: false });

  if (error) {
    console.error("Error fetching banner alerts:", error);
  } else {
    bannerAlerts = data || [];
  }
}

// Type options
const typeOptions = [
  { value: "info", label: "Info", color: "blue" },
  { value: "success", label: "Success", color: "green" },
  { value: "warning", label: "Warning", color: "orange" },
  { value: "error", label: "Error", color: "red" },
];

// Position options
const positionOptions = [
  { value: "top", label: "Top" },
  { value: "bottom", label: "Bottom" },
];

// Expire options
const expireOptions = [
  { value: "", label: "Never" },
  { value: "3000", label: "3 seconds" },
  { value: "5000", label: "5 seconds" },
  { value: "10000", label: "10 seconds" },
  { value: "30000", label: "30 seconds" },
  { value: "60000", label: "1 minute" },
  { value: "300000", label: "5 minutes" },
];
---

<App
  title="Banner Alerts"
  description="Manage site-wide banner alerts"
  {currentUser}
  {session}
  {supabase}
  supabaseUrl={import.meta.env.PUBLIC_SUPABASE_URL}
  isBackend={true}
  {globalInputClasses}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalCompanyName}
  {globalCompanyAddress}
  {globalCompanyPhone}
  {globalCompanyEmail}
  {globalCompanyWebsite}
  {globalCompanyLogo}
>
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Banner Alerts</h1>
    <p class="mt-2 text-gray-600 dark:text-gray-400">
      Manage site-wide banner alerts that appear at the top or bottom of the page
    </p>
  </div>

  <!-- Create/Edit Form -->
  <div class="mb-8 rounded-lg bg-gray-100 shadow-md dark:bg-gray-800 dark:shadow-gray-700">
    <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-700">
      <h2 id="form-title" class="text-lg font-medium text-gray-900 dark:text-white">
        Create New Banner Alert
      </h2>
    </div>

    <form id="banner-form" class="space-y-6 p-6">
      <input type="hidden" id="banner-id" name="id" />

      <!-- Preview -->
      <div id="banner-preview" class="mb-6">
        <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
          >Preview</label
        >
        <div id="preview-container">
          <Alert
            type="info"
            title="Banner Title"
            description="Banner description will appear here..."
          />
        </div>
      </div>

      <!-- Title -->
      <div>
        <label for="title" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
          Title (optional)
        </label>
        <input
          type="text"
          id="title"
          name="title"
          class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          placeholder="Optional title for the banner"
        />
      </div>

      <!-- Description -->
      <div>
        <label
          for="description"
          class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
        >
          Description
        </label>
        <textarea
          id="description"
          name="description"
          rows="3"
          class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          placeholder="Banner message content"></textarea>
      </div>

      <!-- Type, Position, Expire -->
      <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
        <div>
          <label for="type" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
            >Type</label
          >
          <select
            id="type"
            name="type"
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          >
            {typeOptions.map((opt) => <option value={opt.value}>{opt.label}</option>)}
          </select>
        </div>

        <div>
          <label
            for="position"
            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Position</label
          >
          <select
            id="position"
            name="position"
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          >
            {positionOptions.map((opt) => <option value={opt.value}>{opt.label}</option>)}
          </select>
        </div>

        <div>
          <label
            for="expireMs"
            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
            >Auto-Expire</label
          >
          <select
            id="expireMs"
            name="expireMs"
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          >
            {expireOptions.map((opt) => <option value={opt.value}>{opt.label}</option>)}
          </select>
        </div>
      </div>

      <!-- Dismissible and Active toggles -->
      <div class="flex flex-wrap gap-6">
        <label class="inline-flex cursor-pointer items-center">
          <input type="checkbox" id="dismissible" name="dismissible" checked class="peer sr-only" />
          <div
            class="peer relative h-6 w-11 rounded-full bg-gray-200 after:absolute after:start-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-primary-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-primary-800 rtl:peer-checked:after:-translate-x-full"
          >
          </div>
          <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Dismissible</span>
        </label>

        <label class="inline-flex cursor-pointer items-center">
          <input type="checkbox" id="isActive" name="isActive" checked class="peer sr-only" />
          <div
            class="peer relative h-6 w-11 rounded-full bg-gray-200 after:absolute after:start-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-green-600 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-green-800 rtl:peer-checked:after:-translate-x-full"
          >
          </div>
          <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Active</span>
        </label>
      </div>

      <!-- Date Range (optional) -->
      <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <div>
          <label
            for="startDate"
            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            Start Date (optional)
          </label>
          <input
            type="datetime-local"
            id="startDate"
            name="startDate"
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          />
        </div>

        <div>
          <label
            for="endDate"
            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            End Date (optional)
          </label>
          <input
            type="datetime-local"
            id="endDate"
            name="endDate"
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
          />
        </div>
      </div>

      <!-- Shortcode Display -->
      <div id="shortcode-section" class="hidden">
        <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
          >Shortcode</label
        >
        <div class="flex items-center gap-2">
          <code
            id="shortcode-display"
            class="flex-1 rounded bg-gray-200 px-3 py-2 font-mono text-sm dark:bg-gray-700 dark:text-gray-300"
          ></code>
          <button
            type="button"
            id="copy-shortcode"
            class="rounded bg-gray-200 px-3 py-2 text-sm hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600"
          >
            <i class="bx bx-copy"></i>
          </button>
        </div>
        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
          Use this shortcode in markdown content to display this banner
        </p>
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-3">
        <button
          type="button"
          id="cancel-btn"
          class="hidden rounded-md border border-gray-300 px-6 py-2 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"
        >
          Cancel
        </button>
        <button
          type="submit"
          id="submit-btn"
          class="rounded-md bg-primary-600 px-6 py-2 text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
        >
          Create Banner
        </button>
      </div>
    </form>
  </div>

  <!-- Existing Banners -->
  <div class="rounded-lg bg-gray-100 shadow-md dark:bg-gray-800 dark:shadow-gray-700">
    <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-700">
      <h2 class="text-lg font-medium text-gray-900 dark:text-white">Existing Banner Alerts</h2>
    </div>
    <div id="banners-list" class="p-6">
      {
        bannerAlerts.length > 0 ? (
          <div class="space-y-4">
            {bannerAlerts.map((banner) => (
              <div
                class={`rounded-lg border p-4 ${banner.isActive ? "border-green-300 bg-green-50 dark:border-green-700 dark:bg-green-900/20" : "border-gray-300 bg-gray-50 dark:border-gray-600 dark:bg-gray-700/50"}`}
                data-banner-item={banner.id}
              >
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <span
                        class={`inline-flex items-center rounded px-2 py-0.5 text-xs font-medium ${
                          banner.type === "info"
                            ? "bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"
                            : banner.type === "success"
                              ? "bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"
                              : banner.type === "warning"
                                ? "bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300"
                                : "bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"
                        }`}
                      >
                        {banner.type}
                      </span>
                      <span
                        class={`inline-flex items-center rounded px-2 py-0.5 text-xs font-medium ${
                          banner.position === "top"
                            ? "bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300"
                            : "bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300"
                        }`}
                      >
                        {banner.position}
                      </span>
                      {banner.expireMs && (
                        <span class="inline-flex items-center rounded bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                          {banner.expireMs / 1000}s expire
                        </span>
                      )}
                      {!banner.isActive && (
                        <span class="inline-flex items-center rounded bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                          Inactive
                        </span>
                      )}
                    </div>
                    {banner.title && (
                      <h3 class="mt-2 font-medium text-gray-900 dark:text-white">{banner.title}</h3>
                    )}
                    <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                      {banner.description}
                    </p>
                    <p class="mt-2 text-xs text-gray-400 dark:text-gray-500">
                      Created: {new Date(banner.createdAt).toLocaleString()}
                    </p>
                  </div>
                  <div class="flex gap-2">
                    <button
                      type="button"
                      class="edit-banner-btn rounded p-2 text-gray-500 hover:bg-gray-200 hover:text-gray-700 dark:hover:bg-gray-600 dark:hover:text-gray-300"
                      data-id={banner.id}
                      data-title={banner.title || ""}
                      data-description={banner.description || ""}
                      data-type={banner.type || "info"}
                      data-position={banner.position || "top"}
                      data-expire-ms={banner.expireMs || ""}
                      data-dismissible={banner.dismissible !== false}
                      data-is-active={banner.isActive !== false}
                      data-start-date={banner.startDate || ""}
                      data-end-date={banner.endDate || ""}
                      title="Edit"
                    >
                      <i class="bx bx-edit text-lg" />
                    </button>
                    <button
                      type="button"
                      class="toggle-banner-btn rounded p-2 text-gray-500 hover:bg-gray-200 hover:text-gray-700 dark:hover:bg-gray-600 dark:hover:text-gray-300"
                      data-id={banner.id}
                      data-active={banner.isActive}
                      title={banner.isActive ? "Deactivate" : "Activate"}
                    >
                      <i class={`bx ${banner.isActive ? "bx-hide" : "bx-show"} text-lg`} />
                    </button>
                    <button
                      type="button"
                      class="delete-banner-btn rounded p-2 text-red-500 hover:bg-red-100 hover:text-red-700 dark:hover:bg-red-900/50"
                      data-id={banner.id}
                      title="Delete"
                    >
                      <i class="bx bx-trash text-lg" />
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <p class="text-gray-500 dark:text-gray-400">No banner alerts created yet</p>
        )
      }
    </div>
  </div>
</App>

<script>
  class BannerAlertsManager {
    private form: HTMLFormElement | null;
    private editingId: number | null = null;

    constructor() {
      this.form = document.getElementById("banner-form") as HTMLFormElement;
      this.init();
    }

    private init(): void {
      this.bindFormEvents();
      this.bindListEvents();
      this.updatePreview();
    }

    private bindFormEvents(): void {
      if (!this.form) return;

      this.form.addEventListener("submit", (e) => this.handleSubmit(e));

      // Live preview updates
      const inputs = ["title", "description", "type"];
      inputs.forEach((id) => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener("input", () => this.updatePreview());
          el.addEventListener("change", () => this.updatePreview());
        }
      });

      // Cancel button
      document.getElementById("cancel-btn")?.addEventListener("click", () => this.resetForm());
    }

    private bindListEvents(): void {
      // Edit buttons
      document.querySelectorAll(".edit-banner-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const banner = {
            id: parseInt(target.dataset.id || "0"),
            title: target.dataset.title || "",
            description: target.dataset.description || "",
            type: target.dataset.type || "info",
            position: target.dataset.position || "top",
            expireMs: target.dataset.expireMs ? parseInt(target.dataset.expireMs) : null,
            dismissible: target.dataset.dismissible === "true",
            isActive: target.dataset.isActive === "true",
            startDate: target.dataset.startDate || null,
            endDate: target.dataset.endDate || null,
          };
          this.editBanner(banner);
        });
      });

      // Toggle buttons
      document.querySelectorAll(".toggle-banner-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const id = parseInt(target.dataset.id || "0");
          const isActive = target.dataset.active === "true";
          this.toggleBanner(id, !isActive);
        });
      });

      // Delete buttons
      document.querySelectorAll(".delete-banner-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const id = parseInt(target.dataset.id || "0");
          this.deleteBanner(id);
        });
      });

      // Copy shortcode
      document.getElementById("copy-shortcode")?.addEventListener("click", () => {
        const shortcode = document.getElementById("shortcode-display")?.textContent;
        if (shortcode) {
          navigator.clipboard.writeText(shortcode);
          window.showModal?.("success", "Shortcode copied to clipboard!");
        }
      });
    }

    private updatePreview(): void {
      const title = (document.getElementById("title") as HTMLInputElement)?.value || "";
      const description =
        (document.getElementById("description") as HTMLTextAreaElement)?.value ||
        "Banner description...";
      const type = (document.getElementById("type") as HTMLSelectElement)?.value || "info";

      const typeConfig: Record<string, { icon: string; bg: string; border: string; text: string }> =
        {
          info: {
            icon: "bx-info-circle",
            bg: "bg-primary-50 dark:bg-primary-900/20",
            border: "border-primary-200 dark:border-primary-800",
            text: "text-primary-800 dark:text-primary-400",
          },
          success: {
            icon: "bx-check-circle",
            bg: "bg-green-50 dark:bg-green-900/20",
            border: "border-green-200 dark:border-green-800",
            text: "text-green-800 dark:text-green-400",
          },
          warning: {
            icon: "bx-error",
            bg: "bg-orange-50 dark:bg-orange-900/20",
            border: "border-orange-200 dark:border-orange-800",
            text: "text-orange-800 dark:text-orange-400",
          },
          error: {
            icon: "bx-x-circle",
            bg: "bg-red-50 dark:bg-red-900/20",
            border: "border-red-200 dark:border-red-800",
            text: "text-red-800 dark:text-red-400",
          },
        };

      const config = typeConfig[type] || typeConfig.info;

      const container = document.getElementById("preview-container");
      if (container) {
        container.innerHTML = `
          <div class="rounded-lg border p-4 ${config.bg} ${config.border}">
            <div class="flex items-start">
              <i class="bx ${config.icon} mr-2 mt-0.5 text-lg ${config.text}"></i>
              <div class="flex-1">
                ${title ? `<div class="text-base ${config.text}">${title}</div>` : ""}
                <div class="mt-1 text-sm ${config.text}">${description}</div>
              </div>
            </div>
          </div>
        `;
      }
    }

    private editBanner(banner: any): void {
      this.editingId = banner.id;

      // Update form values
      (document.getElementById("banner-id") as HTMLInputElement).value = banner.id;
      (document.getElementById("title") as HTMLInputElement).value = banner.title || "";
      (document.getElementById("description") as HTMLTextAreaElement).value =
        banner.description || "";
      (document.getElementById("type") as HTMLSelectElement).value = banner.type || "info";
      (document.getElementById("position") as HTMLSelectElement).value = banner.position || "top";
      (document.getElementById("expireMs") as HTMLSelectElement).value =
        banner.expireMs?.toString() || "";
      (document.getElementById("dismissible") as HTMLInputElement).checked =
        banner.dismissible !== false;
      (document.getElementById("isActive") as HTMLInputElement).checked = banner.isActive !== false;

      // Handle dates
      if (banner.startDate) {
        const startDate = new Date(banner.startDate);
        (document.getElementById("startDate") as HTMLInputElement).value = startDate
          .toISOString()
          .slice(0, 16);
      }
      if (banner.endDate) {
        const endDate = new Date(banner.endDate);
        (document.getElementById("endDate") as HTMLInputElement).value = endDate
          .toISOString()
          .slice(0, 16);
      }

      // Update UI
      document.getElementById("form-title")!.textContent = "Edit Banner Alert";
      document.getElementById("submit-btn")!.textContent = "Update Banner";
      document.getElementById("cancel-btn")?.classList.remove("hidden");

      // Show shortcode
      const shortcodeSection = document.getElementById("shortcode-section");
      const shortcodeDisplay = document.getElementById("shortcode-display");
      if (shortcodeSection && shortcodeDisplay) {
        shortcodeSection.classList.remove("hidden");
        shortcodeDisplay.textContent = `<BannerAlert id="${banner.id}"/>`;
      }

      this.updatePreview();

      // Scroll to form
      this.form?.scrollIntoView({ behavior: "smooth" });
    }

    private resetForm(): void {
      this.editingId = null;
      this.form?.reset();
      (document.getElementById("banner-id") as HTMLInputElement).value = "";
      document.getElementById("form-title")!.textContent = "Create New Banner Alert";
      document.getElementById("submit-btn")!.textContent = "Create Banner";
      document.getElementById("cancel-btn")?.classList.add("hidden");
      document.getElementById("shortcode-section")?.classList.add("hidden");
      this.updatePreview();
    }

    private async handleSubmit(e: Event): Promise<void> {
      e.preventDefault();

      const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
      const originalText = submitBtn?.textContent;

      try {
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = "Saving...";
        }

        const formData = new FormData(this.form!);
        const expireMsValue = formData.get("expireMs") as string;

        const data = {
          id: this.editingId || undefined,
          title: (formData.get("title") as string) || null,
          description: formData.get("description") as string,
          type: formData.get("type") as string,
          position: formData.get("position") as string,
          expireMs: expireMsValue ? parseInt(expireMsValue) : null,
          dismissible: (document.getElementById("dismissible") as HTMLInputElement).checked,
          isActive: (document.getElementById("isActive") as HTMLInputElement).checked,
          startDate: (formData.get("startDate") as string) || null,
          endDate: (formData.get("endDate") as string) || null,
        };

        const response = await fetch("/api/banner-alerts/upsert", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.success) {
          window.showModal?.("success", result.message);
          setTimeout(() => window.location.reload(), 1000);
        } else {
          window.showModal?.("error", result.error || "Failed to save banner");
        }
      } catch (error) {
        console.error("Error saving banner:", error);
        window.showModal?.("error", "Error saving banner");
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText || "Save";
        }
      }
    }

    private async toggleBanner(id: number, isActive: boolean): Promise<void> {
      try {
        const response = await fetch("/api/banner-alerts/upsert", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id, isActive }),
        });

        const result = await response.json();

        if (result.success) {
          window.showModal?.("success", `Banner ${isActive ? "activated" : "deactivated"}`);
          setTimeout(() => window.location.reload(), 1000);
        } else {
          window.showModal?.("error", result.error || "Failed to update banner");
        }
      } catch (error) {
        console.error("Error toggling banner:", error);
        window.showModal?.("error", "Error updating banner");
      }
    }

    private async deleteBanner(id: number): Promise<void> {
      if (!confirm("Are you sure you want to delete this banner?")) return;

      try {
        const response = await fetch("/api/banner-alerts/delete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id }),
        });

        const result = await response.json();

        if (result.success) {
          window.showModal?.("success", "Banner deleted");
          document.querySelector(`[data-banner-item="${id}"]`)?.remove();
        } else {
          window.showModal?.("error", result.error || "Failed to delete banner");
        }
      } catch (error) {
        console.error("Error deleting banner:", error);
        window.showModal?.("error", "Error deleting banner");
      }
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", () => {
    new BannerAlertsManager();
  });
</script>
