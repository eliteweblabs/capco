---
/**
 * User Management Admin Page
 * Uses AdminUsers component for the main content
 */
const requireAuthRedirect = "/auth/login";
import { checkAuth } from "../../lib/auth";

const { currentUser, session, supabase } = await checkAuth(Astro.cookies);

// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser || currentUser?.profile?.role !== "Admin")) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalClasses } from "../api/global/global-classes.ts";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

import LayoutDefault from "../../components/layouts/LayoutDefault.astro";
import AdminUsers from "../../components/admin/AdminUsers.astro";
---

<LayoutDefault title="User Management" description="Manage all system users">
  <script src="../../lib/refresh-manager.ts"></script>
  <AdminUsers
    {currentUser}
    {supabase}
    {globalInputClasses}
    {primaryTextClasses}
    {secondaryTextClasses}
  />
</LayoutDefault>
