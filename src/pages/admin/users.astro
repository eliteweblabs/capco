---
/**
 * User Management Admin Page
 * Uses AdminUsers component for the main content
 */
const requireAuthRedirect = "/auth/login";
import { checkAuth } from "../../lib/auth";

const { currentUser, session, supabase } = await checkAuth(Astro.cookies);

// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser || currentUser?.profile?.role !== "Admin")) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "../api/global/global-company-data.ts";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
} = await globalCompanyData();

import { globalClasses } from "../api/global/global-classes.ts";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

import App from "../../components/ui/App.astro";
import AdminUsers from "../../components/admin/AdminUsers.astro";
import "../../lib/refresh-manager.ts";
---

<App
  title={`User Management - ${globalCompanyName}`}
  description={`Manage all system users for ${globalCompanyName}`}
  {currentUser}
  session={session || undefined}
  {supabase}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalInputClasses}
  {globalCompanyName}
  {globalCompanySlogan}
  {globalCompanyAddress}
  {globalCompanyPhone}
  {globalCompanyEmail}
  {globalCompanyWebsite}
  {globalCompanyLogo}
>
  <AdminUsers
    {currentUser}
    {supabase}
    {globalInputClasses}
    {primaryTextClasses}
    {secondaryTextClasses}
  />
</App>
