---
/**
 * Newsletter Management Admin Page
 * Admin-only page for creating and sending newsletters
 */
const requireAuthRedirect = "/auth/login";
import { checkAuth } from "../../lib/auth";

const { currentUser, session, supabase } = await checkAuth(Astro.cookies);

// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser || currentUser?.profile?.role !== "Admin")) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "../api/global/global-company-data";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
} = await globalCompanyData();

import { globalClasses } from "../api/global/global-classes";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

import App from "../../components/ui/App.astro";
import Hero from "../../components/common/Hero.astro";
import NewsletterManager from "../../features/newsletters/components/NewsletterManager.astro";
---

<App
  title={`Newsletter Management`}
  description={`Manage and send newsletters for ${globalCompanyName}`}
  {currentUser}
  session={session || undefined}
  {supabase}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalInputClasses}
  {globalCompanyName}
  {globalCompanySlogan}
  {globalCompanyAddress}
  {globalCompanyPhone}
  {globalCompanyEmail}
  {globalCompanyWebsite}
  {globalCompanyLogo}
>
  <Hero
    title="Newsletter Management"
    description="Create and manage newsletters to send to users via email and SMS"
    {primaryTextClasses}
    {secondaryTextClasses}
  />

  <NewsletterManager />
</App>
