---
/**
 * Design demo: MultiStepForm
 * Multi-step form driven by JSON config (progress bar, steps, buttons).
 */
import { checkAuth } from "../../../lib/auth";
import LayoutFullWidth from "../../../components/layouts/LayoutFullWidth.astro";
import MultiStepForm from "../../../features/forms/components/MultiStepForm.astro";
import type { MultiStepFormConfig } from "../../../lib/multi-step-form-config";
import { globalClasses } from "../../api/global/global-classes";

const { currentUser, session } = await checkAuth(Astro.cookies);
const currentRole = currentUser?.profile?.role;

if (!currentUser || !session) {
  return Astro.redirect("/auth/login");
}
if (currentRole !== "Admin") {
  return Astro.redirect("/dashboard");
}

const { primaryTextClasses, mutedTextClasses, globalCardStyle } = globalClasses();

const demoConfig: MultiStepFormConfig = {
  formId: "design-multistep-demo",
  formAction: "#",
  formMethod: "post",
  layout: "multi-step",
  totalSteps: 4,
  progressBar: true,
  responseType: "toast",
  steps: [
    {
      stepNumber: 1,
      title: "Your name",
      fieldLayout: "single",
      response: true,
      fields: [
        {
          id: "step-name",
          name: "fullName",
          type: "text",
          label: "Full name",
          placeholder: "Jane Doe",
          required: true,
        },
      ],
      buttons: [{ type: "next", dataNext: 2 }],
    },
    {
      stepNumber: 2,
      title: "Email",
      fieldLayout: "single",
      response: true,
      fields: [
        {
          id: "step-email",
          name: "email",
          type: "email",
          label: "Email",
          placeholder: "you@example.com",
          required: true,
        },
      ],
      buttons: [
        { type: "prev", dataPrev: 1 },
        { type: "next", dataNext: 3 },
      ],
    },
    {
      stepNumber: 3,
      title: "Message",
      fieldLayout: "single",
      response: true,
      fields: [
        {
          id: "step-message",
          name: "message",
          type: "textarea",
          label: "Message",
          placeholder: "How can we help?",
          rows: 4,
        },
      ],
      buttons: [
        { type: "prev", dataPrev: 2 },
        { type: "next", dataNext: 4 },
      ],
    },
    {
      stepNumber: 4,
      title: "Done",
      subtitle: "Review and submit",
      response: true,
      fields: [],
      buttons: [
        { type: "prev", dataPrev: 3 },
        { type: "submit", label: "Submit", variant: "primary" },
      ],
    },
  ],
};
---

<LayoutFullWidth
  title="MultiStepForm Demo"
  classList="p-4"
  description="Multi-step form component driven by JSON config. Used for contact, register, MEP, etc."
>
  <div class="px-4 py-8">
    <h1 class={`mb-2 text-3xl font-bold ${primaryTextClasses}`}>MultiStepForm</h1>
    <p class={`mb-6 ${mutedTextClasses}`}>
      JSON-driven multi-step form with progress bar, prev/next, and configurable steps. <a
        href="/admin/design/placeholders"
        class="text-primary-500 hover:underline">Placeholders</a
      > for template variables.
    </p>

    <div
      class={`${globalCardStyle} p-6`}
    >
      <h2 class={`${primaryTextClasses} mb-4 text-xl font-semibold`}>Demo (4 steps)</h2>
      <MultiStepForm config={demoConfig} />
    </div>
  </div>
</LayoutFullWidth>
