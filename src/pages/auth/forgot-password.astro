---
// Forgot password page - request reset email using MultiStepForm

import { checkAuth } from "../../lib/auth";

const authResult = await checkAuth(Astro.cookies);
const { isAuth } = authResult;

// Redirect authenticated users
if (isAuth) {
  return Astro.redirect("/project/dashboard");
}

import LayoutTwoColumn from "../../components/layouts/LayoutTwoColumn.astro";
import MultiStepForm from "../../components/form/MultiStepForm.astro";
import { forgotPasswordFormConfig } from "../../lib/forms/forgot-password-form-config";
import DotGrid from "../../components/ui/DotGrid.astro";
---

<LayoutTwoColumn
  title="Forgot Password"
  description="Enter your email and we'll send you a reset link"
  ratio="2/3"
  hideFooter={true}
>
  <div slot="left" class="hidden max-w-md md:block">
    <DotGrid
      id="dotGrid"
      class="absolute inset-0 -z-10 min-h-full w-full"
      spacing="1rem"
      baseOpacity={0.35}
      dotColor="primary-500"
    />
  </div>
  <div slot="right" class="color-background max-w-md">
    <MultiStepForm
      config={forgotPasswordFormConfig}
      containerClass="max-w-md"
      testNoCascade={true}
    />
  </div>
</LayoutTwoColumn>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get("error");
    const message = urlParams.get("message");

    if (error && (window as any).showNotice) {
      (window as any).showNotice({
        type: "error",
        title: "Error",
        message: message || error,
        persist: true,
      });
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  });
</script>
