---
// Forgot password page - request reset email using MultiStepForm

import { checkAuth } from "../../lib/auth";

const authResult = await checkAuth(Astro.cookies);
const { isAuth } = authResult;

// Redirect authenticated users
if (isAuth) {
  return Astro.redirect("/project/dashboard");
}

import { forgotPasswordFormConfig } from "../../lib/forms/forgot-password-form-config";
import LayoutFullForm from "../../components/layouts/LayoutFullForm.astro";
import ConfigForm from "../../features/forms/components/ConfigForm.astro";
---

<LayoutFullForm
  title="Forgot Password"
  description="Enter your email and we'll send you a reset link"
>
  <ConfigForm config={forgotPasswordFormConfig} />
</LayoutFullForm>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get("error");
    const message = urlParams.get("message");

    if (error && window.showNotice) {
      window.showNotice({
        type: "error",
        title: "Error",
        message: message || error,
        persist: true,
      });
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  });
</script>
