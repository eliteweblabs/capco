---
import { checkAuth } from "../lib/auth";
const { currentUser, session, supabase } = await checkAuth(Astro.cookies);

import { globalCompanyData } from "./api/global/global-company-data";
const { globalCompanyName } = globalCompanyData();

import { globalClasses } from "./api/global/global-classes";
const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

// NEW: Import content system
import { getPageContent, getSiteConfig } from "../lib/content";
const pageContent = await getPageContent('contact');
const siteConfig = getSiteConfig();

// Redirect to 404 if no content
if (!pageContent) {
  return Astro.redirect("/404");
}

import App from "../components/common/App.astro";
// import ContactFormWithUpload from "../components/common/ContactFormWithUpload.astro";
import Hero from "../components/common/Hero.astro";
---

<App
  title={`${pageContent.title} - ${siteConfig.site.name}`}
  description={pageContent.description || "Contact us for more information"}
  {currentUser}
  {session}
  {supabase}
  {globalCompanyName}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalInputClasses}
>
  <!-- Dashboard Container  -->

  <Hero
    title={pageContent.hero?.title || pageContent.title}
    description={pageContent.hero?.subtitle || `Get in touch with ${globalCompanyName} for all your fire protection needs.`}
    {primaryTextClasses}
    {secondaryTextClasses}
    {globalInputClasses}
  />

  {pageContent.showForm !== false && pageContent.formUrl && (
    <iframe
      src={pageContent.formUrl}
      style="width:100%;height:100%;border:none;border-radius:3px"
      id="inline-contact-form"
      data-layout="{'id':'INLINE'}"
      data-trigger-type="alwaysShow"
      data-trigger-value=""
      data-activation-type="alwaysActivated"
      data-activation-value=""
      data-deactivation-type="neverDeactivate"
      data-deactivation-value=""
      data-form-name="Contact Us"
      data-height="740"
      data-layout-iframe-id="inline-contact-form"
      title={pageContent.title}
    >
    </iframe>
    <script src="https://link.msgsndr.com/js/form_embed.js"></script>
  )}

  {pageContent.content && (
    <div class="prose dark:prose-invert max-w-4xl mx-auto my-8 px-4">
      <div set:html={pageContent.content} />
    </div>
  )}

  <!-- <ContactFormWithUpload {globalInputClasses} /> -->
</App>
