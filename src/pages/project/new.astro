---
// import { navigation } from "@/pages/api/navigation";

// interface Props {
//   requireAuthRedirect?: string;
//   title?: string;
//   description?: string;
//   currentUser?: any;
//   session?: any;
//   project?: any;
//   supabase?: any;
//   supabaseAdmin?: any;
// }

const requireAuthRedirect = undefined;
import { checkAuth } from "../../lib/auth";
import { isBackendPage } from "../../pages/api/backend-page-check";

const isBackend = isBackendPage(Astro.url.pathname);

const { currentUser, session, supabase, refreshToken, accessToken } = await checkAuth(
  Astro.cookies
);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "../../pages/api/global-company-data";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
  globalCompanyLogoDark,
  globalCompanyLogoLight,
} = globalCompanyData();

import { globalClasses } from "../../pages/api/global-classes";
const { globalInputClasses, globalPrimaryTextClasses, globalSecondaryTextClasses } =
  globalClasses();

const currentRole = currentUser?.profile.role;
const currentUserId = currentUser?.id;

import App from "../../components/common/App.astro";
import Hero from "../../components/common/Hero.astro";
import ProjectForm from "../../components/project/ProjectForm.astro";

// Fetch project statuses using the unified API
const statusApiUrl = new URL("/api/project-statuses", Astro.url.origin);
const statusResponse = await fetch(statusApiUrl.toString(), {
  method: "GET",
  headers: {
    Cookie: Astro.request.headers.get("Cookie") || "",
  },
});

const statusResponseData = await statusResponse.json();
const statusData = statusResponseData.statuses || [];

// Get auth data for conditional rendering
---

<App
  title="New Project"
  description="Create a new project"
  currentUser={currentUser}
  session={session || undefined}
  project={undefined}
  supabase={supabase}
  isBackend={isBackend}
  globalCompanyName={globalCompanyName}
  globalCompanySlogan={globalCompanySlogan}
  globalPrimaryTextClasses={globalPrimaryTextClasses}
  globalSecondaryTextClasses={globalSecondaryTextClasses}
  globalInputClasses={globalInputClasses}
>
  <div
    id="main-content"
    class="h-100 12rem-REMOVED relative w-full overflow-x-scroll bg-gray-50 dark:bg-gray-900"
  >
    <main>
      <div class="px-4 pt-4">
        <div class="rounded-md bg-gray-100 p-4 shadow-sm dark:bg-gray-800 md:p-6">
          <Hero
            title="Create a New Project"
            description=""
            globalPrimaryTextClasses={globalPrimaryTextClasses}
            globalSecondaryTextClasses={globalSecondaryTextClasses}
            globalInputClasses={globalInputClasses}
          />
        </div>
      </div>

      <div class="px-4 pt-4">
        <div
          class="veJTCIb2WII7J4sY22F rounded-md bg-gray-100 p-4 shadow-sm dark:bg-gray-800 md:p-6"
        >
          <ProjectForm
            currentUser={currentUser}
            isNewProject={true}
            project={undefined}
            projectStatus={0}
            globalInputClasses={globalInputClasses}
            globalSecondaryTextClasses={globalSecondaryTextClasses}
            globalPrimaryTextClasses={globalPrimaryTextClasses}
          />
        </div>
      </div>
    </main>
  </div>
</App>
