---
/**
 * Hybrid Contact Page
 * Offers users a choice between conversational chat interface or traditional form
 */

import App from "../components/ui/App.astro";
import VapiChatInterface from "../components/chat/VapiChatInterface.astro";
import MultiStepForm from "../features/forms/components/MultiStepForm.astro";
import { getContactFormConfig } from "../lib/forms/form-config-from-site";
import { buildFormInitialDataFromUser } from "../lib/forms/form-initial-data-from-user";
import { checkAuth } from "../lib/auth";
import { globalCompanyData } from "../pages/api/global/global-company-data";

const { currentUser } = await checkAuth(Astro.cookies);
const { globalCompanyName, virtualAssistantName } = await globalCompanyData();
const contactFormConfig = await getContactFormConfig(globalCompanyName, virtualAssistantName);
const contactInitialData = buildFormInitialDataFromUser(currentUser);
---

<App title={`Contact ${globalCompanyName}`} {currentUser} mask="top-left">
  <div class="container mx-auto px-4 py-12">
    <!-- Chat Interface Container (Hidden Initially) -->
    <div id="chat-container" class="mx-auto max-w-4xl">
      <VapiChatInterface
        title="Let's get in touch..."
        introMessage={`Hi! I'm Leah, ${globalCompanyName}'s project assistant. I'm here to help you get in touch with our team. I can answer questions about our fire protection services and collect your contact information. What brings you here today?`}
        placeholder="Type your message or ask a question..."
      />

      <!-- Quick Examples -->
      <div
        class="mt-6 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20"
      >
        <p class="mb-2 text-sm font-medium text-blue-900 dark:text-blue-200">Try asking:</p>
        <div class="flex flex-wrap gap-2">
          <button
            onclick="document.getElementById('vapi-input').value = 'What services do you offer?'; document.getElementById('vapi-input').focus();"
            class="rounded-lg border border-blue-300 bg-white px-3 py-1 text-xs text-blue-800 transition-colors hover:bg-blue-50 dark:border-blue-700 dark:bg-gray-900 dark:text-blue-200 dark:hover:bg-blue-900/30"
          >
            What services do you offer?
          </button>
          <button
            onclick="document.getElementById('vapi-input').value = 'I need a fire alarm system'; document.getElementById('vapi-input').focus();"
            class="rounded-lg border border-blue-300 bg-white px-3 py-1 text-xs text-blue-800 transition-colors hover:bg-blue-50 dark:border-blue-700 dark:bg-gray-900 dark:text-blue-200 dark:hover:bg-blue-900/30"
          >
            I need a fire alarm system
          </button>
          <button
            onclick="document.getElementById('vapi-input').value = 'How long does a project take?'; document.getElementById('vapi-input').focus();"
            class="rounded-lg border border-blue-300 bg-white px-3 py-1 text-xs text-blue-800 transition-colors hover:bg-blue-50 dark:border-blue-700 dark:bg-gray-900 dark:text-blue-200 dark:hover:bg-blue-900/30"
          >
            How long does a project take?
          </button>
        </div>
      </div>
    </div>
  </div>
</App>
