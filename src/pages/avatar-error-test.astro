---
import UserIcon from "../components/common/UserIcon.astro";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avatar Error Handling Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold mb-8">Avatar Error Handling Test</h1>

      <div class="bg-white p-6 rounded-lg shadow mb-8">
        <h2 class="text-xl font-semibold mb-4">Test Cases</h2>

        <div class="space-y-6">
          <!-- Test 1: Broken Supabase URL -->
          <div class="border p-4 rounded">
            <h3 class="font-medium mb-2">1. Broken Supabase Storage URL</h3>
            <p class="text-sm text-gray-600 mb-2">
              This should show initials instead of trying to load the broken image
            </p>
            <UserIcon
              user={{
                id: "1",
                firstName: "John",
                lastName: "Doe",
                email: "john@example.com",
                avatarUrl:
                  "https://qudlxlryegnainztkrtk.supabase.co/storage/v1/object/public/project-media/avatars/09a408ee-dde1-420b-be4d-1b7a45891def.png",
              }}
              size="lg"
            />
          </div>

          <!-- Test 2: Valid URL -->
          <div class="border p-4 rounded">
            <h3 class="font-medium mb-2">2. Valid Avatar URL</h3>
            <p class="text-sm text-gray-600 mb-2">This should load the avatar successfully</p>
            <UserIcon
              user={{
                id: "2",
                firstName: "Alice",
                lastName: "Johnson",
                email: "alice@example.com",
                avatarUrl:
                  "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face",
              }}
              size="lg"
            />
          </div>

          <!-- Test 3: No Avatar URL -->
          <div class="border p-4 rounded">
            <h3 class="font-medium mb-2">3. No Avatar URL</h3>
            <p class="text-sm text-gray-600 mb-2">This should show initials</p>
            <UserIcon
              user={{
                id: "3",
                firstName: "Bob",
                lastName: "Wilson",
                email: "bob@example.com",
              }}
              size="lg"
            />
          </div>

          <!-- Test 4: Multiple Users with Mixed URLs -->
          <div class="border p-4 rounded">
            <h3 class="font-medium mb-2">4. Multiple Users with Mixed URLs</h3>
            <p class="text-sm text-gray-600 mb-2">Mix of broken and valid URLs</p>
            <UserIcon
              users={[
                {
                  id: "4",
                  firstName: "Carol",
                  lastName: "Davis",
                  email: "carol@example.com",
                  avatarUrl:
                    "https://qudlxlryegnainztkrtk.supabase.co/storage/v1/object/public/project-media/avatars/broken.png",
                },
                {
                  id: "5",
                  firstName: "David",
                  lastName: "Brown",
                  email: "david@example.com",
                  avatarUrl:
                    "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",
                },
                {
                  id: "6",
                  firstName: "Eve",
                  lastName: "Miller",
                  email: "eve@example.com",
                },
              ]}
              size="md"
              maxDisplay={3}
            />
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4">Console Output</h2>
        <p class="text-sm text-gray-600 mb-4">
          Check the browser console for error handling messages. You should see:
        </p>
        <ul class="text-sm text-gray-600 space-y-1">
          <li>• ✅ [USER-ICON] Avatar loaded successfully: (for valid URLs)</li>
          <li>• ⚠️ [USER-ICON] Avatar failed to load, keeping fallback icon: (for broken URLs)</li>
          <li>
            • ⚠️ [IMAGE-ERROR] Supabase storage image failed to load: (for broken Supabase URLs)
          </li>
        </ul>
      </div>
    </div>
  </body>
</html>
