---
// Handle OAuth callback if code is present (MUST be first)
const authCode = Astro.url.searchParams.get("code");
if (authCode) {
  return Astro.redirect(`/api/auth/callback?code=${authCode}`);
}

// Define requireAuthRedirect
const requireAuthRedirect = undefined;
// Make sure to check above value before redirecting
import Button from "../components/common/Button.astro";
import { checkAuth } from "../lib/auth";
const { currentUser, session, supabase } = await checkAuth(Astro.cookies);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "./api/global/global-company-data";
const {
  globalCompanyName,
  globalCompanySlogan,
  globalCompanyAddress,
  globalCompanyPhone,
  globalCompanyEmail,
  globalCompanyWebsite,
  globalCompanyLogo,
  globalCompanyLogoDark,
  globalCompanyLogoLight,
} = globalCompanyData();

import { globalClasses } from "./api/global/global-classes";

const { globalInputClasses, primaryTextClasses, secondaryTextClasses } = globalClasses();

import App from "../components/common/App.astro";

// import ContactFormWithUpload from "../components/common/ContactFormWithUpload.astro";
// import Features from "../components/common/Features.astro";
import Nodes from "../components/ui/Nodes.astro";
// import FlowbiteStatsGrid from "../components/common/FlowbiteStatsGrid.astro";
import Hero from "../components/common/Hero.astro";
// import MapboxWidget from "../components/common/MapboxWidget.astro";
// import Testimonials from "../components/common/Testimonials.astro";
import LandingProduct from "../components/layout/LandingProduct.astro";

// Get auth data for conditional rendering

const stats = [
  {
    title: "Total Projects",
    value: "1,024",
    change: { value: "12%", type: "increase" },
    icon: "ðŸ“Š",
    color: "blue",
  },
  {
    title: "Active Users",
    value: "357",
    change: { value: "8%", type: "increase" },
    icon: "ðŸ‘¥",
    color: "green",
  },
  {
    title: "Approval Rate",
    value: "97.5%",
    change: { value: "3%", type: "increase" },
    icon: "ðŸ“ˆ",
    color: "yellow",
  },
];
---

<App
  title={`${globalCompanyName} - ${globalCompanySlogan}`}
  description={globalCompanySlogan}
  {currentUser}
  session={session || undefined}
  project={undefined}
  {supabase}
  {globalCompanyName}
  {globalCompanyName}
  {globalCompanySlogan}
  {primaryTextClasses}
  {secondaryTextClasses}
  {globalInputClasses}
  centerContent={true}
>
  <Nodes />
  <LandingProduct />

  <!-- <FlowbiteStatsGrid
    stats={[]}
    columns={3}
    {primaryTextClasses}
    {secondaryTextClasses}
    {globalInputClasses}
  />

  <Features {primaryTextClasses} {secondaryTextClasses} {globalInputClasses} />

  <MapboxWidget {currentUser} />

  <Testimonials
    globalCompanyName={globalCompanyName || ""}
    {primaryTextClasses}
    {secondaryTextClasses}
    {globalInputClasses}
  />

  {
    !currentUser && (
      <div class="px-4 pt-4">
        <div class="XXXXrounded-md XXbg-gray-100 p-4 XXshadow-sm color-background XXmd:p-6">
          <ContactFormWithUpload globalInputClasses={globalInputClasses} />
        </div>
      </div>
    )
  } -->
</App>

<script>
  import AOS from "aos";
  import "aos/dist/aos.css";

  // Initialize AOS
  AOS.init({
    duration: 1000,
    once: true,
    offset: 100,
  });

  // Initialize all charts
</script>

<style>
  @import "aos/dist/aos.css";

  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
</style>
