---
import App from "../components/App.astro";
import SectionContainer from "../components/SectionContainer.astro";
import Hero from "../components/index/Hero.astro";
import ProjectsNav from "../components/ProjectsNav.astro";
import AuthForm from "../components/AuthForm.astro";
import ProjectList from "../components/ProjectList.astro";
// Check authentication
import { checkAuth } from "../lib/auth";
const { isAuth, session, user, role } = await checkAuth(Astro.cookies);


---

<App>
    
    {isAuth ? (

        <SectionContainer id="hero" class="flex flex-col gap-y-6">
          <Hero title={'' + user.user_metadata.name} description={role || 'No role'}/>
        </SectionContainer>

        <!-- Client content -->
        {role ? (
          <SectionContainer id="sub-nav" class="flex flex-col gap-y-6">
            <ProjectsNav role={role}/>
          </SectionContainer>
        ) : (

          <SectionContainer class="flex flex-col gap-y-6">
            <h2>No role</h2>
          </SectionContainer>
        )}

        <SectionContainer class="flex flex-col gap-y-6">
          <!-- Tailwind Test Element -->
          <div class="max-w-md mx-auto p-4 bg-red-500 text-white rounded-lg">
            <h3 class="text-lg font-bold">Tailwind Test</h3>
            <p class="text-sm">This should be max-width: 28rem (448px) and centered</p>
          </div>
          <ProjectList />
          <slot />
        </SectionContainer>

      
    ) : (
      <!-- Non-authenticated content -->
      <SectionContainer id="auth" class="flex flex-col gap-y-6 mx-6">
        <AuthForm />
      </SectionContainer>
    
    )}
  </App>
  