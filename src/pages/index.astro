---
// import { isBackendPage } from "../../pages/api/backend-page-check";
// import { navigation } from "@/pages/api/navigation";

// interface Props {
//   requireAuthRedirect?: string;
//   title?: string;
//   description?: string;
//   currentUser?: any;
//   session?: any;
//   project?: any;
//   supabase?: any;
//   supabaseAdmin?: any;
// }

const requireAuthRedirect = undefined;
import { checkAuth } from "../lib/auth";

// Handle OAuth callback if code is present
const authCode = Astro.url.searchParams.get("code");
if (authCode) {
  return Astro.redirect(`/api/auth/callback?code=${authCode}`);
}

const { currentUser, session, supabase, refreshToken, accessToken } = await checkAuth(
  Astro.cookies
);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}
const currentRole = currentUser?.role;
const currentUserId = currentUser?.id;

import App from "../components/common/App.astro";
import FlowbiteStatsGrid from "../components/common/FlowbiteStatsGrid.astro";
import Footer from "../components/common/Footer.astro";
import Hero from "../components/common/Hero.astro";

// Get auth data for conditional rendering

const stats = [
  {
    title: "Total Projects",
    value: "1,024",
    change: { value: "12%", type: "increase" as const },
    icon: "ðŸ“Š",
    color: "blue" as const,
  },
  {
    title: "Active Users",
    value: "357",
    change: { value: "8%", type: "increase" as const },
    icon: "ðŸ‘¥",
    color: "green" as const,
  },
  // {
  //   title: "Revenue",
  //   value: "$45,678",
  //   change: { value: "15%", type: "increase" as const },
  //   icon: "ðŸ’°",
  //   color: "purple" as const,
  // },
  {
    title: "Approval Rate",
    value: "97.5%",
    change: { value: "3%", type: "increase" as const },
    icon: "ðŸ“ˆ",
    color: "yellow" as const,
  },
];
---

<App
  title="CAPCO Design Group - Build, manage, and track fire protection systems effortlessly"
  description="CAPCo powers the world's most reliable fire protection systems. We make compliance easy."
  currentUser={currentUser}
  session={session || undefined}
  project={undefined}
  supabase={supabase}
>
  <div
    id="main-content"
    class="ahOqFrhzLjivRe8a1kX_ uLPch_bqyJDXwe5tynMV t6gkcSf0Bt4MLItXvDJ_ pdl952ted2i71qBLPIcQ jtAJHOc7mn7b4IKRO59D h8KYXnua2NT4kTVzieom"
  >
    <main>
      <div class="RZmKBZs1E1eXw8vkE6jY p_2EXc_a2sDA_h41l8QU">
        <div
          class="mveJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 _wYiJGbRZyFZeCc8y7Sf mngKhi_Rv06PF57lblDI _1jTZ8KXRZul60S6czNi LSIxp7RSuOKhsg28v_u3"
        >
          <Hero
            title="CAPCO Design Group"
            description="Build, manage, and track fire protection systems effortlessly"
          />
          <FlowbiteStatsGrid stats={stats} columns={3} />
        </div>
      </div>
    </main>
    <Footer />
  </div>
</App>

<!-- Hero Section -->
<!-- -->
<!-- Features Section -->
<!-- <Features /> -->

<!-- Testimonials Section -->
<!-- <Testimonials /> -->
