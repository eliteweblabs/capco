---
/**
 * Demo page for JSON Multi-Step Form Generator
 *
 * This page demonstrates all three example forms:
 * 1. Contact Form
 * 2. Registration Form
 * 3. Advanced Survey Form
 */

import JSONMultiStepForm from "../../components/form/JSONMultiStepForm.astro";
import Button from "../../components/common/Button.astro";

// Import example configurations
import contactFormConfig from "../../../config/form-contact-example.json";
import registerFormConfig from "../../../config/form-register-example.json";
import surveyFormConfig from "../../../config/form-survey-example.json";

// Get the demo type from URL params
const { demo } = Astro.params;
const searchParams = Astro.url.searchParams;
const formType = searchParams.get("type") || "contact";

// Select config based on type
let selectedConfig;
let selectedTitle = "";
let selectedDescription = "";

switch (formType) {
  case "register":
    selectedConfig = registerFormConfig;
    selectedTitle = "Registration Form Demo";
    selectedDescription = "User registration with validation and conditional fields";
    break;
  case "survey":
    selectedConfig = surveyFormConfig;
    selectedTitle = "Advanced Survey Demo";
    selectedDescription = "Complex survey with multiple field types and layouts";
    break;
  case "contact":
  default:
    selectedConfig = contactFormConfig;
    selectedTitle = "Contact Form Demo";
    selectedDescription = "Simple multi-step contact form";
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Multi-Step Form Demo - {selectedTitle}</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/src/styles/global.css" />

    <!-- BoxIcons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

    <style>
      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .demo-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 2rem 1rem;
      }

      .demo-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 2rem;
        max-width: 1200px;
        width: 100%;
        margin-bottom: 2rem;
      }

      .demo-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .demo-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #1a202c;
        margin-bottom: 0.5rem;
      }

      .demo-description {
        color: #718096;
        font-size: 1.125rem;
      }

      .demo-nav {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
      }

      .demo-nav-button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s;
      }

      .demo-nav-button.active {
        background: #667eea;
        color: white;
      }

      .demo-nav-button:not(.active) {
        background: #e2e8f0;
        color: #4a5568;
      }

      .demo-nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .demo-info {
        background: #edf2f7;
        border-left: 4px solid #667eea;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
      }

      .demo-info-title {
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 0.5rem;
      }

      .demo-info-text {
        color: #4a5568;
        font-size: 0.875rem;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: white;
        text-decoration: none;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 0.5rem;
        margin-bottom: 2rem;
        transition: all 0.2s;
      }

      .back-link:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateX(-4px);
      }
    </style>
  </head>

  <body>
    <div class="demo-container">
      <a href="/" class="back-link">
        <i class="bx bx-arrow-back"></i>
        Back to Home
      </a>

      <div class="demo-card">
        <div class="demo-header">
          <h1 class="demo-title">{selectedTitle}</h1>
          <p class="demo-description">{selectedDescription}</p>
        </div>

        <!-- Form Type Navigation -->
        <div class="demo-nav">
          <a
            href="?type=contact"
            class={`demo-nav-button ${formType === "contact" ? "active" : ""}`}
          >
            <i class="bx bx-envelope"></i> Contact Form
          </a>
          <a
            href="?type=register"
            class={`demo-nav-button ${formType === "register" ? "active" : ""}`}
          >
            <i class="bx bx-user-plus"></i> Registration
          </a>
          <a href="?type=survey" class={`demo-nav-button ${formType === "survey" ? "active" : ""}`}>
            <i class="bx bx-list-check"></i> Survey
          </a>
        </div>

        <!-- Demo Info Box -->
        <div class="demo-info">
          <div class="demo-info-title">
            <i class="bx bx-info-circle"></i> Demo Mode
          </div>
          <p class="demo-info-text">
            This is a demonstration of the JSON-driven multi-step form generator. The form will not
            actually submit data. Check the browser console to see form data on submit.
            <br /><br />
            <strong>Config file:</strong>
            <code>/config/form-{formType}-example.json</code>
          </p>
        </div>

        <!-- The Form -->
        <JSONMultiStepForm config={selectedConfig} />
      </div>

      <!-- Documentation Link -->
      <div style="text-align: center; margin-top: 2rem;">
        <a
          href="/markdowns/json-multi-step-form.md"
          target="_blank"
          class="back-link"
          style="margin: 0;"
        >
          <i class="bx bx-book-open"></i>
          View Documentation
        </a>
      </div>
    </div>

    <!-- Modal System (required for error/success messages) -->
    <script>
      // Simple modal system for demos
      window.showNotice = (type, title, message, duration = 5000) => {
        // Check if modal container exists
        let modalContainer = document.getElementById("modal-container");
        if (!modalContainer) {
          modalContainer = document.createElement("div");
          modalContainer.id = "modal-container";
          modalContainer.style.cssText = `
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          `;
          document.body.appendChild(modalContainer);
        }

        // Create modal element
        const modal = document.createElement("div");
        modal.className = `modal modal-${type}`;

        // Color based on type
        const colors = {
          success: "#10b981",
          error: "#ef4444",
          warning: "#f59e0b",
          info: "#3b82f6",
        };

        modal.style.cssText = `
          background: white;
          border-left: 4px solid ${colors[type] || colors.info};
          border-radius: 0.5rem;
          padding: 1rem;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
          min-width: 300px;
          max-width: 400px;
          animation: slideIn 0.3s ease-out;
        `;

        modal.innerHTML = `
          <div style="display: flex; align-items: start; gap: 0.75rem;">
            <i class='bx bx-${type === "success" ? "check-circle" : type === "error" ? "error-circle" : type === "warning" ? "error" : "info-circle"}' 
               style="color: ${colors[type] || colors.info}; font-size: 1.5rem;"></i>
            <div style="flex: 1;">
              <div style="font-weight: 600; color: #1a202c; margin-bottom: 0.25rem;">${title}</div>
              <div style="color: #4a5568; font-size: 0.875rem;">${message}</div>
            </div>
            <button onclick="this.closest('.modal').remove()" 
                    style="background: none; border: none; cursor: pointer; color: #9ca3af; font-size: 1.25rem;">
              <i class='bx bx-x'></i>
            </button>
          </div>
        `;

        modalContainer.appendChild(modal);

        // Auto-remove after duration
        if (duration > 0) {
          setTimeout(() => {
            modal.style.animation = "slideOut 0.3s ease-in";
            setTimeout(() => modal.remove(), 300);
          }, duration);
        }
      };

      // Add animations
      const style = document.createElement("style");
      style.textContent = `
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        @keyframes slideOut {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(100%);
            opacity: 0;
          }
        }
      `;
      document.head.appendChild(style);

      // Override form submissions for demo
      document.addEventListener("DOMContentLoaded", () => {
        const forms = document.querySelectorAll(
          'form[id*="example"]'
        ) as NodeListOf<HTMLFormElement>;
        forms.forEach((form) => {
          form.addEventListener("submit", (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            console.log("ðŸ“‹ Form Data:", data);

            window.showNotice(
              "success",
              "Demo Submission",
              "Form data logged to console. In production, this would submit to the API.",
              5000
            );
          });
        });
      });
    </script>
  </body>
</html>
