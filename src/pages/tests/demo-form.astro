---
/**
 * Demo Form Page
 * One field of each type: Basic form + MultiStepForm
 */
import App from "../../components/ui/App.astro";
import MultiStepForm from "../../features/forms/components/MultiStepForm.astro";
import InlineAddressSearch from "../../components/form/InlineAddressSearch.astro";
import UnitSlider from "../../components/form/UnitSlider.astro";
import SlideToggle from "../../components/form/SlideToggle.astro";
import ToggleButtonGroup from "../../components/form/ToggleButtonGroup.astro";
import FileUpload from "../../components/form/FileUpload.astro";
import Button from "../../components/common/Button.astro";
import { globalClasses } from "../../pages/api/global/global-classes";
import type { MultiStepFormConfig } from "../../lib/multi-step-form-config";

const { globalFormClasses, globalInputClasses } = globalClasses();
const appendedInputClasses = `${globalInputClasses} text-center`;
---

<App title="Demo Form - Field Types" description="Test all form field types">
  <div class="container mx-auto max-w-3xl px-4 py-12">
    <h1 class="mb-8 text-3xl font-bold text-gray-900 dark:text-white">Form Field Types Demo</h1>

    <!-- Basic Form -->
    <section class="mb-16">
      <h2 class="mb-6 text-2xl font-semibold text-gray-800 dark:text-gray-200">
        Basic Form (all field types on one page)
      </h2>
      <form
        id="demo-basic-form"
        action="#"
        method="post"
        class={`color-background ${globalFormClasses} rounded-xl border border-gray-200 p-8 dark:border-gray-700`}
      >
        <div class="space-y-2">
          <label for="demo-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Text
          </label>
          <input
            type="text"
            id="demo-text"
            name="text"
            placeholder="Text input"
            class={appendedInputClasses}
          />
        </div>

        <div class="space-y-2">
          <label
            for="demo-email"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            Email
          </label>
          <input
            type="email"
            id="demo-email"
            name="email"
            placeholder="email@example.com"
            class={appendedInputClasses}
          />
        </div>

        <div class="space-y-2">
          <label for="demo-tel" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Tel
          </label>
          <input
            type="tel"
            id="demo-tel"
            name="tel"
            placeholder="+1 555 123 4567"
            class={appendedInputClasses}
          />
        </div>

        <div class="space-y-2">
          <label
            for="demo-password"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            Password
          </label>
          <input
            type="password"
            id="demo-password"
            name="password"
            placeholder="••••••••"
            class={appendedInputClasses}
          />
        </div>

        <div class="space-y-2">
          <label
            for="demo-textarea"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            Textarea
          </label>
          <textarea
            id="demo-textarea"
            name="textarea"
            placeholder="Multi-line text..."
            rows={4}
            class={appendedInputClasses}></textarea>
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >UnitSlider</label
          >
          <UnitSlider name="slider" label="Slider" value={50} min={0} max={100} step={5} />
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >SlideToggle</label
          >
          <SlideToggle id="demo-toggle" name="toggle" />
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            ToggleButton (radio)
          </label>
          <div class="multi-step-toggle-group flex flex-wrap gap-3">
            <ToggleButton value="a" group="toggleBtn" type="radio"> Option A </ToggleButton>
            <ToggleButton value="b" group="toggleBtn" type="radio"> Option B </ToggleButton>
            <ToggleButton value="c" group="toggleBtn" type="radio"> Option C </ToggleButton>
          </div>
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            InlineAddressSearch
          </label>
          <InlineAddressSearch
            id="demo-address"
            name="address"
            placeholder="Search for an address..."
            globalInputClasses={appendedInputClasses}
          />
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >FileUpload</label
          >
          <FileUpload
            name="file"
            label="Upload file"
            maxFiles={3}
            maxSize={5 * 1024 * 1024}
            accept="image/*,.pdf"
          />
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Button Group (radio)
          </label>
          <ToggleButtonGroup
            name="buttonGroup"
            buttons={[{ label: "Yes", value: "yes" }, { label: "No", value: "no" }]}
            toggleType="radio"
          />
        </div>

        <input type="hidden" name="hidden" value="hidden-value" />

        <div class="pt-4">
          <Button type="submit" variant="primary"> Submit Basic Form </Button>
        </div>
      </form>
    </section>

    <!-- MultiStepForm -->
    <section>
      <h2 class="mb-6 text-2xl font-semibold text-gray-800 dark:text-gray-200">
        MultiStepForm (one field per step)
      </h2>

      <MultiStepForm
        config={(() => {
          const steps = [
            {
              stepNumber: 1,
              title: "Text field",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-text",
                  name: "text",
                  type: "text",
                  label: "Text",
                  placeholder: "Enter text",
                  required: true,
                },
              ],
              buttons: [{ type: "next", dataNext: 2 }],
            },
            {
              stepNumber: 2,
              title: "Email field",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-email",
                  name: "email",
                  type: "email",
                  label: "Email",
                  placeholder: "email@example.com",
                  required: true,
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 1 },
                { type: "next", dataNext: 3 },
              ],
            },
            {
              stepNumber: 3,
              title: "Tel field",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-tel",
                  name: "tel",
                  type: "tel",
                  label: "Phone",
                  placeholder: "+1 555 123 4567",
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 2 },
                { type: "next", dataNext: 4 },
              ],
            },
            {
              stepNumber: 4,
              title: "Password field",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-password",
                  name: "password",
                  type: "password",
                  label: "Password",
                  placeholder: "••••••••",
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 3 },
                { type: "next", dataNext: 5 },
              ],
            },
            {
              stepNumber: 5,
              title: "Textarea",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-textarea",
                  name: "textarea",
                  type: "textarea",
                  label: "Message",
                  placeholder: "Multi-line text...",
                  rows: 4,
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 4 },
                { type: "next", dataNext: 6 },
              ],
            },
            {
              stepNumber: 6,
              title: "UnitSlider",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-slider",
                  name: "slider",
                  type: "component",
                  elementType: "component",
                  component: "UnitSlider",
                  label: "Units (0–100)",
                  min: 0,
                  max: 100,
                  step: 5,
                  componentProps: {},
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 5 },
                { type: "next", dataNext: 7 },
              ],
            },
            {
              stepNumber: 7,
              title: "SlideToggle",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-toggle",
                  name: "toggle",
                  type: "component",
                  elementType: "component",
                  component: "SlideToggle",
                  label: "Toggle",
                  componentProps: {},
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 6 },
                { type: "next", dataNext: 8 },
              ],
            },
            {
              stepNumber: 8,
              title: "ToggleButton",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-togglebtn",
                  name: "toggleBtn",
                  type: "component",
                  elementType: "component",
                  component: "ToggleButton",
                  label: "Choose one",
                  options: [
                    { value: "a", label: "A" },
                    { value: "b", label: "B" },
                    { value: "c", label: "C" },
                  ],
                  toggleType: "radio",
                  componentProps: {},
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 7 },
                { type: "next", dataNext: 9 },
              ],
            },
            {
              stepNumber: 9,
              title: "Address search",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-address",
                  name: "address",
                  type: "component",
                  elementType: "component",
                  component: "InlineAddressSearch",
                  label: "Address",
                  componentProps: { placeholder: "Search addresses..." },
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 8 },
                { type: "next", dataNext: 10 },
              ],
            },
            {
              stepNumber: 10,
              title: "File upload",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-file",
                  name: "file",
                  type: "component",
                  elementType: "component",
                  component: "FileUpload",
                  label: "Upload",
                  maxFiles: 2,
                  maxSize: 5242880,
                  accept: "image/*,.pdf",
                  componentProps: {},
                },
              ],
              buttons: [
                { type: "prev", dataPrev: 9 },
                { type: "next", dataNext: 11 },
              ],
            },
            {
              stepNumber: 11,
              title: "Button group",
              fieldLayout: "single",
              response: true,
              fields: [
                {
                  id: "ms-choice",
                  name: "choice",
                  type: "button-group",
                  elementType: "button-group",
                  label: "Choice",
                  buttons: [
                    { type: "choice", label: "Yes", dataValue: "yes", dataNext: 12 },
                    { type: "choice", label: "No", dataValue: "no", dataNext: 12 },
                  ],
                },
              ],
              buttons: [{ type: "prev", dataPrev: 10 }],
            },
            {
              stepNumber: 12,
              title: "Review",
              fieldLayout: "single",
              isReview: true,
              reviewFields: [
                "text",
                "email",
                "tel",
                "textarea",
                "slider",
                "toggle",
                "toggleBtn",
                "address",
                "choice",
              ],
              fields: [],
              buttons: [{ type: "prev", dataPrev: 11 }, { type: "submit" }],
            },
          ];
          return {
            formId: "demo-multistep-form",
            formAction: "#",
            formMethod: "post",
            totalSteps: 12,
            progressBar: true,
            buttonDefaults: {
              next: {
                type: "next",
                variant: "secondary",
                size: "md",
                icon: "arrow-right",
                iconPosition: "right",
                label: "next",
              },
              prev: {
                type: "prev",
                variant: "anchor",
                size: "md",
                icon: "arrow-left",
                iconPosition: "left",
                label: "back",
              },
              submit: {
                type: "submit",
                variant: "primary",
                size: "md",
                icon: "check",
                iconPosition: "right",
                label: "Submit",
              },
            },
            steps,
          } as MultiStepFormConfig;
        })()}
        containerClass="max-w-md mx-auto"
      />
    </section>
  </div>
</App>

<script>
  document.getElementById("demo-basic-form")?.addEventListener("submit", (e) => {
    e.preventDefault();
    console.log(
      "[DEMO] Basic form submit",
      Object.fromEntries(new FormData(e.target as HTMLFormElement))
    );
    if ((window as any).showNotice) {
      (window as any).showNotice("success", "Submitted", "Basic form data logged to console", 2000);
    } else {
      alert("Form submitted! Check console for data.");
    }
  });
</script>
