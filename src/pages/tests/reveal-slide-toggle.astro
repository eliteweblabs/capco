---
/**
 * Test: Reveal slide-toggle (mobile)
 * Scrolling element: height 100dvh - 4rem, margin-top 4rem, margin-bottom 0, overflow-y scroll.
 * As you scroll down: margin-top decreases (content background masks header), margin-bottom increases to 4rem (footer shows).
 * Page load / scroll up = header shows; scroll down = footer shows.
 */
import App from "../../components/ui/App.astro";
import { checkAuth } from "../../lib/auth";

const { currentUser } = await checkAuth(Astro.cookies);
---

<App
  title="Test: Reveal slide-toggle"
  description="Mobile test: scroll-driven margin so content background masks header and reveals footer"
  layout="fullwidth"
  {currentUser}
>
  <!-- Fixed header (4rem) – visible when scroll at top; masked by scroll pane when margin-top → 0 -->

  <div class="px-4 py-8">
    <h1 class="text-xl font-bold text-gray-900 dark:text-white md:text-2xl">
      Reveal slide-toggle test
    </h1>
    <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 md:hidden">
      On mobile: scroll down. The content background will cover the header and reveal the footer.
    </p>
    <p class="mt-4 text-gray-600 dark:text-gray-400">
      Scroll position drives margin-top (4rem → 0) and margin-bottom (0 → 4rem). Header shows when
      at top; footer shows when at bottom.
    </p>

    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 1</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut
        labore et dolore magna aliqua.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 2</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 3</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 4</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
        anim id est laborum.
      </p>
    </section>
    <section class="mt-8 space-y-4 pb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">End</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Keep scrolling to see the footer branding appear as margin-bottom increases.
      </p>
    </section><section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 2</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 3</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 4</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
        anim id est laborum.
      </p>
    </section>
    <section class="mt-8 space-y-4 pb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">End</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Keep scrolling to see the footer branding appear as margin-bottom increases.
      </p>
    </section><section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 2</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 3</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 4</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
        anim id est laborum.
      </p>
    </section>
    <section class="mt-8 space-y-4 pb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">End</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Keep scrolling to see the footer branding appear as margin-bottom increases.
      </p>
    </section><section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 2</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 3</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 4</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
        anim id est laborum.
      </p>
    </section>
    <section class="mt-8 space-y-4 pb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">End</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Keep scrolling to see the footer branding appear as margin-bottom increases.
      </p>
    </section><section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 2</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 3</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
    </section>
    <section class="mt-8 space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Section 4</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
        anim id est laborum.
      </p>
    </section>
    <section class="mt-8 space-y-4 pb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">End</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Keep scrolling to see the footer branding appear as margin-bottom increases.
      </p>
    </section>
  </div>
</App>

<script>
  (function () {
    const REM = 4; // 4rem max translate (header/footer height)
    const scrollEl = document.getElementById("reveal-test-scroll");
    if (!scrollEl) return;

    const isMobile = () => window.matchMedia("(max-width: 767px)").matches;
    const remPx = () => parseFloat(getComputedStyle(document.documentElement).fontSize) || 16;
    const maxPx = () => REM * remPx();

    let prevScrollTop = 0;
    let translateY = 0;

    function updateTranslate() {
      if (!isMobile()) {
        scrollEl.style.transform = "";
        prevScrollTop = 0;
        translateY = 0;
        return;
      }
      const scrollTop = scrollEl.scrollTop;
      const deltaY = scrollTop - prevScrollTop;
      prevScrollTop = scrollTop;
      translateY += deltaY;
      translateY = Math.max(0, Math.min(maxPx(), translateY));
      scrollEl.style.transform = `translateY(-${translateY}px)`;
    }

    scrollEl.addEventListener("scroll", updateTranslate, { passive: true });
    window.addEventListener("resize", () => {
      prevScrollTop = scrollEl.scrollTop;
      translateY = Math.max(0, Math.min(maxPx(), scrollEl.scrollTop));
      updateTranslate();
    });
    prevScrollTop = scrollEl.scrollTop;
    translateY = Math.min(scrollEl.scrollTop, maxPx());
    updateTranslate();
  })();
</script>

<style is:global>
  .reveal-slide-toggle-test .reveal-scroll-pane {
    -webkit-overflow-scrolling: touch;
    will-change: transform;
  }
  @media (max-width: 767px) {
    .reveal-slide-toggle-test .reveal-scroll-pane {
      height: calc(100dvh - 4rem) !important;
    }
  }
  @media (min-width: 768px) {
    .reveal-slide-toggle-test .reveal-scroll-pane {
      will-change: auto;
      margin-top: 0 !important;
      height: auto !important;
      max-height: 60vh;
    }
  }
</style>
