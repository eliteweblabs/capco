---
// import { isBackendPage } from "../../pages/api/backend-page-check";
// import { navigation } from "@/pages/api/navigation";

// interface Props {
//   requireAuthRedirect?: string;
//   title?: string;
//   description?: string;
//   currentUser?: any;
//   session?: any;
//   project?: any;
//   supabase?: any;
//   supabaseAdmin?: any;
// }

const requireAuthRedirect = undefined;
import { checkAuth } from "../lib/auth";
import { isBackendPage } from "../pages/api/backend-page-check";

const isBackend = isBackendPage(Astro.url.pathname);

const { currentUser, session, supabase, refreshToken, accessToken } = await checkAuth(
  Astro.cookies
);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}

import { globalCompanyData } from "../pages/api/global-company-data";
const {
  companyName,
  companySlogan,
  year,
  companyAddress,
  companyPhone,
  companyEmail,
  companyWebsite,
  companyLogo,
  companyLogoDark,
  companyLogoLight,
} = globalCompanyData();

import { globalClasses } from "../pages/api/global-classes";
const { globalInputClasses, globalPrimaryTextClasses, globalSecondaryTextClasses } =
  globalClasses();

const currentRole = currentUser?.role;
const currentUserId = currentUser?.id;

import App from "../components/common/App.astro";
import Hero from "../components/common/Hero.astro";
import ProjectForm from "../components/project/ProjectForm.astro";

// Get auth data for conditional rendering
---

<App
  title=""
  description=""
  currentUser={currentUser}
  session={session || undefined}
  project={undefined}
  supabase={supabase}
  isBackend={isBackend}
  year={year.toString()}
  globalCompanyName={companyName}
  globalCompanySlogan={companySlogan}
>
  <div
    id="main-content"
    class="ahOqFrhzLjivRe8a1kX_ uLPch_bqyJDXwe5tynMV t6gkcSf0Bt4MLItXvDJ_ pdl952ted2i71qBLPIcQ jtAJHOc7mn7b4IKRO59D h8KYXnua2NT4kTVzieom 12rem-REMOVED"
  >
    <main>
      <div class="RZmKBZs1E1eXw8vkE6jY p_2EXc_a2sDA_h41l8QU">
        <div
          class="mveJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 _wYiJGbRZyFZeCc8y7Sf mngKhi_Rv06PF57lblDI _1jTZ8KXRZul60S6czNi LSIxp7RSuOKhsg28v_u3"
        >
          <Hero
            title="Create a New Project"
            description="Add a new client or select an existing client to create a new project."
          />
        </div>

        <div class="RZmKBZs1E1eXw8vkE6jY p_2EXc_a2sDA_h41l8QU">
          <div
            class="veJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 _wYiJGbRZyFZeCc8y7Sf mngKhi_Rv06PF57lblDI _1jTZ8KXRZul60S6czNi LSIxp7RSuOKhsg28v_u3 mx-auto max-w-2xl"
          >
            <div class="w-full max-w-2xl">
              <ProjectForm
                currentUser={currentUser}
                isNewProject={true}
                project={undefined}
                projectStatus={0}
                globalInputClasses={globalInputClasses}
                globalSecondaryTextClasses={globalSecondaryTextClasses}
                globalPrimaryTextClasses={globalPrimaryTextClasses}
              />
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</App>
