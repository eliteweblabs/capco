---
// import { isBackendPage } from "../../pages/api/backend-page-check";
// import { navigation } from "@/pages/api/navigation";

// interface Props {
//   requireAuthRedirect?: string;
//   title?: string;
//   description?: string;
//   currentUser?: any;
//   session?: any;
//   project?: any;
//   supabase?: any;
//   supabaseAdmin?: any;
// }

const requireAuthRedirect = undefined;
import { checkAuth } from "../lib/auth";
import { isBackendPage } from "../pages/api/backend-page-check";

const isBackend = isBackendPage(Astro.url.pathname);

// Handle OAuth callback if code is present
const authCode = Astro.url.searchParams.get("code");
if (authCode) {
  return Astro.redirect(`/api/auth/callback?code=${authCode}`);
}

const { currentUser, session, supabase, refreshToken, accessToken } = await checkAuth(
  Astro.cookies
);
// Handle auth redirect first
if (requireAuthRedirect && (!session || !currentUser)) {
  return Astro.redirect(requireAuthRedirect);
}
const currentRole = currentUser?.role;
const currentUserId = currentUser?.id;

import App from "../components/common/App.astro";
import Footer from "../components/common/Footer.astro";
import Hero from "../components/common/Hero.astro";
import ProjectForm from "../components/project/ProjectForm.astro";

// Get auth data for conditional rendering
---

<App
  title=""
  description=""
  currentUser={currentUser}
  session={session || undefined}
  project={undefined}
  supabase={supabase}
  isBackend={isBackend}
>
  <div
    id="main-content"
    class="ahOqFrhzLjivRe8a1kX_ uLPch_bqyJDXwe5tynMV t6gkcSf0Bt4MLItXvDJ_ pdl952ted2i71qBLPIcQ jtAJHOc7mn7b4IKRO59D h8KYXnua2NT4kTVzieom MKeLnCkZhCbipNorZ2hW"
  >
    <main>
      <div class="RZmKBZs1E1eXw8vkE6jY p_2EXc_a2sDA_h41l8QU">
        <div
          class="mveJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 _wYiJGbRZyFZeCc8y7Sf mngKhi_Rv06PF57lblDI _1jTZ8KXRZul60S6czNi LSIxp7RSuOKhsg28v_u3"
        >
          <Hero
            title="Create a New Project"
            description="Add a new client or select an existing client to create a new project."
          />

          <ProjectForm
            currentUser={currentUser}
            isNewProject={true}
            project={undefined}
            projectStatus={0}
          />
        </div>
      </div>
    </main>
    <Footer />
  </div>
</App>
