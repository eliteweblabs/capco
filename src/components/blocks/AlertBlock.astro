---
/**
 * AlertBlock - Alert/Notification Banner
 *
 * Display important messages, announcements, or notifications.
 *
 * @example:
 * <AlertBlock
 *   variant="warning"
 *   title="Important Notice"
 *   message="System maintenance scheduled for this weekend."
 *   dismissible
 * />
 */
import Button from "../common/Button.astro";
import SimpleIcon from "../common/SimpleIcon.astro";

interface Props {
  // Content
  title?: string;
  message: string;

  // Type/Style
  variant?: "info" | "success" | "warning" | "danger" | "neutral";

  // Features
  dismissible?: boolean | string;
  icon?: string;

  // Action button
  buttonText?: string;
  buttonHref?: string;

  // Layout
  layout?: "inline" | "banner" | "toast" | "card";
  position?: "top" | "bottom"; // For banner layout

  // Styling
  className?: string;
  id?: string;
}

const props = Astro.props;

// Default demo content
const defaultMessage = "This is an example alert message. Customize it with your own content.";

const {
  title,
  message = defaultMessage,
  variant = "info",
  icon,
  buttonText,
  buttonHref,
  layout = "inline",
  position = "top",
  className = "",
  id,
} = props;

const dismissible = props.dismissible === "true" || props.dismissible === true;

// Variant styles
const variantStyles = {
  info: {
    bg: "bg-blue-50 dark:bg-blue-900/20",
    border: "border-blue-200 dark:border-blue-800",
    text: "text-blue-800 dark:text-blue-200",
    icon: icon || "info-circle",
    iconColor: "text-blue-500 dark:text-blue-400",
    buttonVariant: "primary",
  },
  success: {
    bg: "bg-green-50 dark:bg-green-900/20",
    border: "border-green-200 dark:border-green-800",
    text: "text-green-800 dark:text-green-200",
    icon: icon || "check-circle",
    iconColor: "text-green-500 dark:text-green-400",
    buttonVariant: "success",
  },
  warning: {
    bg: "bg-yellow-50 dark:bg-yellow-900/20",
    border: "border-yellow-200 dark:border-yellow-800",
    text: "text-yellow-800 dark:text-yellow-200",
    icon: icon || "error",
    iconColor: "text-yellow-500 dark:text-yellow-400",
    buttonVariant: "warning",
  },
  danger: {
    bg: "bg-red-50 dark:bg-red-900/20",
    border: "border-red-200 dark:border-red-800",
    text: "text-red-800 dark:text-red-200",
    icon: icon || "x-circle",
    iconColor: "text-red-500 dark:text-red-400",
    buttonVariant: "danger",
  },
  neutral: {
    bg: "bg-gray-50 dark:bg-gray-800",
    border: "border-gray-200 dark:border-gray-700",
    text: "text-gray-800 dark:text-gray-200",
    icon: icon || "bell",
    iconColor: "text-gray-500 dark:text-gray-400",
    buttonVariant: "secondary",
  },
};

const styles = variantStyles[variant] || variantStyles.info;
const alertId = id || `alert-${Math.random().toString(36).slice(2, 9)}`;
---

{
  layout === "banner" ? (
    <div
      id={alertId}
      class:list={[
        "alert-block fixed left-0 right-0 z-40",
        position === "top" ? "top-0" : "bottom-0",
        styles.bg,
        "border-b",
        styles.border,
        className,
      ]}
      role="alert"
    >
      <div class="mx-auto max-w-7xl px-4 py-3 sm:px-6 lg:px-8">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div class="flex items-center gap-3">
            <SimpleIcon name={styles.icon} class={`h-5 w-5 ${styles.iconColor}`} />
            <p class={`font-medium ${styles.text}`}>
              {title && <span class="font-bold">{title}: </span>}
              {message}
            </p>
          </div>
          <div class="flex items-center gap-3">
            {buttonText && buttonHref && (
              <Button href={buttonHref} variant={styles.buttonVariant as any} size="sm">
                {buttonText}
              </Button>
            )}
            {dismissible && (
              <button
                type="button"
                class={`p-1 rounded hover:bg-black/10 ${styles.text}`}
                data-dismiss-alert={alertId}
                aria-label="Dismiss"
              >
                <SimpleIcon name="x" class="h-5 w-5" />
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  ) : layout === "toast" ? (
    <div
      id={alertId}
      class:list={[
        "alert-block rounded-lg shadow-lg border p-4 max-w-sm",
        styles.bg,
        styles.border,
        className,
      ]}
      role="alert"
    >
      <div class="flex items-start gap-3">
        <SimpleIcon name={styles.icon} class={`h-5 w-5 ${styles.iconColor} shrink-0 mt-0.5`} />
        <div class="flex-1">
          {title && <h4 class={`font-semibold ${styles.text}`}>{title}</h4>}
          <p class={`text-sm ${styles.text} ${title ? "mt-1" : ""}`}>{message}</p>
          {buttonText && buttonHref && (
            <div class="mt-3">
              <Button href={buttonHref} variant={styles.buttonVariant as any} size="sm">
                {buttonText}
              </Button>
            </div>
          )}
        </div>
        {dismissible && (
          <button
            type="button"
            class={`p-1 rounded hover:bg-black/10 ${styles.text}`}
            data-dismiss-alert={alertId}
            aria-label="Dismiss"
          >
            <SimpleIcon name="x" class="h-4 w-4" />
          </button>
        )}
      </div>
    </div>
  ) : layout === "card" ? (
    <div
      id={alertId}
      class:list={[
        "alert-block rounded-xl border-l-4 p-6",
        styles.bg,
        styles.border.replace("border-", "border-l-"),
        className,
      ]}
      role="alert"
    >
      <div class="flex items-start gap-4">
        <div class={`p-2 rounded-full ${styles.bg}`}>
          <SimpleIcon name={styles.icon} class={`h-6 w-6 ${styles.iconColor}`} />
        </div>
        <div class="flex-1">
          {title && <h4 class={`text-lg font-semibold ${styles.text}`}>{title}</h4>}
          <p class={`${styles.text} ${title ? "mt-2" : ""}`} set:html={message} />
          {buttonText && buttonHref && (
            <div class="mt-4">
              <Button href={buttonHref} variant={styles.buttonVariant as any}>
                {buttonText}
              </Button>
            </div>
          )}
        </div>
        {dismissible && (
          <button
            type="button"
            class={`p-1 rounded hover:bg-black/10 ${styles.text}`}
            data-dismiss-alert={alertId}
            aria-label="Dismiss"
          >
            <SimpleIcon name="x" class="h-5 w-5" />
          </button>
        )}
      </div>
    </div>
  ) : (
    <div
      id={alertId}
      class:list={["alert-block rounded-lg border p-4", styles.bg, styles.border, className]}
      role="alert"
    >
      <div class="flex items-center gap-3">
        <SimpleIcon name={styles.icon} class={`h-5 w-5 ${styles.iconColor} shrink-0`} />
        <div class="flex-1">
          <p class={styles.text}>
            {title && <span class="font-bold">{title}: </span>}
            <span set:html={message} />
          </p>
        </div>
        {buttonText && buttonHref && (
          <Button href={buttonHref} variant={styles.buttonVariant as any} size="sm">
            {buttonText}
          </Button>
        )}
        {dismissible && (
          <button
            type="button"
            class={`p-1 rounded hover:bg-black/10 ${styles.text}`}
            data-dismiss-alert={alertId}
            aria-label="Dismiss"
          >
            <SimpleIcon name="x" class="h-5 w-5" />
          </button>
        )}
      </div>
    </div>
  )
}

<script>
  // Dismiss functionality
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("[data-dismiss-alert]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const alertId = btn.getAttribute("data-dismiss-alert");
        const alert = document.getElementById(alertId!);
        if (alert) {
          alert.style.transition = "opacity 0.3s ease";
          alert.style.opacity = "0";
          setTimeout(() => alert.remove(), 300);
        }
      });
    });
  });
</script>
