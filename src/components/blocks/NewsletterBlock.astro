---
/**
 * NewsletterBlock - Newsletter Signup Form
 *
 * Email signup form for newsletters or updates.
 *
 * @example:
 * <NewsletterBlock
 *   title="Stay Updated"
 *   description="Get the latest fire safety news"
 *   buttonText="Subscribe"
 *   action="/api/subscribe"
 * />
 */
import Button from "../common/Button.astro";
import SimpleIcon from "../common/SimpleIcon.astro";
import { globalClasses } from "../../pages/api/global/global-classes";

interface Props {
  // Content
  title?: string;
  description?: string;

  // Form
  buttonText?: string;
  placeholder?: string;
  action?: string;
  method?: "POST" | "GET";

  // Layout
  variant?: "inline" | "stacked" | "card" | "banner" | "minimal";

  // Success/Error messages
  successMessage?: string;

  // Additional field
  showName?: boolean | string;
  namePlaceholder?: string;

  // Styling
  backgroundColor?: string;
  className?: string;
  id?: string;
}

const props = Astro.props;
const {
  title,
  description,
  buttonText = "Subscribe",
  placeholder = "Enter your email",
  action = "#",
  method = "POST",
  variant = "inline",
  successMessage = "Thanks for subscribing!",
  namePlaceholder = "Your name",
  backgroundColor,
  className = "",
  id,
} = props;

const showName = props.showName === "true" || props.showName === true;
const { globalFormClasses } = globalClasses();

// Form ID for JS handling
const formId = id || `newsletter-form-${Math.random().toString(36).slice(2, 9)}`;

const variantBg = {
  inline: "",
  stacked: "",
  card: "bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-8 md:p-12 border border-gray-100 dark:border-gray-700",
  banner: "bg-primary-600 dark:bg-primary-700",
  minimal: "",
};

const variantTextColor = variant === "banner" ? "text-white" : "text-gray-900 dark:text-white";
const variantSubTextColor =
  variant === "banner" ? "text-primary-100" : "text-gray-600 dark:text-gray-300";
---

<section
  {id}
  class:list={["newsletter-block py-12 md:py-16", backgroundColor || variantBg[variant], className]}
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    {
      variant === "card" ? (
        <div class={variantBg.card}>
          <div class="mx-auto max-w-2xl text-center">
            {title && <h2 class={`text-2xl font-bold md:text-3xl ${variantTextColor}`}>{title}</h2>}
            {description && <p class={`mt-3 text-lg ${variantSubTextColor}`}>{description}</p>}

            <form id={formId} action={action} method={method} class={`${globalFormClasses} mt-8`}>
              {showName && (
                <input
                  type="text"
                  name="name"
                  placeholder={namePlaceholder}
                  class="mb-4 w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                />
              )}
              <div class="flex flex-col gap-3 sm:flex-row">
                <input
                  type="email"
                  name="email"
                  required
                  placeholder={placeholder}
                  class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                />
                <Button type="submit" variant="primary" size="lg">
                  {buttonText}
                </Button>
              </div>
            </form>

            <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">
              We respect your privacy. Unsubscribe at any time.
            </p>
          </div>
        </div>
      ) : variant === "banner" ? (
        <div class="flex flex-col items-center justify-between gap-6 md:flex-row">
          <div>
            {title && <h2 class={`text-xl font-bold md:text-2xl ${variantTextColor}`}>{title}</h2>}
            {description && <p class={`mt-1 ${variantSubTextColor}`}>{description}</p>}
          </div>

          <form id={formId} action={action} method={method} class={`${globalFormClasses} flex w-full gap-3 md:w-auto`}>
            <input
              type="email"
              name="email"
              required
              placeholder={placeholder}
              class="flex-1 rounded-lg border-0 bg-white/10 px-4 py-2.5 text-white placeholder-white/60 focus:ring-2 focus:ring-white/50 md:w-64"
            />
            <Button
              type="submit"
              variant="secondary"
              class="bg-white text-primary-600 hover:bg-gray-100"
            >
              {buttonText}
            </Button>
          </form>
        </div>
      ) : variant === "stacked" ? (
        <div class="mx-auto max-w-xl text-center">
          {title && <h2 class={`text-2xl font-bold md:text-3xl ${variantTextColor}`}>{title}</h2>}
          {description && <p class={`mt-3 text-lg ${variantSubTextColor}`}>{description}</p>}

          <form id={formId} action={action} method={method} class={`${globalFormClasses} mt-6`}>
            {showName && (
              <input
                type="text"
                name="name"
                placeholder={namePlaceholder}
                class="w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-900 dark:text-white"
              />
            )}
            <input
              type="email"
              name="email"
              required
              placeholder={placeholder}
              class="w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-900 dark:text-white"
            />
            <Button type="submit" variant="primary" size="lg" fullWidth>
              {buttonText}
            </Button>
          </form>
        </div>
      ) : variant === "minimal" ? (
        <form id={formId} action={action} method={method} class={`${globalFormClasses} mx-auto flex max-w-md gap-3`}>
          <input
            type="email"
            name="email"
            required
            placeholder={placeholder}
            class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-900 dark:text-white"
          />
          <Button type="submit" variant="primary">
            {buttonText}
          </Button>
        </form>
      ) : (
        <div class="flex flex-col items-center justify-between gap-8 lg:flex-row">
          <div class="lg:max-w-lg">
            {title && <h2 class={`text-2xl font-bold md:text-3xl ${variantTextColor}`}>{title}</h2>}
            {description && <p class={`mt-3 text-lg ${variantSubTextColor}`}>{description}</p>}
          </div>

          <form id={formId} action={action} method={method} class={`${globalFormClasses} w-full lg:w-auto`}>
            <div class="flex flex-col gap-3 sm:flex-row">
              {showName && (
                <input
                  type="text"
                  name="name"
                  placeholder={namePlaceholder}
                  class="rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-900 dark:text-white"
                />
              )}
              <input
                type="email"
                name="email"
                required
                placeholder={placeholder}
                class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-900 dark:text-white sm:w-64"
              />
              <Button type="submit" variant="primary" size="lg">
                {buttonText}
              </Button>
            </div>
          </form>
        </div>
      )
    }
  </div>
</section>

<script define:vars={{ formId, successMessage }}>
  // Simple form handling
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById(formId);
    if (form) {
      form.addEventListener("submit", async (e) => {
        // If action is #, prevent default and show success
        if (form.getAttribute("action") === "#") {
          e.preventDefault();
          alert(successMessage);
          form.reset();
        }
      });
    }
  });
</script>
