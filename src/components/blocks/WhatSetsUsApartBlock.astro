---
/**
 * WhatSetsUsApartBlock - "What Sets Us Apart" section
 *
 * Layout: Icon + text blocks OR numbered list with icons.
 * Includes optional supporting image (QC walk, safety briefing, etc.).
 *
 * Supports both direct Astro usage and flat CMS shortcode props.
 *
 * @example CMS shortcode:
 * <WhatSetsUsApartBlock
 *   title="What Sets Us Apart"
 *   item1Title="Preconstruction Excellence"
 *   item1Icon="file-check"
 *   item2Title="FAR-Compliant Federal Delivery"
 *   item2Icon="shield"
 *   ...
 *   imageSrc="https://..."
 *   imageAlt="QC walk"
 *   variant="icons"
 * />
 */
import SimpleIcon from "../common/SimpleIcon.astro";
import { buildArrayFromFlatProps } from "./BlockRegistry";
import { globalClasses } from "../../pages/api/global/global-classes";

const { globalTextH3 } = globalClasses();

interface Item {
  icon?: string;
  title: string;
  description?: string;
}

interface Props {
  title?: string;
  description?: string;
  /** Layout: icons (icon + text blocks) | numbered (numbered list with icons) */
  variant?: string;

  // Supporting image
  imageSrc?: string;
  imageAlt?: string;
  /** Image position: left | right */
  imagePosition?: string;

  // Items as flat props (item1Title, item1Icon, item1Description, etc.)
  item1Title?: string;
  item1Icon?: string;
  item1Description?: string;
  item2Title?: string;
  item2Icon?: string;
  item2Description?: string;
  item3Title?: string;
  item3Icon?: string;
  item3Description?: string;
  item4Title?: string;
  item4Icon?: string;
  item4Description?: string;
  item5Title?: string;
  item5Icon?: string;
  item5Description?: string;
  item6Title?: string;
  item6Icon?: string;
  item6Description?: string;

  className?: string;
  id?: string;
}

const props = Astro.props;
const {
  title = "What Sets Us Apart",
  description = "",
  variant = "icons",
  imageSrc,
  imageAlt = "Supporting image",
  imagePosition = "right",
  className = "",
  id,
} = props;

const items: Item[] = buildArrayFromFlatProps<Item>(
  props,
  "item",
  ["icon", "title", "description"],
  6
);

const defaultIcons = ["file-check", "shield", "building", "hospital", "award"];
const getIcon = (item: Item, index: number) => item.icon || defaultIcons[index] || "check";

/** Single neutral style for all icons â€“ professional, not multicolor */
const iconContainerClass = "bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";
---

<section
  {id}
  class={`what-sets-us-apart-block py-16 md:py-24 ${className}`.trim()}
  data-aos="fade-up"
  data-aos-duration="600"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div
      class:list={[
        "grid gap-12 lg:gap-16",
        imageSrc && "lg:grid-cols-2 lg:items-center",
        imagePosition === "left" && "lg:grid-cols-[1fr_2fr]",
      ]}
    >
      {
        imageSrc && imagePosition === "left" && (
          <div class="relative order-2 lg:order-1">
            <img src={imageSrc} alt={imageAlt} class="w-full rounded-lg object-cover shadow-lg" />
          </div>
        )
      }

      <div class={imagePosition === "left" ? "order-1 lg:order-2" : ""}>
        {
          (title || description) && (
            <div class="mb-10">
              {title && (
                <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
                  {title}
                </h2>
              )}
              {description && (
                <p class="mt-4 max-w-2xl text-lg text-gray-600 dark:text-gray-300">{description}</p>
              )}
            </div>
          )
        }

        <div class="space-y-6">
          {
            items.map((item, index) => (
              <div
                class={[
                  "flex gap-4 align-middle",
                  variant === "numbered" && "items-start",
                  variant === "icons" && "items-start",
                ].join(" ")}
              >
                <div
                  class={`flex h-12 w-12 shrink-0 items-center justify-center rounded-lg ${iconContainerClass}`}
                >
                  {variant === "numbered" ? (
                    <span class="text-lg font-bold">{index + 1}</span>
                  ) : (
                    <SimpleIcon name={getIcon(item, index)} class="h-6 w-6" />
                  )}
                </div>
                <div class="flex-1">
                  <h3 class={globalTextH3}>{item.title}</h3>
                  {item.description && (
                    <p class="mt-1 text-gray-600 dark:text-gray-300">{item.description}</p>
                  )}
                </div>
              </div>
            ))
          }
        </div>
      </div>

      {
        imageSrc && imagePosition === "right" && (
          <div class="relative">
            <img src={imageSrc} alt={imageAlt} class="w-full rounded-lg object-cover shadow-lg" />
          </div>
        )
      }
    </div>
  </div>
</section>
