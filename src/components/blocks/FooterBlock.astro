---
/**
 * FooterBlock - Footer Section
 *
 * Flexible footer component with multiple layout variants.
 *
 * @example:
 * <FooterBlock
 *   logo="/logo.svg"
 *   description="Fire protection solutions"
 *   copyright="© 2024 Company Name"
 * />
 */
import SimpleIcon from "../common/SimpleIcon.astro";
import { parseJsonProp } from "./BlockRegistry";

interface FooterLink {
  text: string;
  href: string;
}

interface FooterSection {
  title: string;
  links: FooterLink[];
}

interface SocialLink {
  icon: string;
  href: string;
  label?: string;
}

interface Props {
  // Branding
  logo?: string;
  logoAlt?: string;
  companyName?: string;
  description?: string;

  // Copyright
  copyright?: string;

  // Layout
  variant?: "standard" | "minimal" | "centered" | "columns";

  // Links as JSON
  links?: string | FooterSection[];
  socialLinks?: string | SocialLink[];

  // Flat props for simple links (comma-separated: "text:href,text:href")
  simpleLinks?: string;

  // Contact info
  email?: string;
  phone?: string;
  address?: string;

  // Styling
  backgroundColor?: string;
  className?: string;
  id?: string;
}

const props = Astro.props;
const {
  logo,
  logoAlt = "Logo",
  companyName,
  description,
  copyright,
  variant = "standard",
  email,
  phone,
  address,
  backgroundColor,
  className = "",
  id,
} = props;

// Parse links
const linkSections: FooterSection[] = props.links
  ? parseJsonProp<FooterSection[]>(props.links, [])
  : [];

const socialLinksArray: SocialLink[] = props.socialLinks
  ? parseJsonProp<SocialLink[]>(props.socialLinks, [])
  : [];

// Parse simple links
const simpleLinksArray: FooterLink[] = props.simpleLinks
  ? props.simpleLinks
      .split(",")
      .map((item: string) => {
        const [text, href] = item.trim().split(":");
        return { text: text?.trim() || "", href: href?.trim() || "#" };
      })
      .filter((link: FooterLink) => link.text)
  : [];

const currentYear = new Date().getFullYear();
const defaultCopyright = `© ${currentYear} ${companyName || "Company"}. All rights reserved.`;
---

<footer {id} class:list={["footer-block", backgroundColor || "bg-gray-900", className]}>
  {
    variant === "minimal" ? (
      <div class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center justify-between gap-4 md:flex-row">
          <div class="flex items-center gap-4">
            {logo && (
              <img
                data-src={logo}
                alt={logoAlt}
                width="120"
                height="32"
                class="lazyload h-8 w-auto"
              />
            )}
            {companyName && <span class="font-semibold text-white">{companyName}</span>}
          </div>

          {simpleLinksArray.length > 0 && (
            <nav class="flex flex-wrap items-center gap-6">
              {simpleLinksArray.map((link) => (
                <a
                  href={link.href}
                  class="text-sm text-gray-400 transition-colors hover:text-white"
                >
                  {link.text}
                </a>
              ))}
            </nav>
          )}

          <p class="text-sm text-gray-400">{copyright || defaultCopyright}</p>
        </div>
      </div>
    ) : variant === "centered" ? (
      <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
        <div class="text-center">
          {logo && (
            <img
              data-src={logo}
              alt={logoAlt}
              width="120"
              height="40"
              class="lazyload mx-auto mb-4 h-10 w-auto"
            />
          )}
          {companyName && <h3 class="mb-2 text-xl font-bold text-white">{companyName}</h3>}
          {description && <p class="mx-auto mb-6 max-w-md text-gray-400">{description}</p>}

          {simpleLinksArray.length > 0 && (
            <nav class="mb-6 flex flex-wrap items-center justify-center gap-6">
              {simpleLinksArray.map((link) => (
                <a href={link.href} class="text-gray-400 transition-colors hover:text-white">
                  {link.text}
                </a>
              ))}
            </nav>
          )}

          {socialLinksArray.length > 0 && (
            <div class="mb-8 flex items-center justify-center gap-4">
              {socialLinksArray.map((social) => (
                <a
                  href={social.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-gray-400 transition-colors hover:text-white"
                  aria-label={social.label || social.icon}
                >
                  <SimpleIcon name={social.icon} class="h-6 w-6" />
                </a>
              ))}
            </div>
          )}

          <p class="text-sm text-gray-500">{copyright || defaultCopyright}</p>
        </div>
      </div>
    ) : variant === "columns" ? (
      <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
        <div class="grid gap-8 lg:grid-cols-4">
          {/* Brand column */}
          <div class="lg:col-span-1">
            {logo && (
              <img
                data-src={logo}
                alt={logoAlt}
                width="120"
                height="40"
                class="lazyload mb-4 h-10 w-auto"
              />
            )}
            {companyName && !logo && (
              <h3 class="mb-2 text-xl font-bold text-white">{companyName}</h3>
            )}
            {description && <p class="text-sm text-gray-400">{description}</p>}

            {socialLinksArray.length > 0 && (
              <div class="mt-4 flex items-center gap-4">
                {socialLinksArray.map((social) => (
                  <a
                    href={social.href}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-gray-400 transition-colors hover:text-white"
                    aria-label={social.label || social.icon}
                  >
                    <SimpleIcon name={social.icon} class="h-5 w-5" />
                  </a>
                ))}
              </div>
            )}
          </div>

          {/* Link columns */}
          {linkSections.map((section) => (
            <div>
              <h4 class="mb-4 text-sm font-semibold uppercase tracking-wider text-white">
                {section.title}
              </h4>
              <ul class="space-y-3">
                {section.links.map((link) => (
                  <li>
                    <a
                      href={link.href}
                      class="text-sm text-gray-400 transition-colors hover:text-white"
                    >
                      {link.text}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>

        <div class="mt-12 border-t border-gray-800 pt-8 text-center">
          <p class="text-sm text-gray-500">{copyright || defaultCopyright}</p>
        </div>
      </div>
    ) : (
      <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
        <div class="grid gap-8 lg:grid-cols-6">
          {/* Brand section */}
          <div class="lg:col-span-2">
            {logo && (
              <img
                data-src={logo}
                alt={logoAlt}
                width="120"
                height="40"
                class="lazyload mb-4 h-10 w-auto"
              />
            )}
            {companyName && !logo && (
              <h3 class="mb-2 text-xl font-bold text-white">{companyName}</h3>
            )}
            {description && <p class="mb-4 text-gray-400">{description}</p>}

            {/* Contact info */}
            {(email || phone || address) && (
              <div class="space-y-2 text-sm">
                {email && (
                  <a
                    href={`mailto:${email}`}
                    class="flex items-center gap-2 text-gray-400 transition-colors hover:text-white"
                  >
                    <SimpleIcon name="envelope" class="h-4 w-4" />
                    {email}
                  </a>
                )}
                {phone && (
                  <a
                    href={`tel:${phone}`}
                    class="flex items-center gap-2 text-gray-400 transition-colors hover:text-white"
                  >
                    <SimpleIcon name="phone" class="h-4 w-4" />
                    {phone}
                  </a>
                )}
                {address && (
                  <p class="flex items-start gap-2 text-gray-400">
                    <SimpleIcon name="map-pin" class="mt-0.5 h-4 w-4 shrink-0" />
                    {address}
                  </p>
                )}
              </div>
            )}
          </div>

          {/* Link sections */}
          {linkSections.map((section) => (
            <div>
              <h4 class="mb-4 text-sm font-semibold uppercase tracking-wider text-white">
                {section.title}
              </h4>
              <ul class="space-y-3">
                {section.links.map((link) => (
                  <li>
                    <a
                      href={link.href}
                      class="text-sm text-gray-400 transition-colors hover:text-white"
                    >
                      {link.text}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>

        {/* Bottom section */}
        <div class="mt-12 flex flex-col items-center justify-between gap-4 border-t border-gray-800 pt-8 md:flex-row">
          <p class="text-sm text-gray-500">{copyright || defaultCopyright}</p>

          {socialLinksArray.length > 0 && (
            <div class="flex items-center gap-4">
              {socialLinksArray.map((social) => (
                <a
                  href={social.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-gray-400 transition-colors hover:text-white"
                  aria-label={social.label || social.icon}
                >
                  <SimpleIcon name={social.icon} class="h-5 w-5" />
                </a>
              ))}
            </div>
          )}
        </div>
      </div>
    )
  }
</footer>
