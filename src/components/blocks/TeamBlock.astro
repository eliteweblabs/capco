---
/**
 * TeamBlock - Team Member Cards
 * 
 * Display team members in a grid with photos and social links.
 * 
 * @example With JSON:
 * <TeamBlock 
 *   title="Our Team"
 *   members={[
 *     { name: "John Doe", role: "CEO", photo: "/images/john.jpg", bio: "..." },
 *   ]}
 * />
 */
import SimpleIcon from "../common/SimpleIcon.astro";
import { parseJsonProp, buildArrayFromFlatProps } from "./BlockRegistry";

interface TeamMember {
  name: string;
  role?: string;
  photo?: string;
  bio?: string;
  email?: string;
  phone?: string;
  linkedin?: string;
  twitter?: string;
}

interface Props {
  // Section content
  title?: string;
  description?: string;
  
  // Layout
  variant?: 'grid' | 'cards' | 'compact' | 'detailed';
  columns?: number | string;
  
  // Members as JSON
  members?: string | TeamMember[];
  
  // Flat props for up to 8 members
  member1Name?: string;
  member1Role?: string;
  member1Photo?: string;
  member1Bio?: string;
  member1Email?: string;
  member1Linkedin?: string;
  member2Name?: string;
  member2Role?: string;
  member2Photo?: string;
  member2Bio?: string;
  member2Email?: string;
  member2Linkedin?: string;
  member3Name?: string;
  member3Role?: string;
  member3Photo?: string;
  member3Bio?: string;
  member3Email?: string;
  member3Linkedin?: string;
  member4Name?: string;
  member4Role?: string;
  member4Photo?: string;
  member4Bio?: string;
  member4Email?: string;
  member4Linkedin?: string;
  member5Name?: string;
  member5Role?: string;
  member5Photo?: string;
  member5Bio?: string;
  member5Email?: string;
  member5Linkedin?: string;
  member6Name?: string;
  member6Role?: string;
  member6Photo?: string;
  member6Bio?: string;
  member6Email?: string;
  member6Linkedin?: string;
  member7Name?: string;
  member7Role?: string;
  member7Photo?: string;
  member7Bio?: string;
  member7Email?: string;
  member7Linkedin?: string;
  member8Name?: string;
  member8Role?: string;
  member8Photo?: string;
  member8Bio?: string;
  member8Email?: string;
  member8Linkedin?: string;
  
  // Styling
  className?: string;
  id?: string;
}

const props = Astro.props;
const {
  title,
  description,
  variant = 'grid',
  className = '',
  id,
} = props;

const columns = typeof props.columns === 'string' ? parseInt(props.columns) : (props.columns ?? 4);

// Build members array
let memberItems: TeamMember[] = [];

if (props.members) {
  memberItems = parseJsonProp<TeamMember[]>(props.members, []);
} else {
  memberItems = buildArrayFromFlatProps<TeamMember>(
    props,
    'member',
    ['name', 'role', 'photo', 'bio', 'email', 'phone', 'linkedin', 'twitter'],
    8
  );
}

// Column classes
const columnClasses: Record<number, string> = {
  2: 'grid-cols-1 sm:grid-cols-2',
  3: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4',
};

const gridClass = columnClasses[columns] || columnClasses[4];

// Get initials from name
const getInitials = (name: string): string => {
  return name
    .split(' ')
    .map(n => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
};
---

<section id={id} class:list={['team-block py-16 md:py-24', className]}>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    {(title || description) && (
      <div class="mb-12 text-center">
        {title && (
          <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
            {title}
          </h2>
        )}
        {description && (
          <p class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
            {description}
          </p>
        )}
      </div>
    )}
    
    <div class={`grid gap-8 ${gridClass}`}>
      {memberItems.map((member) => (
        <div 
          class:list={[
            'team-member group',
            variant === 'cards' && 'rounded-xl bg-white dark:bg-gray-800 p-6 shadow-sm border border-gray-100 dark:border-gray-700 text-center',
            variant === 'grid' && 'text-center',
            variant === 'compact' && 'flex items-center gap-4',
            variant === 'detailed' && 'rounded-xl bg-white dark:bg-gray-800 p-6 shadow-sm',
          ]}
        >
          {/* Photo */}
          <div class={variant === 'compact' ? 'shrink-0' : 'mb-4'}>
            {member.photo ? (
              <img 
                src={member.photo} 
                alt={member.name}
                class:list={[
                  'object-cover',
                  variant === 'compact' && 'h-16 w-16 rounded-full',
                  variant === 'cards' && 'h-32 w-32 rounded-full mx-auto',
                  variant === 'grid' && 'h-40 w-40 rounded-full mx-auto',
                  variant === 'detailed' && 'h-24 w-24 rounded-full',
                ]}
              />
            ) : (
              <div 
                class:list={[
                  'flex items-center justify-center bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 font-bold',
                  variant === 'compact' && 'h-16 w-16 rounded-full text-lg',
                  variant === 'cards' && 'h-32 w-32 rounded-full mx-auto text-2xl',
                  variant === 'grid' && 'h-40 w-40 rounded-full mx-auto text-3xl',
                  variant === 'detailed' && 'h-24 w-24 rounded-full text-xl',
                ]}
              >
                {getInitials(member.name)}
              </div>
            )}
          </div>
          
          {/* Info */}
          <div class={variant === 'compact' ? '' : ''}>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
              {member.name}
            </h3>
            {member.role && (
              <p class="text-primary-600 dark:text-primary-400 font-medium">
                {member.role}
              </p>
            )}
            {member.bio && (variant === 'detailed' || variant === 'cards') && (
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-300 line-clamp-3">
                {member.bio}
              </p>
            )}
            
            {/* Social links */}
            {(member.email || member.linkedin || member.twitter) && (
              <div class={`flex gap-3 mt-4 ${variant === 'compact' ? '' : 'justify-center'}`}>
                {member.email && (
                  <a 
                    href={`mailto:${member.email}`}
                    class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                    aria-label={`Email ${member.name}`}
                  >
                    <SimpleIcon name="envelope" class="h-5 w-5" />
                  </a>
                )}
                {member.linkedin && (
                  <a 
                    href={member.linkedin}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                    aria-label={`${member.name}'s LinkedIn`}
                  >
                    <SimpleIcon name="linkedin" class="h-5 w-5" />
                  </a>
                )}
                {member.twitter && (
                  <a 
                    href={member.twitter}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                    aria-label={`${member.name}'s Twitter`}
                  >
                    <SimpleIcon name="twitter" class="h-5 w-5" />
                  </a>
                )}
                {member.phone && (
                  <a 
                    href={`tel:${member.phone}`}
                    class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                    aria-label={`Call ${member.name}`}
                  >
                    <SimpleIcon name="phone" class="h-5 w-5" />
                  </a>
                )}
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
