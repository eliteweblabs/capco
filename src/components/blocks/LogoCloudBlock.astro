---
/**
 * LogoCloudBlock - Partner/Client Logos
 * 
 * Display partner, client, or technology logos.
 * Supports static grid or animated marquee.
 * Now supports Font Awesome icons as well as images.
 * 
 * @example with images:
 * <LogoCloudBlock 
 *   title="Trusted By"
 *   logos={[
 *     { src: "/logos/company1.png", alt: "Company 1", href: "https://..." },
 *   ]}
 * />
 * 
 * @example with Font Awesome icons:
 * <LogoCloudBlock 
 *   title="Industries We Serve"
 *   logo1Icon="fa-solid fa-leaf"
 *   logo1Alt="Environmental"
 *   logo1IconColor="text-green-600"
 *   logo2Icon="fa-solid fa-hospital"
 *   logo2Alt="Healthcare"
 *   logo2IconColor="text-blue-600"
 * />
 */
import { parseJsonProp, buildArrayFromFlatProps } from "./BlockRegistry";

interface Logo {
  src?: string;
  alt: string;
  href?: string;
  width?: number;
  icon?: string; // Font Awesome icon class (e.g., "fa-solid fa-leaf")
  iconColor?: string; // Tailwind color class (e.g., "text-green-600")
}

interface Props {
  // Section content
  title?: string;
  description?: string;
  
  // Layout
  variant?: 'simple' | 'grid' | 'marquee' | 'centered';
  columns?: number | string;
  grayscale?: boolean | string;
  
  // Logos as JSON
  logos?: string | Logo[];
  
  // Flat props for up to 12 logos
  logo1Src?: string;
  logo1Alt?: string;
  logo1Href?: string;
  logo1Icon?: string;
  logo1IconColor?: string;
  logo2Src?: string;
  logo2Alt?: string;
  logo2Href?: string;
  logo2Icon?: string;
  logo2IconColor?: string;
  logo3Src?: string;
  logo3Alt?: string;
  logo3Href?: string;
  logo3Icon?: string;
  logo3IconColor?: string;
  logo4Src?: string;
  logo4Alt?: string;
  logo4Href?: string;
  logo4Icon?: string;
  logo4IconColor?: string;
  logo5Src?: string;
  logo5Alt?: string;
  logo5Href?: string;
  logo5Icon?: string;
  logo5IconColor?: string;
  logo6Src?: string;
  logo6Alt?: string;
  logo6Href?: string;
  logo6Icon?: string;
  logo6IconColor?: string;
  logo7Src?: string;
  logo7Alt?: string;
  logo7Href?: string;
  logo7Icon?: string;
  logo7IconColor?: string;
  logo8Src?: string;
  logo8Alt?: string;
  logo8Href?: string;
  logo8Icon?: string;
  logo8IconColor?: string;
  logo9Src?: string;
  logo9Alt?: string;
  logo9Href?: string;
  logo9Icon?: string;
  logo9IconColor?: string;
  logo10Src?: string;
  logo10Alt?: string;
  logo10Href?: string;
  logo10Icon?: string;
  logo10IconColor?: string;
  logo11Src?: string;
  logo11Alt?: string;
  logo11Href?: string;
  logo11Icon?: string;
  logo11IconColor?: string;
  logo12Src?: string;
  logo12Alt?: string;
  logo12Href?: string;
  logo12Icon?: string;
  logo12IconColor?: string;
  
  // Styling
  className?: string;
  id?: string;
  
  // Animation (note: stagger disabled for LogoCloudBlock to preserve grayscale filters)
  animate?: boolean | string | 'fade-blur-scale' | 'fade-blur' | 'fade-scale' | 'fade-up' | 'fade-up-blur' | 'zoom-blur' | 'fade';
  animateDelay?: string;
}

const props = Astro.props;
const {
  title,
  description,
  variant = 'simple',
  className = '',
  id,
} = props;

const columns = typeof props.columns === 'string' ? parseInt(props.columns) : (props.columns ?? 6);
const grayscale = props.grayscale === 'false' ? false : (props.grayscale ?? true);

// Handle animation prop - enabled by default
const getAnimationType = () => {
  if (props.animate === 'false' || props.animate === false) return null;
  if (props.animate === 'true' || props.animate === true) return 'fade-blur';
  if (typeof props.animate === 'string') return props.animate;
  return 'fade-blur'; // Default animation
};
const animationType = getAnimationType();
const animateDelay = props.animateDelay;

// Build logos array
let logoItems: Logo[] = [];

if (props.logos) {
  logoItems = parseJsonProp<Logo[]>(props.logos, []);
} else {
  logoItems = buildArrayFromFlatProps<Logo>(
    props,
    'logo',
    ['src', 'alt', 'href', 'width', 'icon', 'iconColor'],
    12
  );
}

// Column classes
const columnClasses: Record<number, string> = {
  3: 'grid-cols-2 sm:grid-cols-3',
  4: 'grid-cols-2 sm:grid-cols-4',
  5: 'grid-cols-2 sm:grid-cols-5',
  6: 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-6',
};

const gridClass = columnClasses[columns] || columnClasses[6];
---

<section 
  id={id} 
  class:list={['logo-cloud-block py-12 md:py-16', className]}
  data-animate={animationType || undefined}
  data-animate-delay={animateDelay || undefined}
>
  <div class="w-full px-4 sm:px-6 lg:px-8">
    {(title || description) && (
      <div class="mb-10 text-center">
        {title && (
          <h2 class="text-lg font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">
            {title}
          </h2>
        )}
        {description && (
          <p class="mt-2 text-gray-500 dark:text-gray-400">
            {description}
          </p>
        )}
      </div>
    )}
    
    {variant === 'marquee' ? (
      <div class="relative overflow-hidden">
        {/* Fade edges */}
        <div class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-white dark:from-gray-900 to-transparent z-10" />
        <div class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-white dark:from-gray-900 to-transparent z-10" />
        
        <div class="flex animate-marquee gap-16">
          {[...logoItems, ...logoItems].map((logo) => (
            logo.href ? (
              <a 
                href={logo.href}
                target="_blank"
                rel="noopener noreferrer"
                class="flex-shrink-0"
              >
                {logo.icon ? (
                  <i 
                    class:list={[
                      logo.icon,
                      'text-4xl',
                      logo.iconColor || 'text-gray-600 dark:text-gray-400',
                      grayscale && 'grayscale opacity-60 hover:grayscale-0 hover:opacity-100 transition-all',
                    ]}
                    title={logo.alt}
                  />
                ) : (
                  <img 
                    data-src={logo.src} 
                    alt={logo.alt}
                    width={logo.width || 160}
                    height="40"
                    class:list={[
                      'lazyload blur-sm h-10 w-auto object-contain',
                      grayscale && 'grayscale opacity-60 hover:grayscale-0 hover:opacity-100 transition-all',
                    ]}
                  />
                )}
              </a>
            ) : logo.icon ? (
              <i 
                class:list={[
                  logo.icon,
                  'text-4xl flex-shrink-0',
                  logo.iconColor || 'text-gray-600 dark:text-gray-400',
                  grayscale && 'grayscale opacity-60',
                ]}
                title={logo.alt}
              />
            ) : (
              <img 
                data-src={logo.src} 
                alt={logo.alt}
                width={logo.width || 160}
                height="40"
                class:list={[
                  'lazyload blur-sm h-10 w-auto object-contain flex-shrink-0',
                  grayscale && 'grayscale opacity-60',
                ]}
              />
            )
          ))}
        </div>
      </div>
    ) : variant === 'centered' ? (
      <div class="flex flex-wrap items-center justify-evenly gap-y-8">
        {logoItems.map((logo) => (
          logo.href ? (
            <a 
              href={logo.href}
              target="_blank"
              rel="noopener noreferrer"
              class="group"
            >
              {logo.icon ? (
                <i 
                  class:list={[
                    logo.icon,
                    'text-4xl',
                    logo.iconColor || 'text-gray-600 dark:text-gray-400',
                    grayscale && 'grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all',
                  ]}
                  title={logo.alt}
                />
              ) : (
                <img 
                  src={logo.src} 
                  alt={logo.alt}
                  class:list={[
                    'h-10 w-auto object-contain',
                    grayscale && 'grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all',
                  ]}
                  width={logo.width || 160}
                />
              )}
            </a>
          ) : logo.icon ? (
            <i 
              class:list={[
                logo.icon,
                'text-4xl',
                logo.iconColor || 'text-gray-600 dark:text-gray-400',
                grayscale && 'grayscale opacity-60',
              ]}
              title={logo.alt}
            />
          ) : (
            <img 
              src={logo.src} 
              alt={logo.alt}
              class:list={[
                'h-10 w-auto object-contain',
                grayscale && 'grayscale opacity-60',
              ]}
              width={logo.width || 160}
            />
          )
        ))}
      </div>
    ) : (
      <div class="flex flex-wrap items-center justify-evenly gap-y-8">
        {logoItems.map((logo) => (
          logo.href ? (
            <a 
              href={logo.href}
              target="_blank"
              rel="noopener noreferrer"
              class="group"
            >
              {logo.icon ? (
                <i 
                  class:list={[
                    logo.icon,
                    'text-4xl',
                    logo.iconColor || 'text-gray-600 dark:text-gray-400',
                    grayscale && 'grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all',
                  ]}
                  title={logo.alt}
                />
              ) : (
                <img 
                  src={logo.src} 
                  alt={logo.alt}
                  class:list={[
                    'h-10 w-auto object-contain',
                    grayscale && 'grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all',
                  ]}
                  width={logo.width || 160}
                />
              )}
            </a>
          ) : logo.icon ? (
            <i 
              class:list={[
                logo.icon,
                'text-4xl',
                logo.iconColor || 'text-gray-600 dark:text-gray-400',
                grayscale && 'grayscale opacity-60',
              ]}
              title={logo.alt}
            />
          ) : (
            <img 
              src={logo.src} 
              alt={logo.alt}
              class:list={[
                'h-10 w-auto object-contain',
                grayscale && 'grayscale opacity-60',
              ]}
              width={logo.width || 160}
            />
          )
        ))}
      </div>
    )}
  </div>
</section>

{variant === 'marquee' && (
  <style>
    @keyframes marquee {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }
    
    .animate-marquee {
      animation: marquee 30s linear infinite;
    }
    
    .animate-marquee:hover {
      animation-play-state: paused;
    }
  </style>
)}
