---
// Flowbite Dashboard Layout Component
// Main layout for dashboard pages

import FlowbiteSidebar from "./FlowbiteSidebar.astro";
import Navbar from "./Navbar.astro";

interface Props {
  isAuth: boolean;
  currentUser: any;
  currentRole: string;
  session: any;
  desktopNavigationHTML: string;
  id?: string;
  pageTitle?: string;
  showSidebar?: boolean;
}

const {
  isAuth,
  currentUser,
  currentRole,
  session,
  desktopNavigationHTML,
  id,
  pageTitle = "Dashboard",
  showSidebar = true,
} = Astro.props;
---

<div class="flex h-screen overflow-hidden bg-gray-50 dark:bg-gray-900">
  <!-- Sidebar -->
  {
    showSidebar && (
      <FlowbiteSidebar
        isAuth={isAuth}
        currentUser={currentUser}
        currentRole={currentRole}
        session={session}
      />
    )
  }

  <!-- Main content area -->
  <div id="main-content" class="flex-1 overflow-y-auto overflow-x-hidden">
    <main>
      <div class="p-6">
        <!-- Top navigation (inside main content, not sticky) -->
        <Navbar
          currentUser={currentUser}
          session={session}
          desktopNavigationHTML={desktopNavigationHTML}
          id={id}
          isBackend={false}
        />

        <!-- Page header -->
        <div class="mb-8 mt-6">
          <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">
            {pageTitle}
          </h1>
          <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
            Welcome back! Here's what's happening with your projects today.
          </p>
        </div>

        <!-- Page content -->
        <slot />
      </div>
    </main>
  </div>

  <!-- Mobile sidebar overlay -->
  <div id="sidebar-overlay" class="fixed inset-0 z-40 hidden bg-gray-900 bg-opacity-50 lg:hidden">
  </div>
</div>

<!-- Mobile sidebar toggle button -->
<button
  id="sidebar-toggle"
  type="button"
  class="ml-3 mt-2 inline-flex items-center rounded-lg p-2 text-sm text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 sm:hidden"
>
  <span class="sr-only">Open sidebar</span>
  <i class="bx bx-menu text-xl"></i>
</button>

<script>
  // Mobile sidebar toggle
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarToggle = document.getElementById("sidebar-toggle");
    const sidebar = document.getElementById("sidebar");
    const sidebarOverlay = document.getElementById("sidebar-overlay");

    if (sidebarToggle && sidebar) {
      sidebarToggle.addEventListener("click", function () {
        sidebar.classList.toggle("-translate-x-full");
        if (sidebarOverlay) {
          sidebarOverlay.classList.toggle("hidden");
        }
      });
    }

    if (sidebarOverlay) {
      sidebarOverlay.addEventListener("click", function () {
        sidebar.classList.add("-translate-x-full");
        sidebarOverlay.classList.add("hidden");
      });
    }
  });
</script>
