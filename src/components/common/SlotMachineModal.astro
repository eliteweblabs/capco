---
import SlotMachinePicker from "./SlotMachinePicker.astro";

interface Props {
  id: string;
  title: string;
  options: Array<{ value: string; label: string; disabled?: boolean }>;
  selectedValue?: string;
  placeholder?: string;
  onSelect?: string; // Function name to call when item is selected
  show?: boolean;
}

const {
  id,
  title,
  options = [],
  selectedValue = "",
  placeholder = "Select an option...",
  onSelect = "handleSlotMachineSelect",
  show = false,
} = Astro.props;
---

{
  show && (
    <div
      id={`${id}-modal`}
      class="modal-overlay fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
      role="dialog"
      aria-modal="true"
      aria-labelledby={`${id}-modal-title`}
    >
      <div class="modal-content relative">
        <SlotMachinePicker
          id={id}
          title={title}
          options={options}
          selectedValue={selectedValue}
          placeholder={placeholder}
          onSelect={onSelect}
        />
      </div>
    </div>
  )
}

<style>
  .modal-overlay {
    backdrop-filter: blur(4px);
    animation: modalFadeIn 0.2s ease-out;
  }

  .modal-content {
    animation: modalSlideIn 0.3s ease-out;
    transform-origin: center;
  }

  @keyframes modalFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Close modal when clicking outside */
  .modal-overlay {
    cursor: pointer;
  }

  .modal-content {
    cursor: default;
  }
</style>

<script define:vars={{ id }}>
  document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById(`${id}-modal`);

    if (modal) {
      // Close modal when clicking outside
      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          modal.remove();
        }
      });

      // Close modal with Escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && modal.parentNode) {
          modal.remove();
        }
      });
    }
  });
</script>
