---
// Enable this component to work as both regular component and partial
export const partial = true;
import { getTooltipClasses } from "../../lib/tooltip-styles";

// Tooltip component for standardized tooltip styling throughout the project
export interface Props {
  text?: string;
  position?: "top" | "bottom" | "left" | "right";
  className?: string;
  tooltipClass?: string;
  disabled?: boolean;
  open?: boolean;
  dismissable?: boolean;
}

// Check if this is being used as a partial (X-headers present) or regular component
const isPartial =
  Astro.request.headers.has("x-tooltip-text") || Astro.request.headers.has("x-tooltip-position");

// Extract props from either Astro.props or X-headers
const text = Astro.props.text || Astro.request.headers.get("x-tooltip-text") || "";
const position = (Astro.props.position || Astro.request.headers.get("x-tooltip-position") || "top") as "top" | "bottom" | "left" | "right";
const className = Astro.props.className || Astro.request.headers.get("x-tooltip-class-name") || "";
const tooltipClass = Astro.props.tooltipClass || Astro.request.headers.get("x-tooltip-class") || "";
const disabled =
  Astro.props.disabled || Astro.request.headers.get("x-tooltip-disabled") === "true" || false;
const open = Astro.props.open || Astro.request.headers.get("x-tooltip-open") === "true" || false;
const dismissable = Astro.props.dismissable || Astro.request.headers.get("x-tooltip-dismissable") === "true" || false;

// Get slot content for partial mode
const slotContent = Astro.request.headers.get("x-tooltip-slot-content") || "";

// Use shared tooltip styling logic
const { wrapperClasses, tooltipClasses, arrowClasses } = getTooltipClasses({
  position,
  className,
  tooltipClass,
  disabled,
  open,
});
---

<span class={wrapperClasses} style="vertical-align: baseline; white-space: nowrap;">
  {isPartial && slotContent ? <Fragment set:html={slotContent} /> : <slot />}
  <span class={tooltipClasses}>
    <span class="cursor-pointer">{text}</span>
    <span class={arrowClasses} style="display: block;"></span>
  </span>
</span>
