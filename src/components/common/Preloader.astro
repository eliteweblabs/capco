---
// Simple preloader component
import LoadingSpinner from "../ui/LoadingSpinner.astro";
---

<div
  id="preloader"
  class="fixed inset-0 flex min-h-[100dvh] w-screen items-center justify-center color-background touch-none overflow-hidden scrollbar-hide"
  style="z-index:999999;"
>
  <LoadingSpinner color="primary" size="lg" />
  <!-- <LoadingSpinner size="lg" color="primary" loadingText="Signing you in..." /> -->
</div>

<script>
  // Hide preloader when page is loaded
  function hidePreloader() {
    // const preloader = document.getElementById("preloader");
    // if (preloader) {
    //   console.log("✅ [PRELOADER] Hiding preloader");
    //   preloader.style.opacity = "0";
    //   preloader.style.pointerEvents = "none";
    //   setTimeout(() => {
    //     preloader.style.display = "none";
    //   }, 300);
    // } else {
    //   console.log("❌ [PRELOADER] Preloader element not found");
    // }
  }

  // Try to hide immediately (for cached pages)
  if (document.readyState === "complete") {
    console.log("✅ [PRELOADER] Page already loaded, hiding immediately");
    hidePreloader();
  }

  // Try multiple events to ensure preloader hides
  window.addEventListener("load", () => {
    console.log("✅ [PRELOADER] window.load event fired");
    hidePreloader();
  });

  document.addEventListener("DOMContentLoaded", function () {
    console.log("✅ [PRELOADER] DOMContentLoaded event fired");
    // Add a small delay to ensure everything is ready
    setTimeout(hidePreloader, 100);
  });

  // Fallback: hide after 1 second regardless
  setTimeout(() => {
    console.log("✅ [PRELOADER] Fallback timeout (1s) fired");
    hidePreloader();
  }, 1000);

  // Immediate fallback for debugging
  setTimeout(() => {
    console.log("✅ [PRELOADER] Immediate fallback (100ms) fired");
    hidePreloader();
  }, 100);
</script>

<style>
  #preloader {
    transition: opacity 0.3s ease-out;
  }
</style>
