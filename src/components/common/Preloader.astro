---
// Simple preloader component
import LoadingSpinner from "../ui/LoadingSpinner.astro";
---

<div
  id="preloader"
  class="fixed inset-0 z-50 flex min-h-[100dvh] w-screen items-center justify-center color-background pointer-events-none"
  style="z-index:999999;"
>
  <LoadingSpinner color="primary" size="lg" />
  <!-- <LoadingSpinner size="lg" color="primary" loadingText="Signing you in..." /> -->
</div>

<script>
  // Apply theme immediately to prevent flash
  (function () {
    const hasExplicitThemePreference = localStorage.getItem("color-theme") !== null;

    if (hasExplicitThemePreference) {
      // User has explicitly set a preference, apply it
      if (localStorage.getItem("color-theme") === "dark") {
        document.documentElement.classList.add("dark", "zD1iTsv7EQco3GO_szee");
      } else {
        document.documentElement.classList.remove("dark", "zD1iTsv7EQco3GO_szee");
      }
    } else {
      // No explicit preference, check system preference
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        document.documentElement.classList.add("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "dark");
      } else {
        document.documentElement.classList.remove("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "light");
      }
    }
  })();
</script>

<script>
  // Hide preloader when page is loaded
  function hidePreloader() {
    const preloader = document.getElementById("preloader");
    if (preloader) {
      console.log("✅ [PRELOADER] Hiding preloader");
      preloader.style.opacity = "0";
      preloader.style.pointerEvents = "none";
      setTimeout(() => {
        preloader.style.display = "none";
      }, 300);
    } else {
      console.log("❌ [PRELOADER] Preloader element not found");
    }
  }

  // Try to hide immediately (for cached pages)
  if (document.readyState === "complete") {
    console.log("✅ [PRELOADER] Page already loaded, hiding immediately");
    hidePreloader();
  }

  // Try multiple events to ensure preloader hides
  window.addEventListener("load", () => {
    console.log("✅ [PRELOADER] window.load event fired");
    hidePreloader();
  });

  document.addEventListener("DOMContentLoaded", function () {
    console.log("✅ [PRELOADER] DOMContentLoaded event fired");
    // Add a small delay to ensure everything is ready
    setTimeout(hidePreloader, 100);
  });

  // Fallback: hide after 1 second regardless
  setTimeout(() => {
    console.log("✅ [PRELOADER] Fallback timeout (1s) fired");
    hidePreloader();
  }, 1000);

  // Immediate fallback for debugging
  setTimeout(() => {
    console.log("✅ [PRELOADER] Immediate fallback (100ms) fired");
    hidePreloader();
  }, 100);
</script>

<style>
  #preloader {
    transition: opacity 0.3s ease-out;
  }
</style>
