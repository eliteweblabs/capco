---
// Simple preloader component
import LoadingSpinner from "./LoadingSpinner.astro";
---

<div
  id="preloader"
  class="fixed inset-0 z-50 flex h-[100dvh] w-screen items-center justify-center bg-gray-100 dark:bg-gray-900"
>
  <LoadingSpinner />
</div>

<script>
  // Apply theme immediately to prevent flash
  (function () {
    const hasExplicitPreference = localStorage.getItem("color-theme") !== null;

    if (hasExplicitPreference) {
      // User has explicitly set a preference, apply it
      if (localStorage.getItem("color-theme") === "dark") {
        document.documentElement.classList.add("dark", "zD1iTsv7EQco3GO_szee");
      } else {
        document.documentElement.classList.remove("dark", "zD1iTsv7EQco3GO_szee");
      }
    } else {
      // No explicit preference, check system preference
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        document.documentElement.classList.add("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "dark");
      } else {
        document.documentElement.classList.remove("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "light");
      }
    }
  })();
</script>

<script>
  // Hide preloader when page is loaded
  function hidePreloader() {
    const preloader = document.getElementById("preloader");
    if (preloader) {
      console.log("✅ [PRELOADER] Hiding preloader");
      preloader.style.opacity = "0";
      setTimeout(() => {
        preloader.style.display = "none";
      }, 300);
    } else {
      console.log("❌ [PRELOADER] Preloader element not found");
    }
  }

  // Try multiple events to ensure preloader hides
  window.addEventListener("load", hidePreloader);
  document.addEventListener("DOMContentLoaded", function () {
    console.log("✅ [PRELOADER] DOMContentLoaded event fired");
    // Add a small delay to ensure everything is ready
    setTimeout(hidePreloader, 100);
  });

  // Fallback: hide after 1 second regardless
  setTimeout(() => {
    console.log("✅ [PRELOADER] Fallback timeout fired");
    hidePreloader();
  }, 1000);

  // Immediate fallback for debugging
  setTimeout(() => {
    console.log("✅ [PRELOADER] Immediate fallback fired");
    hidePreloader();
  }, 100);
</script>

<style>
  #preloader {
    transition: opacity 0.3s ease-out;
  }
</style>
