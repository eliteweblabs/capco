---
import StaffSelect from "../project/StaffSelectDropdown.astro";
import SectionContainer from "./SectionContainer.astro";
import SlotMachineModal from "../form/SlotMachineModal.astro";

interface Props {
  title: string;
  description: string;
  statusColor?: string;
  projectId?: string;
  currentStatusInt?: string;
  currentStatusName?: string;
  currentStatusTab?: string;
  currentRole?: string;
  project?: any;
  statuses?: any; // Accept statuses object for slot machine picker
  authorProfile?: any;
}

const {
  title,
  description,
  currentRole,
  statusColor = "blue",
  projectId,
  currentStatusInt = "",
  currentStatusName = "",
  currentStatusTab = "",
  authorProfile,
  project,
  statuses = {},
} = Astro.props;

// Transform statuses object to array format for SlotMachineModal
const statusOptions = Object.values(statuses).map((status: any) => ({
  value: status.status_code?.toString() || "",
  label: status.admin_status_name || "",
}));

// Debug logging for HeroProject component props
console.log("ðŸŽ¯ [HERO-PROJECT] HeroProject component props:", {
  currentStatusTab,
  title,
  currentStatusName,
  projectId,
  currentRole,
  hasProject: !!project,
  showStatusAndStaff: !!(currentStatusName && projectId),
  isAdminOrStaff: currentRole === "Admin" || currentRole === "Staff",
});
---

<SectionContainer>
  <div class="relative mx-auto md:flex">
    <div class="flex-none md:flex-1">
      <h1
        class="text-2xl font-medium text-hub-title dark:text-hub-title-dark"
        id="page-title"
        data-refresh
      >
        {title}
      </h1>
      <h2
        id="page-subtitle"
        class="text-hub-subtitle dark:text-hub-subtitle-dark"
        set:html={description}
      />
      {
        authorProfile?.email && (
          <p class="text-sm text-gray-500 dark:text-gray-400">{authorProfile.email}</p>
        )
      }
    </div>

    <div class="my-4 ml-0 md:ml-4 flex flex-shrink-0 items-center gap-2 md:my-2">
      {
        currentRole === "Admin" || currentRole === "Staff" ? (
          <div class="relative text-left flex flex-row gap-2">
            <SlotMachineModal
              label={currentStatusName}
              id="update-status"
              title="Select Status"
              options={statusOptions}
              selectedValue={currentStatusInt || ""}
              theme="blue"
              placeholder="Choose status"
            />

            <StaffSelect
              id="staff-select-picker"
              projectId={projectId?.toString() || ""}
              value={project?.assigned_to_id || ""}
              autoSave={true}
              currentRole={currentRole}
              placeholder="Assign staff..."
              address={project?.address || ""}
            />
          </div>
        ) : (
          <a
            href={`/project/${projectId}?tab=${currentStatusTab}`}
            title={`Go to ${currentStatusName} tab`}
            class="ml-4 flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"
          >
            {currentStatusName}
          </a>
        )
      }
    </div>
  </div>
</SectionContainer>
