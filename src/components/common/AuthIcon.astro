---
import BoxIcon from "./BoxIcon.astro";

interface Props {
  isAuth: boolean;
  currentUser: any;
  currentRole: string | null;
  session: any;
}

const { isAuth, currentUser, currentRole, session } = Astro.props;

// Debug logging
console.log("üîç [AuthIcon] Props:", {
  isAuth,
  currentUser: !!currentUser,
  currentRole,
  session: !!session,
});

const userProfile = currentUser?.profile || null;
---

{
  isAuth ? (
    <a
      id="profile-btn"
      data-drawer-target="drawer-user-center"
      data-drawer-show="drawer-user-center"
      data-drawer-placement="right"
      aria-controls="drawer-user-center"
      type="button"
    >
      <img
        id="user-avatar"
        src={currentUser?.user_metadata?.avatar_url || ""}
        alt="User avatar"
        class="block size-8 rounded-full"
        onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
      />
      <BoxIcon name="user" style="display:none;" class="bx-sm" />
    </a>
  ) : (
    <>
      {/* Not Authenticated: Login Button */}
      <a href="/login" aria-label="btn-profile" id="profile-btn">
        {/* <div  class="size-8 overflow-hidden rounded-full"> */}
        <BoxIcon name="user" />
        {/* </div> */}
      </a>
    </>
  )
}

<!-- <script type="module" define:vars={{ session }}>
  // console.log("üìã [HEADER] Header script execution started");
  // console.log("üìã [HEADER] Session data:", session);

  // const userAvatar = document.getElementById("user-avatar");
  // const fallbackIcon = userAvatar?.nextElementSibling;

  // Mobile menu elements
  const mobileMenuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const hamburgerIcon = document.getElementById("mobile-menu-btn"); // The button IS the hamburger

  // console.log("üìã [HEADER] DOM elements found:", {
  //   profileBtn: !!profileBtn,
  //   userAvatar: !!userAvatar,
  //   fallbackIcon: !!fallbackIcon,
  //   profileDropdown: !!profileDropdown,
  //   logoutBtn: !!logoutBtn,
  //   mobileMenuBtn: !!mobileMenuBtn,
  //   mobileMenu: !!mobileMenu,
  //   hamburgerIcon: !!hamburgerIcon,
  // });

  // Initialize mobile menu icon states
  if (hamburgerIcon) {
    hamburgerIcon.classList.remove("is-active");
    // console.log("üìã [HEADER] Mobile menu icons initialized");
  }

  function updateProfileButton(session) {
    // console.log("üìã [HEADER] updateProfileButton called with session:", session);

    if (session && session.data.user) {
      const avatarUrl = session.data.user.user_metadata?.avatar_url;
      // console.log("üìã [HEADER] Avatar URL:", avatarUrl);

      // Only update avatar if elements exist (user is authenticated)
      if (userAvatar && fallbackIcon) {
        if (avatarUrl) {
          userAvatar.src = avatarUrl;
          userAvatar.style.display = "block";
          fallbackIcon.style.display = "none";
          // console.log("üìã [HEADER] Using avatar image");
        } else {
          userAvatar.style.display = "none";
          fallbackIcon.style.display = "block";
          // console.log("üìã [HEADER] Using fallback icon");
        }
      }

      // Update drawer avatar if it exists
      const drawerAvatar = document.getElementById("drawer-avatar");
      if (drawerAvatar) {
        if (avatarUrl) {
          drawerAvatar.src = avatarUrl;
          drawerAvatar.style.display = "block";
          const drawerFallback = drawerAvatar.nextElementSibling;
          if (drawerFallback) {
            drawerFallback.style.display = "none";
          }
        } else {
          drawerAvatar.style.display = "none";
          const drawerFallback = drawerAvatar.nextElementSibling;
          if (drawerFallback) {
            drawerFallback.style.display = "block";
          }
        }
      }
      // console.log("üìã [HEADER] Profile button configured for authenticated user");
    } else {
      // console.log(
      //   "üìã [HEADER] Profile button configured for unauthenticated user - avatar elements not present"
      // );
    }
  }

  // Check initial auth state
  // console.log("üìã [HEADER] Checking initial auth state...");
  // updateProfileButton(session); // Removed - let static HTML handle the display

  // Mobile menu toggle functionality
  // function toggleMobileMenu() {
  //   if (!mobileMenu || !hamburgerIcon) {
  //     // console.error("üìã [HEADER] Missing mobile menu elements");
  //     return;
  //   }

  //   const isOpen = mobileMenu.classList.contains("translate-x-0");

  //   // console.log("üìã [HEADER] isOpen:", isOpen);
  //   if (isOpen) {
  //     // Close drawer - slide out to the left
  //     mobileMenu.classList.remove("translate-x-0");
  //     mobileMenu.classList.add("-translate-x-full");
  //     hamburgerIcon.classList.remove("is-active");
  //     // console.log("üìã [HEADER] Mobile menu closed");
  //   } else {
  //     // Open drawer - slide in from the left
  //     mobileMenu.classList.remove("-translate-x-full");
  //     mobileMenu.classList.add("translate-x-0");
  //     hamburgerIcon.classList.add("is-active");
  //     // console.log("üìã [HEADER] Mobile menu opened");
  //   }
  // }

  // // Mobile menu button event listener
  // if (mobileMenuBtn) {
  //   mobileMenuBtn.addEventListener("click", (e) => {
  //     e.stopPropagation();
  //     toggleMobileMenu();
  //   });
  // }

  // Close mobile menu when clicking outside or on menu links
  // document.addEventListener("click", (e) => {
  //   if (mobileMenu && mobileMenu.classList.contains("translate-x-0")) {
  //     // Close if clicking outside the mobile menu
  //     if (!mobileMenu.contains(e.target) && !mobileMenuBtn?.contains(e.target)) {
  //       mobileMenu.classList.remove("translate-x-0");
  //       mobileMenu.classList.add("-translate-x-full");
  //       if (hamburgerIcon) {
  //         hamburgerIcon.classList.remove("is-active");
  //       }
  //       // console.log("üìã [HEADER] Mobile menu closed by outside click");
  //     }
  //   }
  // });

  // Close mobile menu when clicking on navigation links
  // if (mobileMenu) {
  //   const mobileNavLinks = mobileMenu.querySelectorAll("a");
  //   mobileNavLinks.forEach((link) => {
  //     link.addEventListener("click", () => {
  //       mobileMenu.classList.remove("translate-x-0");
  //       mobileMenu.classList.add("-translate-x-full");
  //       if (hamburgerIcon) {
  //         hamburgerIcon.classList.remove("is-active");
  //       }
  //       // console.log("üìã [HEADER] Mobile menu closed by navigation link click");
  //     });
  //   });
  // }

  // Logout functionality (only if logout button exists - when authenticated)
  
</script> -->
