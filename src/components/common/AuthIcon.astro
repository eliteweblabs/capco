---
import BoxIcon from "./BoxIcon.astro";
import Tooltip from "./Tooltip.astro";

interface Props {
  isAuth: boolean;
  currentUser: any;
  currentRole: string | null;
}

const { isAuth, currentUser, currentRole } = Astro.props;

const userProfile = currentUser?.profile || null;

---
  {
    isAuth ? (
      // Authenticated: Profile Button with Dropdown




// <button id="dropdownDefaultButton" data-dropdown-toggle="dropdown" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
// <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
// </svg>
// </button>

// <!-- Dropdown menu -->
// <div id="dropdown" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-gray-700">
//     <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownDefaultButton">
//       <li>
//         <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Dashboard</a>
//       </li>
//       <li>
//         <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Settings</a>
//       </li>
//       <li>
//         <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Earnings</a>
//       </li>
//       <li>
//         <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Sign out</a>
//       </li>
//     </ul>
// </div>



      <div class="relative">
        <div id="profile-btn" class="text-black dark:text-white cursor-pointer" data-dropdown-toggle="profile-dropdown" >
          <img
            id="user-avatar"
            src=""
            alt="User avatar"
            class="block size-8 rounded-full"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
          />
          <BoxIcon name="user" style="display:none;" class="ml-2 bx-sm" />
        </div>

        <!-- Enhanced Dropdown menu -->
        <div
          id="profile-dropdown"
          class="absolute right-0 top-full mt-2 hidden w-64 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-gray-800 dark:ring-gray-700 z-50 transition-all duration-200 ease-in-out"
        >
          <!-- User Info Section -->
          <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <img
                  id="dropdown-avatar"
                  src=""
                  alt="User avatar"
                  class="h-10 w-10 rounded-full"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                />
                <BoxIcon name="user" style="display:none;" class="text-gray-400 bx-sm" />
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-gray-900 dark:text-white">
                  {userProfile?.company_name || currentUser?.email?.split("@")[0] || "User"}
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  {currentUser?.email}
                </p>
                <p class="text-xs text-blue-600 dark:text-blue-400 font-medium">
                  {currentRole || "User"}
                </p>
              </div>
            </div>
          </div>

          <!-- Menu Items -->
          <div class="py-1">
            <ul aria-labelledby="profile-btn">
            <li><a
              href="/dashboard"
              class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700"
            >
              <BoxIcon name="building" class="mr-3 bx-sm" />
              Dashboard
            </a></li>

            <li><a
              href="/profile"
              class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700"
            >
              <BoxIcon name="user" class="mr-3 bx-sm" />
              My Profile
            </a></li>

            {/* <a
              href="/settings"
              class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700"
            >
              <BoxIcon name="cog" class="mr-3 block size-4" />
              Settings
            </a> */}

            <hr class="my-1 border-gray-200 dark:border-gray-700" />

            <li><button
              id="logout-btn"
              class="flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700"
            >
              <BoxIcon name="log-out" class="mr-3 bx-sm" />
              Logout
            </button></li>
          </ul>
          </div>
        </div>
      </div>
    ) : (
      // Not Authenticated: Login Button
      <Tooltip content="Login" variant="link" href="/login" placement="bottom" id="login-tooltip" class="text-black dark:text-white">
      
      
          <BoxIcon name="log-in" class="text-gray-700 dark:text-gray-300 bx-sm"   aria-label="btn-profile"
          id="profile-btn"/>

      </Tooltip>
    )
  }
