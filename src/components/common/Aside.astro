---
// Flowbite Sidebar Component
// Based on Flowbite dashboard design patterns

// import UnifiedChat from "./UnifiedChat.astro";
import HttpChatWidget from "./HttpChatWidget.astro";
import LucideIcon from "./LucideIcon.astro";
import NotificationDropdown from "./NotificationDropdown.astro";
import AssignedProjects from "./AssignedProjects.astro";

interface Props {
  currentUser: any;
  globalInputClasses: string;
  project: any;
  primaryTextClasses: string;
  secondaryTextClasses: string;
}

const { currentUser, project, globalInputClasses, primaryTextClasses, secondaryTextClasses } =
  Astro.props;
const currentRole = currentUser?.profile?.role;
if (!currentUser || currentRole === "Client") {
  return null;
}
---

<aside
  id="sidebar"
  class="sticky top-14 pt-0 w-64 h-screen transition-all duration-300 ease-in-out bg-gray-50 -translate-x-full sm:translate-x-0 shadow-sm border-r dark:border-gray-700 dark:bg-gray-800"
  aria-label="Sidebar"
>
  <div class="h-full px-3 py-4 overflow-y-auto">
    <ul
      class={`space-y-2 text-xs font-medium uppercase tracking-wider ${primaryTextClasses}`}
      id="sidebar-menu"
    >
      <li>
        <a
          href="/dashboard"
          type="button"
          class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
        >
          <svg
            class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            fill="currentColor"
            viewBox="-6 0 28 10"
          >
            <path
              d="M3.5515 -1.98857C4.04401 -1.9882 4.44444 -1.58963 4.44444 -1.09711V13.111C4.44444 13.6019 4.04648 13.9999 3.55556 13.9999C2.66667 13.9999 1.77778 13.9999 0.888889 13.9999C0.397969 13.9999 0 13.6019 0 13.111V-1.11114C0 -1.60209 0.39798 -2.00006 0.888926 -1.99835C1.77061 -1.99529 2.66976 -1.98923 3.5515 -1.98857Z"
              fill="currentColor"></path><path
              d="M15.1107 -1.99698C15.6018 -1.9971 16 -1.59906 16 -1.10795V1.55545C16 2.04637 15.602 2.44434 15.1111 2.44434C12.2963 2.44434 9.48148 2.44434 6.66667 2.44434C6.17575 2.44434 5.77778 2.04637 5.77778 1.55545V-1.11121C5.77778 -1.60213 6.17568 -2.00011 6.66661 -2C9.44593 -1.99938 12.3313 -1.99632 15.1107 -1.99698Z"
              fill="currentColor"></path><path
              d="M9.33223 9.55865C9.8236 9.55875 10.2222 9.95689 10.2222 10.4483V13.111C10.2222 13.6019 9.82425 13.9999 9.33333 13.9999C8.44444 13.9999 7.55556 13.9999 6.66667 13.9999C6.17575 13.9999 5.77778 13.6019 5.77778 13.111V10.4444C5.77778 9.95343 6.17572 9.55546 6.66665 9.55594C7.54934 9.55679 8.44953 9.55847 9.33223 9.55865Z"
              fill="currentColor"></path><path
              d="M15.1085 3.78504C15.6005 3.78528 16 4.18363 16 4.67557V13.111C16 13.6019 15.602 13.9999 15.1111 13.9999C14.2222 13.9999 13.3333 13.9999 12.4444 13.9999C11.9535 13.9999 11.5556 13.6019 11.5556 13.111V4.66661C11.5556 4.17567 11.9535 3.7777 12.4445 3.77879C13.3266 3.78075 14.2263 3.78462 15.1085 3.78504Z"
              fill="currentColor"></path><path
              d="M9.33223 3.78088C9.8236 3.78098 10.2222 4.17911 10.2222 4.67048V7.33323C10.2222 7.82415 9.82425 8.22211 9.33333 8.22211C8.44444 8.22211 7.55556 8.22211 6.66667 8.22211C6.17575 8.22211 5.77778 7.82415 5.77778 7.33323V4.66658C5.77778 4.17565 6.17572 3.77768 6.66665 3.77816C7.54934 3.77901 8.44953 3.78069 9.33223 3.78088Z"
              fill="currentColor"></path></svg
          >

          <span
            data-sidebar-collapse-hide=""
            class="ml-3 flex-1 whitespace-nowrap text-left"
            data-sidebar-collapse-hide="">Dashboard</span
          >
        </a>
      </li>

      <li>
        <a
          href="/admin/global-discussions"
          class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
          data-sidebar-collapse-item=""
        >
          {
            /* aria-controls="dropdown-users"
          data-collapse-toggle="dropdown-users" */
          }

          <svg
            class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z"
              clip-rule="evenodd"></path>
          </svg>

          <span
            data-sidebar-collapse-hide=""
            class="ml-3 flex-1 whitespace-nowrap text-left"
            data-sidebar-collapse-hide=""
          >
            All Discussions
          </span>
        </a>
      </li>

      {
        currentRole !== "Client" && (
          <li>
            <a
              href="/admin/global-discussions"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              {/* aria-controls="dropdown-users"
          data-collapse-toggle="dropdown-users" */}

              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z"
                  clip-rule="evenodd"
                />
              </svg>

              <span
                data-sidebar-collapse-hide=""
                class="ml-3 flex-1 whitespace-nowrap text-left"
                data-sidebar-collapse-hide=""
              >
                Calendar
              </span>
            </a>
          </li>
        )
      }
      {
        currentRole !== "Client" && (
          <li>
            <a
              href="/analytics"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              {/* aria-controls="dropdown-users"
          data-collapse-toggle="dropdown-users" */}

              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z"
                  clip-rule="evenodd"
                />
              </svg>

              <span
                data-sidebar-collapse-hide=""
                class="ml-3 flex-1 whitespace-nowrap text-left"
                data-sidebar-collapse-hide=""
              >
                Analytics
              </span>
            </a>
          </li>
        )
      }

      {currentRole !== "Client" && <AssignedProjects currentUser={currentUser} />}

      {
        currentRole === "Admin" && (
          <li>
            <a
              href="/admin/global-activity"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex  w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              {/* aria-controls="dropdown-users"
              data-collapse-toggle="dropdown-users" */}

              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M3 6C3 4.89688 3.89688 4 5 4H13C14.1031 4 15 4.89688 15 6V10.2063C12.6906 10.8594 11 12.9812 11 15.5C11 17.3469 11.9094 18.9781 13.3031 19.9781C13.2031 19.9937 13.1031 20 13 20H5C3.89688 20 3 19.1031 3 18V6ZM5 8.5C5 8.775 5.225 9 5.5 9H12.5C12.775 9 13 8.775 13 8.5C13 8.225 12.775 8 12.5 8H5.5C5.225 8 5 8.225 5 8.5ZM5.5 11C5.225 11 5 11.225 5 11.5C5 11.775 5.225 12 5.5 12H10.5C10.775 12 11 11.775 11 11.5C11 11.225 10.775 11 10.5 11H5.5ZM5.5 14C5.225 14 5 14.225 5 14.5C5 14.775 5.225 15 5.5 15H8.5C8.775 15 9 14.775 9 14.5C9 14.225 8.775 14 8.5 14H5.5ZM12 15.5C12 14.3065 12.4741 13.1619 13.318 12.318C14.1619 11.4741 15.3065 11 16.5 11C17.6935 11 18.8381 11.4741 19.682 12.318C20.5259 13.1619 21 14.3065 21 15.5C21 16.6935 20.5259 17.8381 19.682 18.682C18.8381 19.5259 17.6935 20 16.5 20C15.3065 20 14.1619 19.5259 13.318 18.682C12.4741 17.8381 12 16.6935 12 15.5ZM17.8969 14.1469L16 16.0437L15.1031 15.1469C14.9094 14.9531 14.5906 14.9531 14.3969 15.1469C14.2031 15.3406 14.2031 15.6594 14.3969 15.8531L15.6469 17.1031C15.8406 17.2969 16.1594 17.2969 16.3531 17.1031L18.6031 14.8531C18.7969 14.6594 18.7969 14.3406 18.6031 14.1469C18.4094 13.9531 18.0906 13.9531 17.8969 14.1469Z"
                  fill="currentColor"
                />
              </svg>

              <span
                data-sidebar-collapse-hide=""
                class="ml-3 flex-1 whitespace-nowrap text-left"
                data-sidebar-collapse-hide=""
              >
                Global Activity
              </span>
            </a>
          </li>
        )
      }

      {
        currentRole === "Admin" && (
          <li>
            <a
              href="/admin/notifications"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex  w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              {/* aria-controls="dropdown-users"
              data-collapse-toggle="dropdown-users" */}

              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M 4.683 8.721 C 3.874 8.99 3.754 10.084 4.485 10.522 L 9.445 13.498 L 13.068 9.875 C 13.36 9.583 13.833 9.583 14.126 9.875 C 14.418 10.167 14.418 10.641 14.126 10.933 L 10.502 14.556 L 13.478 19.516 C 13.917 20.246 15.01 20.126 15.28 19.318 L 19.948 5.315 C 20.207 4.535 19.466 3.793 18.686 4.053 L 4.683 8.721 Z"
                  fill="currentColor"
                />
              </svg>

              <span class="ml-3 flex-1 whitespace-nowrap text-left" data-sidebar-collapse-hide="">
                Send Notifications
              </span>
            </a>
          </li>
        )
      }

      {
        currentUser && (
          <li>
            <a
              id="notification-bell"
              href="#"
              class="hover:bg-gray-300 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
              data-modal-target="notificationsModal"
              data-modal-toggle="notificationsModal"
              data-user-id={currentUser.id}
            >
              <LucideIcon name="bell" class="mr-2" />
              <span data-sidebar-collapse-hide="">View notifications</span>
            </a>
          </li>
        )
      }

      {
        currentRole === "Admin" && currentUser.email === "tom@tomsens.com" && (
          <li>
            <a
              href="/admin/email-delivery-test"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex  w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm-1-5a1 1 0 0 1-2 0V9a1 1 0 0 1 2 0v6Zm2-1a1 1 0 1 1-2 0V9a1 1 0 0 1 2 0v5Z"
                  clip-rule="evenodd"
                />
              </svg>

              <span
                data-sidebar-collapse-hide=""
                class="ml-3 flex-1 whitespace-nowrap text-left"
                data-sidebar-collapse-hide=""
              >
                Update Test
              </span>
            </a>
          </li>
        )
      }

      {
        currentRole === "Admin" && (
          <li>
            <a
              href="/admin/users"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-item=""
            >
              <svg
                class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M12 2a7 7 0 0 0-7 7 3 3 0 0 0-3 3v2a3 3 0 0 0 3 3h1a1 1 0 0 0 1-1V9a5 5 0 1 1 10 0v7.083A2.919 2.919 0 0 1 14.083 19H14a2 2 0 0 0-2-2h-1a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h1a2 2 0 0 0 1.732-1h.351a4.917 4.917 0 0 0 4.83-4H19a3 3 0 0 0 3-3v-2a3 3 0 0 0-3-3 7 7 0 0 0-7-7Zm1.45 3.275a4 4 0 0 0-4.352.976 1 1 0 0 0 1.452 1.376 2.001 2.001 0 0 1 2.836-.067 1 1 0 1 0 1.386-1.442 4 4 0 0 0-1.321-.843Z"
                  clip-rule="evenodd"
                />
              </svg>

              <span
                data-sidebar-collapse-hide=""
                class="ml-3 flex-1 whitespace-nowrap text-left"
                data-sidebar-collapse-hide=""
              >
                Users
              </span>
            </a>
          </li>
        )
      }

      <li>
        <a
          type="button"
          class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
          aria-controls="dropdown-projects"
          data-collapse-toggle="dropdown-projects"
          data-sidebar-collapse-item=""
        >
          <svg
            class="h-4 w-4 flex-shrink-0 text-gray-900 dark:text-gray-400"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M9 2a1 1 0 0 0-1 1H6a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-2a1 1 0 0 0-1-1H9Zm1 2h4v2h1a1 1 0 1 1 0 2H9a1 1 0 0 1 0-2h1V4Zm5.707 8.707a1 1 0 0 0-1.414-1.414L11 14.586l-1.293-1.293a1 1 0 0 0-1.414 1.414l2 2a1 1 0 0 0 1.414 0l4-4Z"
              clip-rule="evenodd"></path>
          </svg>

          <span class="ml-3 flex-1 whitespace-nowrap text-left" data-sidebar-collapse-hide=""
            >Projects</span
          >
          <LucideIcon name="chevron-right" class="h-4 w-4" data-sidebar-collapse-hide="" />
        </a>

        <ul id="dropdown-projects" class="hidden space-y-2 py-2">
          <li>
            <a
              href="/project/new"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-subitem="">New</a
            >
          </li>
          <li>
            <a
              href="/project/dashboard/"
              class="hover:bg-gray-300 dark:hover:bg-gray-700 flex w-full align-center rounded-lg p-2"
              data-sidebar-collapse-subitem="">Dashboard</a
            >
          </li>
        </ul>
      </li>
      <li data-sidebar-collapse-hide="" id="online-count">
        0 online
        <!-- Online users tooltip -->
        <!-- <div
          class="absolute bottom-full left-0 z-50 mb-2 hidden min-w-32 rounded-lg bg-gray-800 p-2 text-xs text-white shadow-lg group-hover:block"
        >
          <div class="mb-1 font-medium">Online Users:</div>
          <div id="online-users-list" class="space-y-1">
            <div class="text-gray-300">No users online</div>
          </div>
        </div> -->
      </li>
    </ul>
    <div data-sidebar-collapse-hide="">
      <HttpChatWidget {currentUser} {currentRole} {globalInputClasses} />
    </div>
  </div>
</aside>

<style>
  #sidebar [aria-expanded="true"] [data-lucide="chevron-right"] {
    transform: rotate(90deg);
    transition: transform 0.3s ease-in-out;
  }
</style>
