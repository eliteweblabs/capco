---
// Contact form component
import Button from "./Button.astro";
---

<div class="contact-form mx-auto max-w-2xl">
  <form
    id="contactForm"
    action="/api/contact-submission"
    method="POST"
    enctype="multipart/form-data"
    class="space-y-6"
  >
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <div>
        <label
          for="firstName"
          class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
        >
          First Name
        </label>
        <input
          type="text"
          id="first-name"
          name="firstName"
          required
          class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
        />
      </div>

      <div>
        <label
          for="lastName"
          class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
        >
          Last Name
        </label>
        <input
          type="text"
          id="last-name"
          name="lastName"
          required
          class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
        />
      </div>
    </div>

    <div>
      <label for="email" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Email Address
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      />
    </div>

    <div>
      <label for="phone" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Phone Number
      </label>
      <input
        type="tel"
        id="phone"
        name="phone"
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      />
    </div>

    <div>
      <label for="message" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Message
      </label>
      <textarea
        id="message"
        name="message"
        rows="5"
        required
        class="w-full resize-none rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
        placeholder="Tell us about your fire protection needs..."></textarea>
    </div>

    <div>
      <label for="company" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Company Name
      </label>
      <input
        type="text"
        id="company"
        name="company"
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      />
    </div>

    <div>
      <label for="address" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Project Address
      </label>
      <input
        type="text"
        id="address"
        name="address"
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      />
    </div>

    <div>
      <label
        for="projectType"
        class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
      >
        Project Type
      </label>
      <select
        id="projectType"
        name="projectType"
        required
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      >
        <option value="">Select a project type</option>
        <option value="new-construction">New Construction</option>
        <option value="renovation">Renovation</option>
        <option value="inspection">Inspection</option>
        <option value="maintenance">Maintenance</option>
        <option value="other">Other</option>
      </select>
    </div>

    <div>
      <label for="files" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Attach Files (Optional)
      </label>
      <input
        type="file"
        id="files"
        name="files"
        multiple
        accept=".pdf,.doc,.docx,.dwg,.dxf,.jpg,.jpeg,.png"
        class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-red-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
      />
      <p class="mt-1 text-sm text-gray-500">
        Max file size: 10MB. Accepted formats: PDF, Word, CAD files, Images
      </p>
    </div>

    <div class="text-center">
      <Button type="submit" variant="primary" size="lg" icon="send" iconPosition="left">
        Send Message
      </Button>
    </div>
  </form>
</div>

<script>
  document.getElementById("contactForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target as HTMLFormElement;
    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: formData,
      });

      const result = await response.json();

      if (result.success) {
        window.showModal?.("success", "Message Sent!", "We'll get back to you soon.", 3000);
        form.reset();
      } else {
        window.showModal?.(
          "error",
          "Error",
          result.error || "Failed to send message. Please try again.",
          5000
        );
      }
    } catch (error) {
      console.error("Error submitting contact form:", error);
      window.showModal?.("error", "Error", "Failed to send message. Please try again.", 5000);
    }
  });
</script>
