---
import PushNotificationDemo from "./PushNotificationDemo.astro";
---

<div id="services-test" class="p-6 bg-white dark:bg-gray-800 rounded-lg shadow">
  <h3 class="text-lg font-semibold mb-4">Global Services Demo</h3>

  <div class="space-y-4">
    <!-- Configuration Status -->
    <div
      id="config-status"
      class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4"
    >
      <h4 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">
        üîç Checking Email Configuration...
      </h4>
      <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-2">
        Verifying email service setup...
      </p>
    </div>

    <!-- Email Actions -->
    <div class="border-b pb-4">
      <h4 class="font-medium mb-2">Email Functions</h4>
      <div class="flex gap-2 flex-wrap mb-3">
        <button
          id="send-welcome-email"
          class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          Send Welcome Email
        </button>
        <button
          id="send-notification-email"
          class="px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600"
        >
          Send Notification
        </button>
        <button
          id="send-custom-email"
          class="px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
        >
          Send Custom Email
        </button>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button
          id="send-react-welcome"
          class="px-3 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 text-xs"
        >
          üé® React Welcome
        </button>
        <button
          id="send-react-notification"
          class="px-3 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 text-xs"
        >
          üé® React Project Alert
        </button>
        <button
          id="send-react-test"
          class="px-3 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600 text-xs"
        >
          üé® React Test
        </button>
      </div>
    </div>

    <!-- Project Management -->
    <div class="border-b pb-4">
      <h4 class="font-medium mb-2">Project Management</h4>
      <div class="flex gap-2 flex-wrap mb-2">
        <button
          id="get-user-projects-btn"
          class="px-3 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600"
        >
          Get My Projects
        </button>
      </div>
    </div>

    <!-- Project Status Actions -->
    <div class="border-b pb-4">
      <h4 class="font-medium mb-2">Project Status Functions</h4>
      <div class="mb-3 p-3 bg-gray-50 dark:bg-gray-900 rounded">
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
          <span class="font-medium">Current Project ID:</span>
          <span id="current-project-id" class="font-mono text-blue-600 dark:text-blue-400"
            >None</span
          >
        </p>
        <button
          id="create-test-project"
          class="px-3 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          Create Test Project
        </button>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button
          class="status-btn px-3 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed"
          data-new-status="20"
          data-label="Generate Proposal"
          data-action="proposal_generation"
          disabled
        >
          Generate Proposal
        </button>
        <button
          class="status-btn px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
          data-new-status="30"
          data-label="Ship Proposal"
          data-action="proposal_shipped"
          disabled
        >
          Ship Proposal
        </button>
        <button
          class="status-btn px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed"
          data-new-status="50"
          data-label="Proposal Approved"
          data-action="proposal_approved"
          disabled
        >
          Proposal Approved
        </button>
        <button
          class="status-btn px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed"
          data-new-status="60"
          data-label="Generate Deposit Invoice"
          data-action="deposit_invoice_generation"
          disabled
        >
          Generate Deposit Invoice
        </button>
        <button
          class="status-btn px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
          data-new-status="220"
          data-label="Mark Complete"
          data-action="project_complete"
          disabled
        >
          Mark Complete
        </button>
      </div>
    </div>

    <!-- Notification Actions -->
    <div class="border-b pb-4">
      <h4 class="font-medium mb-2">Notification Functions</h4>
      <div class="flex gap-2 flex-wrap">
        <button
          id="show-success"
          class="px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600"
        >
          Success Notification
        </button>
        <button id="show-error" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600">
          Error Notification
        </button>
        <button
          id="show-warning"
          class="px-3 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
        >
          Warning Notification
        </button>
        <button id="show-info" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          Info Notification
        </button>
      </div>
    </div>

    <!-- File Upload -->
    <div>
      <h4 class="font-medium mb-2">File Upload Functions</h4>
      <input
        type="file"
        id="file-upload"
        multiple
        accept=".pdf"
        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
      />
      <button
        id="upload-files"
        class="mt-2 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
      >
        Upload Files
      </button>
    </div>

    <!-- Event Log -->
    <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-900 rounded">
      <h4 class="font-medium mb-2">Event Log</h4>
      <div id="event-log" class="text-sm text-gray-600 dark:text-gray-400 max-h-40 overflow-y-auto">
        <p>Events will appear here...</p>
      </div>
      <button
        id="clear-log"
        class="mt-2 px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600"
      >
        Clear Log
      </button>
    </div>
  </div>
</div>

<!-- ProjectList removed to prevent confusion - now only on index page -->

<!-- PDF Generator Container -->
<div class="mt-6">
  <!-- PDF generation will be handled by buttons in project cards -->
</div>

<!-- Push Notification Demo -->
<PushNotificationDemo />

<script>
  // Check email configuration on load
  async function checkEmailConfiguration() {
    const configStatus = document.getElementById("config-status");
    if (!configStatus) return;

    try {
      const response = await fetch("/api/send-email");
      const result = await response.json();

      if (result.configured && result.verification === "OK") {
        // Email is properly configured
        configStatus.className =
          "bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4";
        configStatus.innerHTML = `
          <h4 class="font-medium text-green-800 dark:text-green-200 mb-2">
            ‚úÖ Email Configuration Active
          </h4>
          <p class="text-sm text-green-700 dark:text-green-300">
            Email service is configured and ready. All email functions should work!
          </p>
        `;
      } else {
        throw new Error("Email not configured");
      }
    } catch (error) {
      // Keep the existing warning banner
      console.log("Email configuration check failed:", error);

      // Update to show configuration details
      configStatus.className =
        "bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4";
      configStatus.innerHTML = `
        <h4 class="font-medium text-red-800 dark:text-red-200 mb-2">
          ‚ùå Email Configuration Required
        </h4>
        <p class="text-sm text-red-700 dark:text-red-300 mb-2">
          Email service is not configured. Please check your environment variables.
        </p>
        <div class="text-xs text-red-600 dark:text-red-400">
          <p>Required: EMAIL_PROVIDER, EMAIL_API_KEY, FROM_EMAIL, FROM_NAME</p>
        </div>
      `;
    }
  }

  // Initialize configuration check when DOM is loaded
  document.addEventListener("DOMContentLoaded", () => {
    checkEmailConfiguration();
  });
</script>
