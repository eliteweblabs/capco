---
import PaymentForm from "./PaymentForm.astro";

interface Props {
  project?: any;
  projectStatus?: number;
  projectStatusLabel?: string;
  currentUser?: any;
  invoiceId?: any;
  totalAmount?: number;
  secondaryTextClasses?: string;
  primaryTextClasses?: string;
  globalInputClasses?: string;
  statusData?: any;
}

const {
  currentUser,
  project,
  projectStatus = 0,
  projectStatusLabel = "Unknown Status",
  invoiceId = null,
  totalAmount = 2000,
  secondaryTextClasses,
  globalInputClasses,
  primaryTextClasses,
  statusData,
} = Astro.props;

const currentRole = currentUser?.profile?.role;
const projectId = project?.id;
// const invoiceId = pro
// ject?.invoice_id ?? "0";

// Debug logging
// console.log("ðŸ” [TAB-FINAL-INVOICE] Debug values:", {
//   projectId,
//   projectIdType: typeof projectId,
//   invoiceId,
//   invoiceIdType: typeof invoiceId,
//   parsedInvoiceId: parseInt(invoiceId),
//   projectStatus,
//   projectStatusType: typeof projectStatus,
//   currentRole,
//   currentRoleType: typeof currentRole,
//   condition1: projectStatus >= 30,
//   condition2: currentRole === "Client",
//   condition3: projectStatus < 50,
//   fullCondition: projectStatus >= 30 && currentRole === "Client" && projectStatus < 50,
// });
---

<div
  id="content-final-invoice"
  class="tab-content shadow-lg p-4 color-background relative min-h-[calc(100dvh-24rem)]"
>
  {
    projectStatus >= 130 && currentRole === "Client" && projectStatus < 170 ? (
      <>
        <div class="mb-6">
          <h3 class={`${primaryTextClasses} mb-2`}>Final Invoice - Balance Due</h3>
          <p class={`${secondaryTextClasses}`}>Pay the remaining balance for your project.</p>
          <div class="mt-2 text-lg font-semibold text-green-600 dark:text-green-400">
            Total Amount: ${totalAmount.toFixed(2)}
          </div>
        </div>

        <PaymentForm
          invoiceId={parseInt(invoiceId ?? "0")}
          amount={totalAmount / 2}
          currency="usd"
          paymentType="balance"
          project={project}
          currentUser={currentUser}
          globalInputClasses={globalInputClasses}
          secondaryTextClasses={secondaryTextClasses}
          primaryTextClasses={primaryTextClasses}
        />
      </>
    ) : null
  }

  {
    projectStatus >= 170 && currentRole === "Client" ? (
      <>
        <div class="mb-6">
          <h3 class={`${primaryTextClasses} mb-2`}>Fully Paid</h3>
          <p class={`${secondaryTextClasses}`}>Thank you for your business.</p>
        </div>
      </>
    ) : null
  }
</div>
