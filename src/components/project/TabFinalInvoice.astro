---
import PaymentForm from "./PaymentForm.astro";

interface Props {
  project?: any;
  currentRole?: string;
  projectId: string;
  projectStatus?: number;
  projectStatusLabel?: string;
  currentUser?: any;
  invoiceData?: any;
  totalAmount?: number;
  authorProfile?: any;
}

const {
  project,
  currentRole,
  projectId,
  authorProfile,
  projectStatus = 0,
  projectStatusLabel = "Unknown Status",
  invoiceData = null,
  totalAmount = 2000,
} = Astro.props;

const invoiceId = project?.invoice_id ?? "0";

// Debug logging
// console.log("🔍 [TAB-FINAL-INVOICE] Debug values:", {
//   projectId,
//   projectIdType: typeof projectId,
//   invoiceId,
//   invoiceIdType: typeof invoiceId,
//   parsedInvoiceId: parseInt(invoiceId),
//   projectStatus,
//   projectStatusType: typeof projectStatus,
//   currentRole,
//   currentRoleType: typeof currentRole,
//   condition1: projectStatus >= 30,
//   condition2: currentRole === "Client",
//   condition3: projectStatus < 50,
//   fullCondition: projectStatus >= 30 && currentRole === "Client" && projectStatus < 50,
// });
---

<div
  id="content-final-invoice"
  class="tab-content hidden rounded-lg bg-white p-6 shadow-md dark:bg-gray-800"
>
  {
    projectStatus >= 30 && currentRole === "Client" && projectStatus < 50 ? (
      <>
        <div class="mb-6">
          <h3 class="mb-2 text-lg font-medium text-gray-900 dark:text-white">
            Final Invoice - Balance Due
          </h3>
          <p class="text-gray-500 dark:text-gray-400">
            Pay the remaining balance for your project.
          </p>
          <div class="mt-2 text-lg font-semibold text-green-600 dark:text-green-400">
            Total Amount: ${totalAmount.toFixed(2)}
          </div>
        </div>

        <PaymentForm
          invoiceId={parseInt(invoiceId ?? "0")}
          amount={totalAmount / 2}
          currency="usd"
          paymentType="balance"
          authorProfile={authorProfile}
          currentRole={currentRole}
          project={project}
          projectId={projectId}
          projectStatus={projectStatus}
          projectStatusLabel={projectStatusLabel}
        />
      </>
    ) : null
  }

  {
    projectStatus >= 170 && currentRole === "Client" ? (
      <>
        <div class="mb-6">
          <h3 class="mb-2 text-lg font-medium text-gray-900 dark:text-white">Fully Paid</h3>
          <p class="text-gray-500 dark:text-gray-400">Thank you for your business.</p>
        </div>

        {/* <PaymentForm
          invoiceId={parseInt(invoiceId ?? "0")}
          amount={totalAmount / 2}
          currency="usd"
          paymentType="balance"
          authorProfile={authorProfile}
          currentRole={currentRole}
          project={project}
          projectId={projectId}
          projectStatus={projectStatus}
          projectStatusLabel={projectStatusLabel}
        /> */}
      </>
    ) : null
  }
</div>
