---
// Reusable StickyActions component - now works with portal system in App.astro
// This component marks itself for teleportation to avoid z-index stacking context issues
export const partial = true;

// Detect if this is being used as a partial
const isPartial = Astro.request.headers.has("x-sticky-actions-id");
let id, columns, className;

if (isPartial) {
  // Extract props from headers when used as partial
  id = Astro.request.headers.get("x-sticky-actions-id") || "";
  columns = Astro.request.headers.get("x-sticky-actions-columns") || "4";
  className = Astro.request.headers.get("x-sticky-actions-class") || "";
} else {
  // Use regular props when used as a component
  const props = Astro.props;
  id = props.id || `sticky-actions-${Math.random().toString(36).substr(2, 9)}`;
  columns = props.columns || "4";
  className = props.class || "";
}
---

<!-- This div will be teleported to the portal in App.astro via JavaScript -->
<!-- It's hidden here and only shown in the portal to avoid z-index issues -->
<div
  {id}
  class={`sticky-actions ${className}`}
  data-sticky-actions
  data-columns={columns}
  style="display: none;"
>
  <slot />
</div>

<script>
  // Auto-initialize when this component loads
  document.addEventListener("DOMContentLoaded", () => {
    // Trigger portal re-initialization in case this component loaded after initial page load
    if ((window as any).initializeStickyActionsPortal) {
      (window as any).initializeStickyActionsPortal();
    }
  });
</script>
