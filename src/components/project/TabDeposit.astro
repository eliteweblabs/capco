---
import BoxIcon from "../common/BoxIcon.astro";
import PaymentForm from "./PaymentForm.astro";

interface Props {
  project?: any;
  projectStatus?: number;
  currentUser?: any;
  projectStatusLabel?: string;
  invoiceId?: string;
  totalAmount?: number;
  globalSecondaryTextClasses?: string;
  globalPrimaryTextClasses?: string;
  globalInputClasses?: string;
  statusData?: any;
}

const {
  project,
  projectStatus = 0,
  currentUser,
  projectStatusLabel,
  invoiceId,
  totalAmount = 0,
  globalSecondaryTextClasses,
  globalPrimaryTextClasses,
  globalInputClasses,
  statusData,
} = Astro.props;

const currentRole = currentUser?.profile?.role;
const authorProfile = currentUser?.profile;
const projectId = project?.id;

// Debug logging
// console.log("ðŸ” [TAB-DEPOSIT] Debug values:", {
//   projectId,
//   authorProfile,
//   projectIdType: typeof projectId,
//   parsedProjectId: parseInt(projectId),
//   projectStatus,
//   projectStatusType: typeof projectStatus,
//   currentRole,
//   currentRoleType: typeof currentRole,
//   totalAmount,
//   totalAmountType: typeof totalAmount,
//   condition1: projectStatus >= 30,
//   condition2: currentRole === "Client",
//   condition3: projectStatus < 50,
//   fullCondition: projectStatus >= 30 && currentRole === "Client" && projectStatus < 50,
// });

// Log PaymentForm props
// console.log("ðŸ” [TAB-DEPOSIT] PaymentForm props:", {
//   invoiceId: parseInt(invoiceId ?? "0"),
//   amount: totalAmount,
//   currency: "usd",
//   paymentType: "deposit",
// });

function getStatusAlert() {
  return currentRole === "Client" && Number(projectStatus) < 55
    ? "Deposit payment will be available after proposal is signed off."
    : Number(projectStatus) >= 55 && currentRole === "Client"
      ? "Secure your project with a deposit payment. This ensures we can begin work on your fire protection system."
      : null;
}
const statusAlert = getStatusAlert();
---

<div id="content-deposit" class="tab-content hidden">
  <!-- <StatusAlert status={projectStatus} 
  currentRole={currentRole}
  statusAlert={
"< 55" : "Deposit payment will be available after proposal is signed off.",
">= 55" : "Secure your project with a deposit payment. This ensures we can begin work on your fire protection system."

  }
  /> -->

  <div
    class="mb-4 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20"
  >
    <div class="flex items-start">
      <BoxIcon name="info-circle" class="mr-2 mt-0.5 text-lg text-blue-600 dark:text-blue-400" />
      <div class="text-blue-800 dark:text-blue-400">
        <h3 class="text-lg">{statusAlert}</h3>
      </div>
    </div>
  </div>

  {
    projectStatus >= 50 && currentRole === "Client" && (
      <PaymentForm
        invoiceId={invoiceId && invoiceId !== "0" ? parseInt(invoiceId) : null}
        amount={totalAmount / 2}
        currency="usd"
        paymentType="deposit"
        project={project}
        currentUser={currentUser}
      />
    )
  }
</div>
