---
import BoxIcon from "../common/BoxIcon.astro";
import SlotMachineModalStaff from "../form/SlotMachineModalStaff.astro";
import Tooltip from "../common/Tooltip.astro";
interface Props {
  project: {
    punchlistItems?: { completed: number; total: number };
    incomplete_discussions: any;
    id: any;
    author_id?: any;
    title?: any;
    address: any;
    description: any;
    sq_ft: any;
    new_construction: any;
    status: any;
    created_at: any;
    updated_at: any;
    elapsed_time?: any;
    assigned_to_id?: any;
    comment_count?: any;
    due_date?: any;
    generated_document_count?: any;
    authorProfile?: any;
    assignedToProfile?: any;
    featured_image_data?: {
      id: any;
      file_path: string;
      file_name: string;
      file_type: string;
      public_url: string;
    };
    // New document data fields
    projectFiles?: Array<{
      id: number;
      project_id: number;
      author_id: string;
      file_path: string;
      file_name: string;
      file_size: number;
      file_type: string;
      title?: string;
      comments?: string;
      status: string;
      uploaded_at: string;
      created_at: string;
      updated_at: string;
    }>;
    generatedDocuments?: Array<{
      id: number;
      project_id: number;
      template_id?: number;
      document_name: string;
      file_path?: string;
      file_size?: number;
      generation_status: string;
      error_message?: string;
      generation_started_at?: string;
      generation_completed_at?: string;
      created_at: string;
      created_by: string;
    }>;
  };
  statusData?: any;
  currentRole?: string;
  statuses?: any;
  currentStatusName?: string;
  currentStatusInt?: string;
  currentStatusSlug?: string;
  currentStatusTab?: string;
  currentStatusColor?: string;
  currentStatusEstTime?: string;
  staffOptions?: any;
  dueDateOptions?: any;
  currentUser?: any;
}

const {
  project,
  currentUser,
  statusData,
  currentStatusName,
  currentStatusInt,
  currentStatusSlug,
  currentStatusTab,
  currentStatusColor,
  currentStatusEstTime,
  staffOptions,
  dueDateOptions,
} = Astro.props;

const currentRole = currentUser?.profile?.role;

const description = project?.description || "No description";

// console.log("üîç [PROJECT-feater] Project:", project.featured_image_data);
// console.log("üîç [PROJECT-featured=imaage] Project:", project.featured_image);
// return if user is staff and project is not assigned to them
// if (currentRole === "Staff" && project.assigned_to_id !== user?.id) {
//   return null;
// }

// if (currentRole === "Client" && project.author_id !== user?.id) {
//   return null;
// }

const statusSlugOrId =
  currentRole && currentRole === "Client" ? currentStatusSlug : currentStatusInt;
// Debug logging removed for performance

// Function to limit description to 200 words
function limitDescription(text: string, wordLimit: number = 50): string {
  if (!text) return "";
  const words = text.trim().split(/\s+/);
  if (words.length <= wordLimit) return text;
  return words.slice(0, wordLimit).join(" ") + "...";
}

// Get project status info from passed statuses or fallback to default
// Status color is now provided by the get-project-statuses API

// Use the pre-calculated elapsed_time from the database
const elapsedTime = project.elapsed_time;
let projectAgeColor = "rgb(209, 213, 219)"; // Default gray
let projectAlertIconCount = 0;
let elapsedHours = 0; // Initialize outside the if block

// Function to format elapsed time into hours and minutes
function formatElapsedTime(elapsedTime: any): string {
  if (!elapsedTime) return "0h 0m";

  let totalMinutes = 0;

  if (typeof elapsedTime === "string") {
    // Parse interval string (e.g., "2 days 5:30:45")
    const match = elapsedTime.match(/(\d+) days? (\d+):(\d+):(\d+)/);
    if (match) {
      const days = parseInt(match[1]);
      const hours = parseInt(match[2]);
      const minutes = parseInt(match[3]);
      totalMinutes = days * 24 * 60 + hours * 60 + minutes;
    } else {
      // Try to parse as just hours:minutes:seconds
      const timeMatch = elapsedTime.match(/(\d+):(\d+):(\d+)/);
      if (timeMatch) {
        const hours = parseInt(timeMatch[1]);
        const minutes = parseInt(timeMatch[2]);
        totalMinutes = hours * 60 + minutes;
      }
    }
  } else if (elapsedTime.total_seconds) {
    // If it's an object with total_seconds
    totalMinutes = Math.floor(elapsedTime.total_seconds / 60);
  } else if (elapsedTime.days !== undefined) {
    // If it's an object with days, hours, minutes, seconds
    totalMinutes =
      (elapsedTime.days || 0) * 24 * 60 +
      (elapsedTime.hours || 0) * 60 +
      (elapsedTime.minutes || 0);
  }

  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;

  return `${hours}h ${minutes}m`;
}

// Calculate time since last update
function getTimeSinceUpdate(updatedAt: string): string {
  const now = new Date();
  const updated = new Date(updatedAt);
  const diffMs = now.getTime() - updated.getTime();

  const seconds = Math.floor(diffMs / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  const weeks = Math.floor(days / 7);
  const months = Math.floor(days / 30);
  const years = Math.floor(days / 365);

  if (years > 0) {
    return `${years} year${years > 1 ? "s" : ""} ago`;
  } else if (months > 0) {
    return `${months} month${months > 1 ? "s" : ""} ago`;
  } else if (weeks > 0) {
    return `${weeks} week${weeks > 1 ? "s" : ""} ago`;
  } else if (days > 0) {
    return `${days} day${days > 1 ? "s" : ""} ago`;
  } else if (hours > 0) {
    return `${hours} hour${hours > 1 ? "s" : ""} ago`;
  } else if (minutes > 0) {
    return `${minutes} minute${minutes > 1 ? "s" : ""} ago`;
  } else {
    return "Just now";
  }
}

const timeSinceUpdate = getTimeSinceUpdate(project.updated_at);

if (elapsedTime) {
  // Convert PostgreSQL interval to hours
  // elapsedTime is a string like "2 days 5:30:45" or an object with properties

  if (typeof elapsedTime === "string") {
    // Parse interval string (e.g., "2 days 5:30:45")
    const match = elapsedTime.match(/(\d+) days? (\d+):(\d+):(\d+)/);
    if (match) {
      const days = parseInt(match[1]);
      const hours = parseInt(match[2]);
      elapsedHours = days * 24 + hours;
    }
  } else if (elapsedTime.total_seconds) {
    // If it's an object with total_seconds
    elapsedHours = elapsedTime.total_seconds / 3600;
  } else if (elapsedTime.days !== undefined) {
    // If it's an object with days, hours, minutes, seconds
    elapsedHours =
      (elapsedTime.days || 0) * 24 + (elapsedTime.hours || 0) + (elapsedTime.minutes || 0) / 60;
  }

  const isOver48Hours = elapsedHours > 48;

  if (isOver48Hours) {
    // Calculate how many 12-hour periods have passed since 48 hours
    const hoursPast48 = elapsedHours - 48;
    const colorLevel = Math.floor(hoursPast48 / 12); // Every 12 hours = new color level

    // Progressive red color scale (using standard red colors)
    switch (colorLevel) {
      case 0:
        projectAgeColor = "rgb(254, 242, 242)";
        projectAlertIconCount = 1;
        break; // 48-60 hours
      case 1:
        projectAgeColor = "rgb(254, 226, 226)";
        projectAlertIconCount = 2;
        break; // 60-72 hours
      case 2:
        projectAgeColor = "rgb(252, 202, 202)";
        projectAlertIconCount = 3;
        break; // 72-84 hours
      case 3:
        projectAgeColor = "rgb(251, 173, 173)";
        projectAlertIconCount = 4;
        break; // 84-96 hours
      case 4:
        projectAgeColor = "rgb(239, 68, 68)";
        projectAlertIconCount = 5;
        break; // 96-108 hours
      default:
        projectAgeColor = "rgb(220, 38, 38)";
        projectAlertIconCount = 6;
        break; // 108+ hours
    }
  }
}

// Simple function to render alert icons as HTML
function renderAlertIcons(count: number) {
  let html = "";
  for (let i = 0; i < count; i++) {
    html +=
      '<i class="bx bx-error-circle text-red-500 bx-xs rounded-full bg-white dark:bg-gray-800 block"></i>';
  }
  return html;
}

const statusColor = currentStatusColor || "gray";

// // Convert to days, hours, and minutes
// const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
// const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
// const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

// Format the duration
// const createdAt = `${days}d ${hours}h ${minutes}m`;
---

<tr
  class="EpUSgjHdM6oyMXUiK_8_ _7KA5gD55t2lxf9Jkj20 _JnjhZbEHpDJUKJAU8Cw iIDqXVKz6wdYnAVfRsN2"
  data-project-status={statusSlugOrId}
  data-project-id={project.id}
>
  <td class="E9GV5sZJIbfO_GEQ_moc RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
    <div class="YRrCJSr_j5nopfm4duUc Q_jg_EPdNf9eDMn1mLI2">
      <BoxIcon
        name="trash"
        class="text-red-500"
        dataAttributes={{
          "data-project-id": project.id,
          onclick: `event.stopPropagation(); deleteProject(${project.id})`,
        }}
      />
      <!-- <input
        id="checkbox-table-search-1"
        type="checkbox"
        onclick="event.stopPropagation()"
        class="_o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc Y3FxyuXtj2gecrGXvLEI vpDN1VEJLu5FmLkr5WCk _9dH7mrOkzM4RTmidHTs _6MyV8SXoSWq_PQ6KWI6 _q0p_O8QLU1paqtuqmI2 GdTcGtoKP5_bET3syLDl Mmx5lX7HVdrWCgh3EpTP jqg6J89cvxmDiFpnV56r _GL8_lXmAgroY9ZBWGLH BO8JrKgx4qkHG27c4wVR"
      />
      <label for="checkbox-table-search-1" class="_DVAfiyo21kM68EUVzEQ">checkbox</label> -->
    </div>
  </td>

  <th scope="row" class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j relative"
    ><a
      href={`/project/${project.id}`}
      class="ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl oJZU4OQzzfXeLbF7UKZ_ OyABRrnTV_kvHV7dJ0uE"
      >{project.address || "No address"}

      {
        currentRole !== "Client" && (
          <span
            class={`font-large z-1 absolute right-0 top-0 mb-4 cursor-pointer`}
            set:html={renderAlertIcons(projectAlertIconCount)}
          />
        )
      }
    </a></th
  >

  {
    currentRole !== "Client" && (
      <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
        {project?.authorProfile?.[0]?.company_name ||
          project?.authorProfile?.company_name ||
          "Unknown Author"}
      </td>
    )
  }

  <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
    <a
      href={`/project/${project.id}?status=${currentStatusTab}`}
      style={`background-color: ${statusColor};`}
      class="Y3FxyuXtj2gecrGXvLEI YccXYy5sNIz6FJlLxw0D St_AVDyTHE88JaawJoRQ Zs2BLzUMh0_yTpU6xCcU gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe mbOxN7eW74XygTKQC_r3 V9HgZms3_2W5sanRatci text-white"
      >{currentStatusName || "Unknown Status"}</a
    >
  </td>
  <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
    <div class="YRrCJSr_j5nopfm4duUc IxVXJAn2ZWxXpcIHvPnh XrB0f1gZzjK6cEODacjg">
      <a href={`/project/${project.id}?status=documents`} class="text-sm text-gray-600">
        <div
          class="flex flex-wrap items-center gap-2"
          id="project-files-{project.id}"
          data-project-files={JSON.stringify(project.projectFiles || [])}
        >
        </div>
      </a>
    </div>
    {
      currentRole !== "Client" && (
        <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe">
          <div class="Z3N7I2IDDsoXK6xJ1cSW YRrCJSr_j5nopfm4duUc URF_PdoDtDpDi8BZQL94">
            {/* <SlotMachineModal
              id={`assign-staff-${project.id}`}
              title="Assign Staff Member"
              options={staffOptions}
              selectedValue={project?.assigned_to_id || ""}
              placeholder="Assign staff..."
              buttonText={(() => {
                if (!project?.assigned_to_id) return "Unassigned";
                const assignedStaff = staffOptions.find(
                  (staff: any) => staff.value === project.assigned_to_id
                );
                return assignedStaff?.label || "Unknown Staff";
              })()}
              saveApiEndpoint="assign-staff"
              showCloseButton={true}
              showCancelButton={true}
              skipSaveToAPI={false}
              project={project}
              showNotification={true}
              searchText="Search staff..."
              buttonVariant="anchor"
            /> */}

            <SlotMachineModalStaff
              id={`assign-staff-slot-machine-${project.id}`}
              title="Assign Staff Member"
              options={staffOptions}
              selectedValue={project?.assigned_to_id || ""}
              placeholder="Assign staff..."
              buttonText={(() => {
                if (!project?.assigned_to_id) return "Unassigned";
                const assignedStaff = staffOptions.find(
                  (staff: any) => staff.value === project.assigned_to_id
                );
                return assignedStaff?.label || "Unknown Staff";
              })()}
              saveApiEndpoint="assign-staff"
              showCloseButton={true}
              showCancelButton={true}
              project={project}
              showNotification={true}
              icon="user"
              searchText="Search staff..."
              buttonVariant="anchor"
              currentUser={currentUser}
            />
          </div>
        </td>
      )
    }

    <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe">
      <div class="Z3N7I2IDDsoXK6xJ1cSW YRrCJSr_j5nopfm4duUc URF_PdoDtDpDi8BZQL94">
        <span
          class="gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 XIIs8ZOri3wm8Wnj9N_y"
          >{((project.status / 220) * 100).toFixed(0)}%</span
        >
      </div>
      <div
        class="Q_MJbqFAgVV93n0S3SFL t6gkcSf0Bt4MLItXvDJ_ RpVwy4sO7Asb86CncKJ_ WwS1mve_UI16RedcVHEs jqg6J89cvxmDiFpnV56r"
      >
        <div
          class="Q_MJbqFAgVV93n0S3SFL RpVwy4sO7Asb86CncKJ_ HstV_RZX_OUMWsk6ZYSX"
          style=`width: ${((project.status / 220) * 100).toFixed(0)}%`
        >
        </div>
      </div>
    </td>
    <td
      class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
    >
      {project.punchlistItems?.completed || 0} / {project.punchlistItems?.total || 0}
    </td>
    <td
      class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
    >
      <!-- <svg
        class="_x10ClrjYfqGxZTMmpBl OEd3yuKfmszRdDeW_2zu _AA3rO_G7gzZSX90mzZi"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M18 14v4.8a1.2 1.2 0 0 1-1.2 1.2H5.2A1.2 1.2 0 0 1 4 18.8V7.2A1.2 1.2 0 0 1 5.2 6h4.6m4.4-2H20v5.8m-7.9 2L20 4.2"
        ></path>
      </svg> -->
      {
        formatElapsedTime({
          total_seconds: (Date.now() - new Date(project.created_at).getTime()) / 1000,
        })
      }
    </td>
    <td
      class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
    >
      <div
        class="_k0lTW0vvzboctTxDi2R Q_jg_EPdNf9eDMn1mLI2 mveJTCIb2WII7J4sY22F pXhVRBC8yaUNllmIWxln _Ybd3WwuTVljUT4vEaM3 _bVaO2NfVVP88LtHWYlv _GSNszqbCuS9hoWd_f_m ODwQB_Ntbd93L5eefCAa gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe Mmx5lX7HVdrWCgh3EpTP jqg6J89cvxmDiFpnV56r"
      >
        {timeSinceUpdate}
        <!-- <svg
        class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc _JmTNv5EiHqK2A1jcQSf"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          fill-rule="evenodd"
          d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm11-4a1 1 0 1 0-2 0v4c0 .3.1.5.3.7l3 3a1 1 0 0 0 1.4-1.4L13 11.6V8Z"
          clip-rule="evenodd"></path>
      </svg>
      <span class="_slPOgYG58UZfxi9teaV">6:47</span>
      /8:00
      <button
        class="oA7zcT_42jVeFuWTXQnq W5n_NSFnC6y2nqoHw_5x YJ3MjahAXRIwyTJETpB3 sQaK4IH7BIQSgBTGX8Pe y6GKdvUrd7vp_pxsFb57 ju_X9EEcwk2iiyib1u97"
      >
        <svg
          class="_o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            fill-rule="evenodd"
            d="M8 5a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H8Zm7 0a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1Z"
            clip-rule="evenodd"></path>
        </svg>
      </button> -->
      </div>
    </td>
    <td
      class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
    >
      {
        currentRole === "Admin" || currentRole === "Staff" ? (
          // <SlotMachineModal
          //   id={`due-date-${project.id}`}
          //   title="Select Due Date"
          //   options={dueDateOptions}
          //   selectedValue={relationship}
          //   placeholder="Choose due date"
          //   buttonText={
          //     new Date(project?.due_date).toLocaleDateString(undefined, {
          //       year: "numeric",
          //       month: "long",
          //       day: "numeric",
          //       hour: "2-digit",
          //       minute: "2-digit",
          //     }) || "No due date"
          //   }
          //   saveApiEndpoint="update-project"
          //   showCloseButton={true}
          //   showCancelButton={true}
          //   skipSaveToAPI={false}
          //   project={project}
          //   showNotification={true}
          //   icon="time"
          //   searchText="Choose due date..."
          // />

          <span>
            {" "}
            {project?.due_date
              ? new Date(project.due_date).toLocaleDateString("en-US", {
                  weekday: "short",
                  month: "short",
                  day: "numeric",
                  hour: "numeric",
                  minute: "2-digit",
                  hour12: true,
                })
              : ""}{" "}
          </span>
        ) : (
          <span>
            {new Date(project?.due_date).toLocaleDateString(undefined, {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </span>
        )
      }
    </td>
    <td class="RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
      <!-- <button
      id="project-dropdown-button"
      type="button"
      data-dropdown-toggle="project-dropdown"
      class="_k0lTW0vvzboctTxDi2R Q_jg_EPdNf9eDMn1mLI2 mveJTCIb2WII7J4sY22F sQaK4IH7BIQSgBTGX8Pe ijrOHNoSVGATsWYKl4Id c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 lBgPGkku8NiP5ReH09_2 ZnBoTVi7VOJdCLSSU62n BkIbg_JwkgiyRW804Hhu XIIs8ZOri3wm8Wnj9N_y OPrb_iG5WDy_7F05BDOX dMTOiA3mf3FTjlHu6DqW"
    >
      <svg
        class="rxe6apEJoEk8r75xaVNG ADSeKHR1DvUUA48Chci_"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <path stroke="currentColor" stroke-linecap="round" stroke-width="4" d="M6 12h0m6 0h0m6 0h0"
        ></path>
      </svg>
    </button>
    <div
      id="project-dropdown"
      class="QhmQ_v3mmDFIP9VaVOfb _SmdlCf6eUKB_V9S5IDj fScvmu_bLBCkoXb3Xml3 Zy1Pypi71Xu6guex6urN z30cepEEBLSTPSvWeVPH mveJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 mngKhi_Rv06PF57lblDI PoeKYEQfG4WfmL9xM6vu jqg6J89cvxmDiFpnV56r"
      data-popper-placement="bottom"
      style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(1448px, 374.5px, 0px);"
      data-popper-reference-hidden=""
      data-popper-escaped=""
    >
      <ul
        class="FJRldeiG2gFGZfuKgp88 c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 XIIs8ZOri3wm8Wnj9N_y"
        aria-labelledby="project-dropdown-button"
      >
        <li>
          <button
            type="button"
            id="editProjectButton"
            data-modal-target="editProjectModal"
            data-modal-toggle="editProjectModal"
            class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j _7KA5gD55t2lxf9Jkj20 ZnBoTVi7VOJdCLSSU62n RzANcaqunVvlLrO6_tal dMTOiA3mf3FTjlHu6DqW"
          >
            <svg
              class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M11.3 6.2H5a2 2 0 0 0-2 2V19a2 2 0 0 0 2 2h11c1.1 0 2-1 2-2.1V11l-4 4.2c-.3.3-.7.6-1.2.7l-2.7.6c-1.7.3-3.3-1.3-3-3.1l.6-2.9c.1-.5.4-1 .7-1.3l3-3.1Z"
                clip-rule="evenodd"></path>
              <path
                fill-rule="evenodd"
                d="M19.8 4.3a2.1 2.1 0 0 0-1-1.1 2 2 0 0 0-2.2.4l-.6.6 2.9 3 .5-.6a2.1 2.1 0 0 0 .6-1.5c0-.2 0-.5-.2-.8Zm-2.4 4.4-2.8-3-4.8 5-.1.3-.7 3c0 .3.3.7.6.6l2.7-.6.3-.1 4.7-5Z"
                clip-rule="evenodd"></path>
            </svg>
            Edit
          </button>
        </li>
        <li>
          <a
            href="../project-summary"
            class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j _7KA5gD55t2lxf9Jkj20 ZnBoTVi7VOJdCLSSU62n RzANcaqunVvlLrO6_tal dMTOiA3mf3FTjlHu6DqW"
          >
            <svg
              class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M5 7.8C6.7 6.3 9.2 5 12 5s5.3 1.3 7 2.8a12.7 12.7 0 0 1 2.7 3.2c.2.2.3.6.3 1s-.1.8-.3 1a2 2 0 0 1-.6 1 12.7 12.7 0 0 1-9.1 5c-2.8 0-5.3-1.3-7-2.8A12.7 12.7 0 0 1 2.3 13c-.2-.2-.3-.6-.3-1s.1-.8.3-1c.1-.4.3-.7.6-1 .5-.7 1.2-1.5 2.1-2.2Zm7 7.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                clip-rule="evenodd"></path>
            </svg>
            View
          </a>
        </li>
      </ul>
      <div class="FJRldeiG2gFGZfuKgp88">
        <button
          type="button"
          id="deleteProjectButton"
          data-modal-target="deleteProjectModal"
          data-modal-toggle="deleteProjectModal"
          class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe m_WzesDEb91pTPmX64rt _7KA5gD55t2lxf9Jkj20 Sz97zU8r72z_pjE9zQnR RzANcaqunVvlLrO6_tal"
        >
          <svg
            class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M8.6 2.6A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4c0-.5.2-1 .6-1.4ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
              clip-rule="evenodd"></path>
          </svg>
          Delete
        </button>
      </div>
    </div> -->
    </td>

    <tr
      class="EpUSgjHdM6oyMXUiK_8_ _7KA5gD55t2lxf9Jkj20 _JnjhZbEHpDJUKJAU8Cw iIDqXVKz6wdYnAVfRsN2 relative hidden"
    >
      <!-- data-project-id={project.id} -->
      <!-- data-project-status={statusSlugOrId} -->

      <!-- <td class="E9GV5sZJIbfO_GEQ_moc RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
      <div class="YRrCJSr_j5nopfm4duUc Q_jg_EPdNf9eDMn1mLI2 hidden">
        <input
          id="checkbox-table-search-1"
          type="checkbox"
          onclick="event.stopPropagation()"
          class="_o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc Y3FxyuXtj2gecrGXvLEI vpDN1VEJLu5FmLkr5WCk _9dH7mrOkzM4RTmidHTs _6MyV8SXoSWq_PQ6KWI6 _q0p_O8QLU1paqtuqmI2 GdTcGtoKP5_bET3syLDl Mmx5lX7HVdrWCgh3EpTP jqg6J89cvxmDiFpnV56r _GL8_lXmAgroY9ZBWGLH BO8JrKgx4qkHG27c4wVR"
        />
        <label for="checkbox-table-search-1" class="_DVAfiyo21kM68EUVzEQ">checkbox</label>
      </div>
    </td> -->
      <td scope="row" class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j"
        ><a
          href={`/project/${project.id}`}
          class="ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl oJZU4OQzzfXeLbF7UKZ_ OyABRrnTV_kvHV7dJ0uE"
          >{project.address || "No address"}</a
        ></td
      >
      <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
        <span
          class="Y3FxyuXtj2gecrGXvLEI YccXYy5sNIz6FJlLxw0D St_AVDyTHE88JaawJoRQ Zs2BLzUMh0_yTpU6xCcU gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe mbOxN7eW74XygTKQC_r3 V9HgZms3_2W5sanRatci Uq09bvia_7yL7hYv2uSO"
          >{currentStatusName}</span
        >
      </td>
      <td class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
        <div class="YRrCJSr_j5nopfm4duUc IxVXJAn2ZWxXpcIHvPnh XrB0f1gZzjK6cEODacjg">
          <span data-searchable>
            {
              project?.assignedToProfile?.company_name ? (
                <span data-searchable>{project.assignedToProfile?.company_name}</span>
              ) : (
                <span class="text-danger-500">UNASSIGNED</span>
              )
            }
          </span>
          <!-- <img
        src="https://flowbite.com/application-ui/demo/images/users/avatar-10.png"
        alt=""
        class="Mln3CkDzLcoVQAC3Uqsd hlT3pgfpx11BUFMWNdhc _VPh6kIywCMfXFfQLas4 RpVwy4sO7Asb86CncKJ_ b0rXX23llDSn6PZwxAyx MGZ9bvBP5fgetIhNCD_o _JnjhZbEHpDJUKJAU8Cw"
      />-->
        </div>
      </td>
      <td
        class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe"
      >
        <div class="Z3N7I2IDDsoXK6xJ1cSW YRrCJSr_j5nopfm4duUc URF_PdoDtDpDi8BZQL94">
          <span
            class="gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 XIIs8ZOri3wm8Wnj9N_y"
            >75%</span
          >
        </div>
        <div
          class="Q_MJbqFAgVV93n0S3SFL t6gkcSf0Bt4MLItXvDJ_ RpVwy4sO7Asb86CncKJ_ WwS1mve_UI16RedcVHEs jqg6J89cvxmDiFpnV56r"
        >
          <div
            class="Q_MJbqFAgVV93n0S3SFL RpVwy4sO7Asb86CncKJ_ HstV_RZX_OUMWsk6ZYSX"
            style="width: 75%"
          >
          </div>
        </div>
      </td>
      <td
        class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
      >
        <a
          href="#"
          class="_k0lTW0vvzboctTxDi2R Q_jg_EPdNf9eDMn1mLI2 ezMFUVl744lvw6ht0lFe _6MyV8SXoSWq_PQ6KWI6 oJZU4OQzzfXeLbF7UKZ_ fZf6W_ZtzEh6EEqmWMA9"
        >
          <svg
            class="_x10ClrjYfqGxZTMmpBl OEd3yuKfmszRdDeW_2zu _AA3rO_G7gzZSX90mzZi"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M18 14v4.8a1.2 1.2 0 0 1-1.2 1.2H5.2A1.2 1.2 0 0 1 4 18.8V7.2A1.2 1.2 0 0 1 5.2 6h4.6m4.4-2H20v5.8m-7.9 2L20 4.2"
            ></path>
          </svg>
          Website
        </a>
      </td>
      <td
        class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
      >
        <div
          class="_k0lTW0vvzboctTxDi2R Q_jg_EPdNf9eDMn1mLI2 mveJTCIb2WII7J4sY22F pXhVRBC8yaUNllmIWxln _Ybd3WwuTVljUT4vEaM3 _bVaO2NfVVP88LtHWYlv _GSNszqbCuS9hoWd_f_m ODwQB_Ntbd93L5eefCAa gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe Mmx5lX7HVdrWCgh3EpTP jqg6J89cvxmDiFpnV56r"
        >
          <svg
            class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc _JmTNv5EiHqK2A1jcQSf"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm11-4a1 1 0 1 0-2 0v4c0 .3.1.5.3.7l3 3a1 1 0 0 0 1.4-1.4L13 11.6V8Z"
              clip-rule="evenodd"></path>
          </svg>
          <span class="_slPOgYG58UZfxi9teaV">6:47</span>
          /8:00
          <button
            class="oA7zcT_42jVeFuWTXQnq W5n_NSFnC6y2nqoHw_5x YJ3MjahAXRIwyTJETpB3 sQaK4IH7BIQSgBTGX8Pe y6GKdvUrd7vp_pxsFb57 ju_X9EEcwk2iiyib1u97"
          >
            <svg
              class="_o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M8 5a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H8Zm7 0a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1Z"
                clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </td>
      <td
        class="BHrWGjM1Iab_fAz0_91H RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j gMXmdpOPfqG_3CKkL0VD ezMFUVl744lvw6ht0lFe __9sbu0yrzdhGIkLWNXl OyABRrnTV_kvHV7dJ0uE"
        >23 Nov 2025</td
      >
      <td class="RZmKBZs1E1eXw8vkE6jY b9aD6g2qw84oyZNsMO8j">
        <button
          id="project-dropdown-button"
          type="button"
          data-dropdown-toggle="project-dropdown"
          class="_k0lTW0vvzboctTxDi2R Q_jg_EPdNf9eDMn1mLI2 mveJTCIb2WII7J4sY22F sQaK4IH7BIQSgBTGX8Pe ijrOHNoSVGATsWYKl4Id c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 lBgPGkku8NiP5ReH09_2 ZnBoTVi7VOJdCLSSU62n BkIbg_JwkgiyRW804Hhu XIIs8ZOri3wm8Wnj9N_y OPrb_iG5WDy_7F05BDOX dMTOiA3mf3FTjlHu6DqW"
        >
          <svg
            class="rxe6apEJoEk8r75xaVNG ADSeKHR1DvUUA48Chci_"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-width="4"
              d="M6 12h0m6 0h0m6 0h0"></path>
          </svg>
        </button>
        <div
          id="project-dropdown"
          class="QhmQ_v3mmDFIP9VaVOfb _SmdlCf6eUKB_V9S5IDj fScvmu_bLBCkoXb3Xml3 Zy1Pypi71Xu6guex6urN z30cepEEBLSTPSvWeVPH mveJTCIb2WII7J4sY22F _Ybd3WwuTVljUT4vEaM3 mngKhi_Rv06PF57lblDI PoeKYEQfG4WfmL9xM6vu jqg6J89cvxmDiFpnV56r"
          data-popper-placement="bottom"
          style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(1448px, 374.5px, 0px);"
          data-popper-reference-hidden=""
          data-popper-escaped=""
        >
          <ul
            class="FJRldeiG2gFGZfuKgp88 c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe PeR2JZ9BZHYIH8Ea3F36 XIIs8ZOri3wm8Wnj9N_y"
            aria-labelledby="project-dropdown-button"
          >
            <li>
              <!-- data-modal-target="editProjectModal"
            data-modal-toggle="editProjectModal" -->
              <button
                type="button"
                id="editProjectButton"
                class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j _7KA5gD55t2lxf9Jkj20 ZnBoTVi7VOJdCLSSU62n RzANcaqunVvlLrO6_tal dMTOiA3mf3FTjlHu6DqW"
              >
                <svg
                  class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill-rule="evenodd"
                    d="M11.3 6.2H5a2 2 0 0 0-2 2V19a2 2 0 0 0 2 2h11c1.1 0 2-1 2-2.1V11l-4 4.2c-.3.3-.7.6-1.2.7l-2.7.6c-1.7.3-3.3-1.3-3-3.1l.6-2.9c.1-.5.4-1 .7-1.3l3-3.1Z"
                    clip-rule="evenodd"></path>
                  <path
                    fill-rule="evenodd"
                    d="M19.8 4.3a2.1 2.1 0 0 0-1-1.1 2 2 0 0 0-2.2.4l-.6.6 2.9 3 .5-.6a2.1 2.1 0 0 0 .6-1.5c0-.2 0-.5-.2-.8Zm-2.4 4.4-2.8-3-4.8 5-.1.3-.7 3c0 .3.3.7.6.6l2.7-.6.3-.1 4.7-5Z"
                    clip-rule="evenodd"></path>
                </svg>
                Edit
              </button>
            </li>
            <li>
              <a
                href="../project-summary"
                class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j _7KA5gD55t2lxf9Jkj20 ZnBoTVi7VOJdCLSSU62n RzANcaqunVvlLrO6_tal dMTOiA3mf3FTjlHu6DqW"
              >
                <svg
                  class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5 7.8C6.7 6.3 9.2 5 12 5s5.3 1.3 7 2.8a12.7 12.7 0 0 1 2.7 3.2c.2.2.3.6.3 1s-.1.8-.3 1a2 2 0 0 1-.6 1 12.7 12.7 0 0 1-9.1 5c-2.8 0-5.3-1.3-7-2.8A12.7 12.7 0 0 1 2.3 13c-.2-.2-.3-.6-.3-1s.1-.8.3-1c.1-.4.3-.7.6-1 .5-.7 1.2-1.5 2.1-2.2Zm7 7.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                    clip-rule="evenodd"></path>
                </svg>
                View
              </a>
            </li>
          </ul>
          <div class="FJRldeiG2gFGZfuKgp88">
            <button
              type="button"
              id="deleteProjectButton"
              class="_k0lTW0vvzboctTxDi2R t6gkcSf0Bt4MLItXvDJ_ Q_jg_EPdNf9eDMn1mLI2 W5n_NSFnC6y2nqoHw_5x _Cj_M6jt2eLjDgkBBNgI b9aD6g2qw84oyZNsMO8j c8dCx6gnV43hTOLV6ks5 ezMFUVl744lvw6ht0lFe m_WzesDEb91pTPmX64rt _7KA5gD55t2lxf9Jkj20 Sz97zU8r72z_pjE9zQnR RzANcaqunVvlLrO6_tal"
            >
              <!-- data-modal-target="deleteProjectModal"
          data-modal-toggle="deleteProjectModal" -->
              <svg
                class="IRKzgyPj4qWOh2vq2xBg _o2IXcpM0qnG3JPReKus E9GV5sZJIbfO_GEQ_moc"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M8.6 2.6A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4c0-.5.2-1 .6-1.4ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
                  clip-rule="evenodd"></path>
              </svg>
              Delete
            </button>
          </div>
        </div>
      </td>
    </tr>

    <!-- Featured Image Display -->

    <a
      href={`/project/${project.id}`}
      data-refresh="featured_image_data:public_url"
      data-project-id={project.id}
      class="hidden h-32 items-center justify-center overflow-hidden rounded-t-lg bg-gray-100 dark:bg-gray-700"
    >
    </a>

    <div class="hidden p-3">
      <a href={`/project/${project.id}`} class="transition-opacity hover:opacity-80">
        <div class="flex items-center gap-2">
          <h3 class="truncate text-lg font-semibold" data-searchable>
            {
              currentRole !== "Client" &&
                (project.authorProfile?.[0]?.company_name ||
                  project.authorProfile?.company_name ||
                  "Unknown Author") + " ‚Üí "
            }
            {project.address}
          </h3>
        </div>
        <span
          class="rounded-full px-2.5 py-1 text-sm transition-opacity hover:opacity-80"
          style={`background-color: ${statusColor};`}
        >
          {currentStatusName} / {currentStatusEstTime}
        </span>
        <div class="min-w-full flex-none md:flex-1">
          <p class="mb-2 mt-2 text-sm" data-project-description title={description}>
            {limitDescription(description)}
          </p>
        </div>
      </a>

      <div class="items-start justify-between gap-4">
        <a
          href={`/project/${project.id}`}
          class="mb-4 cursor-pointer text-sm transition-opacity hover:opacity-80"
        >
          <span class="flex items-center gap-1">
            <BoxIcon name="area" class="" />
            {project.sq_ft ? project.sq_ft.toLocaleString() : 0}ft¬≤
          </span>
          <span class="flex items-center gap-1">
            <BoxIcon name="building" class="" />
            {project.new_construction ? "New" : "Existing"}
          </span>
        </a>

        <!-- <div class="justify-end text-xs">
        <div>
          <b>Project Age:</b>
          {createdAt}
        </div>
      </div> -->
      </div>

      <div
        class="flex flex-col gap-2 transition-opacity hover:opacity-80 md:flex-row md:items-center md:gap-4"
      >
        {
          currentRole !== "Client" && (
            <div class="flex items-center gap-1">
              <BoxIcon name="user" size="sm" class="" />
              <span data-searchable>
                {project.assignedToProfile?.company_name ? (
                  <span data-searchable>{project.assignedToProfile?.company_name}</span>
                ) : (
                  <span class="text-danger-500">UNASSIGNED</span>
                )}
              </span>
            </div>
          )
        }

        <Tooltip content={elapsedTime.toLocaleString()} id="project-created-at">
          <BoxIcon name="time" size="md" class="" />
        </Tooltip>

        <a
          href={`/project/${project.id}?status=discussion`}
          class="relative ml-auto cursor-pointer transition-opacity hover:opacity-80"
          title={`${project.comment_count || 0} comments - Go to discussions`}
        >
          <BoxIcon name="message-rounded" size="md" class="" />
          <!-- {
          project.incomplete_discussions > 0 && ( -->
          <span
            class="absolute right-1.5 top-1.5 inline-flex h-4 min-w-[1.25rem] items-center justify-center rounded-full text-xs"
          >
            {project.incomplete_discussions > 99 ? "99+" : project.incomplete_discussions}/{
              project.comment_count > 99 ? "99+" : project.comment_count
            }
          </span>
          <!-- )
        } -->
        </a>
      </div>
    </div>

    <script>
      // Update time display every minute
      function updateTimeDisplay() {
        const timeElements = document.querySelectorAll("[data-time-since-update]");

        timeElements.forEach((element) => {
          const updatedAt = element.getAttribute("data-updated-at");
          if (updatedAt) {
            const now = new Date();
            const updated = new Date(updatedAt);
            const diffMs = now.getTime() - updated.getTime();

            const seconds = Math.floor(diffMs / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);

            let timeText;
            if (years > 0) {
              timeText = `${years} year${years > 1 ? "s" : ""} ago`;
            } else if (months > 0) {
              timeText = `${months} month${months > 1 ? "s" : ""} ago`;
            } else if (weeks > 0) {
              timeText = `${weeks} week${weeks > 1 ? "s" : ""} ago`;
            } else if (days > 0) {
              timeText = `${days} day${days > 1 ? "s" : ""} ago`;
            } else if (hours > 0) {
              timeText = `${hours} hour${hours > 1 ? "s" : ""} ago`;
            } else if (minutes > 0) {
              timeText = `${minutes} minute${minutes > 1 ? "s" : ""} ago`;
            } else {
              timeText = "Just now";
            }

            element.textContent = timeText;
          }
        });
      }

      // Update immediately and then every minute
      updateTimeDisplay();
      setInterval(updateTimeDisplay, 60000); // 60000ms = 1 minute

      // Render file icons for this project
      renderFileIcons();

      // File icon function for displaying file type icons
      function getFileIcon(fileType: string) {
        const type = (fileType || "").toLowerCase();

        if (type.includes("pdf")) {
          return `<svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
          <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
        </svg>`;
        }

        if (
          type.includes("image") ||
          type.includes("png") ||
          type.includes("jpg") ||
          type.includes("jpeg") ||
          type.includes("gif") ||
          type.includes("webp") ||
          type.includes("svg")
        ) {
          return `<svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
        </svg>`;
        }

        if (type.includes("word") || type.includes("doc")) {
          return `<svg class="h-5 w-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
          <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
        </svg>`;
        }

        if (type.includes("excel") || type.includes("sheet")) {
          return `<svg class="h-5 w-5 text-green-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
          <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
        </svg>`;
        }

        if (type.includes("powerpoint") || type.includes("presentation")) {
          return `<svg class="h-5 w-5 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
          <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
        </svg>`;
        }

        if (type.includes("zip") || type.includes("rar") || type.includes("archive")) {
          return `<svg class="h-5 w-5 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
          <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
        </svg>`;
        }

        if (
          type.includes("video") ||
          type.includes("mp4") ||
          type.includes("avi") ||
          type.includes("mov")
        ) {
          return `<svg class="h-5 w-5 text-pink-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 15V9l5 3-5 3z"/>
        </svg>`;
        }

        if (type.includes("audio") || type.includes("mp3") || type.includes("wav")) {
          return `<svg class="h-5 w-5 text-indigo-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>`;
        }

        // Default file icon
        return `<svg class="h-5 w-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      </svg>`;
      }

      // Render file icons with tooltips
      function renderFileIcons() {
        // Find all project file containers
        const containers = document.querySelectorAll('[id^="project-files-"]');

        containers.forEach((container) => {
          const projectFilesData = container.getAttribute("data-project-files");
          if (!projectFilesData) {
            return;
          }

          const projectFiles = JSON.parse(projectFilesData);

          if (!projectFiles || projectFiles.length === 0) {
            return;
          }

          // Clear existing content
          container.innerHTML = "";

          // Create file icons with tooltips
          projectFiles.forEach((file: any) => {
            const fileIconContainer = document.createElement("div");
            fileIconContainer.className = "relative group";
            fileIconContainer.innerHTML = `
            <div class="cursor-pointer">
              ${getFileIcon(file.file_type)}
            </div>
            <!-- CSS Tooltip -->
            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50">
              ${file.title || file.file_name}
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
            </div>
          `;

            container.appendChild(fileIconContainer);
          });
        });
      }
    </script>
  </td>
</tr>
