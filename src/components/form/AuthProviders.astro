---
// AuthProviders component - displays various authentication provider icons
// Icons are desaturated by default, saturate on hover/focus

import Tooltip from "../common/TooltipFloating.astro";
import SimpleIcon from "../common/SimpleIcon.astro";

interface Props {
  mode?: "login" | "register";
}

const { mode = "login" } = Astro.props;
const btnClasses = "provider-btn w-8 object-contain sm:w-12 md:w-14";
---

<div
  class="auth-providers mb-12 flex items-center justify-center gap-2 overflow-y-visible sm:gap-3 md:pt-12"
>
  <!-- Phone OTP -->
  <button
    type="button"
    class={btnClasses + " hidden"}
    data-provider="phone"
    title="Sign in with Phone OTP"
    aria-label="Sign in with Phone OTP"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="provider-icon"
    >
      <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
      <line x1="12" y1="18" x2="12.01" y2="18"></line>
    </svg>
    <span class="sr-only">Phone</span>
  </button>

  <!-- Email OTP -->
  <button
    type="button"
    class={btnClasses + " hidden"}
    data-provider="email"
    title="Sign in with Email OTP"
    aria-label="Sign in with Email OTP"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="provider-icon"
    >
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
      <polyline points="22,6 12,13 2,6"></polyline>
    </svg>
    <span class="sr-only">Email</span>
  </button>

  <!-- Google: OAuth via handleGoogleSignup (login/register) or redirect to login page (dropdown/popper) -->
  <Tooltip text="Sign in with Google" position="top" hideOnMobile>
    <button
      type="button"
      class={btnClasses}
      data-provider="google"
      title="Sign in with Google"
      aria-label="Sign in with Google"
    >
      <SimpleIcon name="google" size="md" class="provider-icon provider-icon-color" />
      <span class="sr-only">Google</span>
    </button>
  </Tooltip>

  <!-- Apple -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class={btnClasses + " grayscale opacity-60"}
      data-provider="apple"
      title="Coming soon"
      aria-label="Apple sign in coming soon"
      disabled
    >
      <SimpleIcon name="apple" size="md" class="provider-icon provider-icon-color" />
      <span class="sr-only">Apple</span>
    </button>
  </Tooltip>

  <!-- Facebook -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class={btnClasses + " grayscale opacity-60"}
      data-provider="facebook"
      title="Coming soon"
      aria-label="Facebook sign in coming soon"
      disabled
    >
      <SimpleIcon name="facebook" size="md" class="provider-icon provider-icon-color" />

      <span class="sr-only">Slack</span>
    </button>
  </Tooltip>

  <!-- Slack -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class={btnClasses + " grayscale opacity-60"}
      data-provider="slack"
      title="Coming soon"
      aria-label="Slack sign in coming soon"
      disabled
    >
      <SimpleIcon name="slack" size="md" class="provider-icon provider-icon-color" />

      <span class="sr-only">Slack</span>
    </button>
  </Tooltip>

  <!-- GitHub -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class={btnClasses + " grayscale opacity-60"}
      data-provider="github"
      title="Coming soon"
      aria-label="GitHub sign in coming soon"
      disabled
    >
      <SimpleIcon name="github" size="md" class="provider-icon provider-icon-color" />

      <span class="sr-only">GitHub</span>
    </button>
  </Tooltip>
</div>

<script>
  // Handle provider button clicks
  document.addEventListener("DOMContentLoaded", () => {
    const providerButtons = document.querySelectorAll(".provider-btn");

    providerButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const target = e.currentTarget;

        // Don't handle clicks on disabled buttons
        if ((target as HTMLButtonElement).disabled) {
          return;
        }

        const provider = (target as HTMLButtonElement).dataset.provider;
        console.log(`üîê Auth provider clicked: ${provider}`);

        // Handle specific providers
        switch (provider) {
          case "phone":
            window.location.href = "/auth/otp-login";
            break;
          case "email":
            window.location.href = "/auth/otp-login";
            break;
          case "google": {
            const handleGoogle = (window as any).handleGoogleSignup;
            if (typeof handleGoogle === "function") {
              handleGoogle(e);
            } else {
              window.location.href = "/auth/login?provider=google";
            }
            break;
          }
          case "facebook":
          case "slack":
          case "github":
            // These are disabled, so this shouldn't be reached
            console.log(`${provider} auth coming soon`);
            break;
        }
      });
    });
  });
</script>
