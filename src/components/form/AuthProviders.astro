---
// AuthProviders component - displays various authentication provider icons
// Icons are desaturated by default, saturate on hover/focus

import Tooltip from "../common/TooltipFloating.astro";
import SimpleIcon from "../common/SimpleIcon.astro";

interface Props {
  mode?: "login" | "register";
}

const { mode = "login" } = Astro.props;
---

<div class="auth-providers flex items-center justify-center gap-2 sm:gap-3 mb-12 pt-12">
  <!-- Phone OTP -->
  <button
    type="button"
    class="__provider-btn hidden"
    data-provider="phone"
    title="Sign in with Phone OTP"
    aria-label="Sign in with Phone OTP"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="provider-icon"
    >
      <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
      <line x1="12" y1="18" x2="12.01" y2="18"></line>
    </svg>
    <span class="provider-label hidden md:block">Phone</span>
  </button>

  <!-- Email OTP -->
  <button
    type="button"
    class="__provider-btn hidden"
    data-provider="email"
    title="Sign in with Email OTP"
    aria-label="Sign in with Email OTP"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="provider-icon"
    >
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
      <polyline points="22,6 12,13 2,6"></polyline>
    </svg>
    <span class="provider-label hidden md:block">Email</span>
  </button>

  <!-- Google: OAuth started by .provider-btn click ‚Üí handleGoogleSignup() (see login/register page script) -->
  <Tooltip text="Sign in with Google" position="top" mobileClickable={true}>
    <button
      type="button"
      class="hidden provider-btn"
      data-provider="google"
      title="Sign in with Google"
      aria-label="Sign in with Google"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        preserveAspectRatio="xMidYMid"
        viewBox="0 0 256 262"
        class="provider-icon provider-icon-color"
      >
        <path
          fill="#4285F4"
          d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027"
        ></path>
        <path
          fill="#34A853"
          d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1"
        ></path>
        <path
          fill="#FBBC05"
          d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782"
        ></path>
        <path
          fill="#EB4335"
          d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251"
        ></path>
      </svg>
      <span class="provider-label hidden md:block">Google</span>
    </button>
  </Tooltip>

  <!-- Facebook -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class="provider-btn"
      data-provider="apple"
      title="Coming soon"
      aria-label="Apple sign in coming soon"
      disabled
    >
      <SimpleIcon name="apple" size="lg" class="provider-icon provider-icon-color" />
      <span class="provider-label hidden md:block">Apple</span>
    </button>
  </Tooltip>

  <!-- Facebook -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class="provider-btn"
      data-provider="facebook"
      title="Coming soon"
      aria-label="Facebook sign in coming soon"
      disabled
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="provider-icon provider-icon-color"
      >
        <path
          fill="#1877F2"
          d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
        ></path>
      </svg>
      <span class="provider-label hidden md:block">Facebook</span>
    </button>
  </Tooltip>

  <!-- Slack -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class="provider-btn"
      data-provider="slack"
      title="Coming soon"
      aria-label="Slack sign in coming soon"
      disabled
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 127 127"
        class="provider-icon provider-icon-color"
      >
        <path
          fill="#E01E5A"
          d="M27.2 80c0 7.3-5.9 13.2-13.2 13.2C6.7 93.2.8 87.3.8 80c0-7.3 5.9-13.2 13.2-13.2h13.2V80zm6.6 0c0-7.3 5.9-13.2 13.2-13.2 7.3 0 13.2 5.9 13.2 13.2v33c0 7.3-5.9 13.2-13.2 13.2-7.3 0-13.2-5.9-13.2-13.2V80z"
        ></path>
        <path
          fill="#36C5F0"
          d="M47 27c-7.3 0-13.2-5.9-13.2-13.2C33.8 6.5 39.7.6 47 .6c7.3 0 13.2 5.9 13.2 13.2V27H47zm0 6.7c7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2H13.9C6.6 60.1.7 54.2.7 46.9c0-7.3 5.9-13.2 13.2-13.2H47z"
        ></path>
        <path
          fill="#2EB67D"
          d="M99.9 46.9c0-7.3 5.9-13.2 13.2-13.2 7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2H99.9V46.9zm-6.6 0c0 7.3-5.9 13.2-13.2 13.2-7.3 0-13.2-5.9-13.2-13.2V13.8C66.9 6.5 72.8.6 80.1.6c7.3 0 13.2 5.9 13.2 13.2v33.1z"
        ></path>
        <path
          fill="#ECB22E"
          d="M80.1 99.9c7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2-7.3 0-13.2-5.9-13.2-13.2V99.9h13.2zm0-6.6c-7.3 0-13.2-5.9-13.2-13.2 0-7.3 5.9-13.2 13.2-13.2h33.1c7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2H80.1z"
        ></path>
      </svg>
      <span class="provider-label hidden md:block">Slack</span>
    </button>
  </Tooltip>

  <!-- GitHub -->
  <Tooltip text="soon" position="top" mobileClickable={true}>
    <button
      type="button"
      class="provider-btn"
      data-provider="github"
      title="Coming soon"
      aria-label="GitHub sign in coming soon"
      disabled
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="provider-icon provider-icon-color"
      >
        <path
          fill="#181717"
          d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
        ></path>
      </svg>
      <span class="provider-label hidden md:block">GitHub</span>
    </button>
  </Tooltip>
</div>

<style>
  .auth-providers {
    width: 100%;
  }

  .provider-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem;
    min-width: 4.5rem;
    width: 4.5rem;
    border: 2px solid transparent;
    border-radius: 1rem;
    background: transparent;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .provider-btn::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 1rem;
    padding: 2px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .provider-btn:hover::before,
  .provider-btn:focus::before {
    opacity: 1;
  }

  .provider-btn:hover:not(:disabled),
  .provider-btn:focus:not(:disabled) {
    transform: translateY(-2px);
    border-color: rgba(59, 130, 246, 0.2);
    background: rgba(59, 130, 246, 0.05);
  }

  .provider-btn:disabled {
    cursor: not-allowed;
    opacity: 0.75;
  }

  .provider-icon {
    width: 1.75rem;
    height: 1.75rem;
    flex-shrink: 0;
    /* filter: grayscale(100%) opacity(0.6);
    transition: filter 0.3s cubic-bezier(0.4, 0, 0.2, 1); */
  }

  .provider-btn:hover:not(:disabled) .provider-icon,
  .provider-btn:focus:not(:disabled) .provider-icon {
    filter: grayscale(0%) opacity(1);
  }

  .provider-btn:disabled .provider-icon {
    filter: grayscale(100%) opacity(0.6);
  }

  /* For monochrome icons (phone, email) - show color by default like Google */
  .provider-btn[data-provider="phone"] .provider-icon,
  .provider-btn[data-provider="email"] .provider-icon {
    color: #4b5563;
    filter: grayscale(0%) opacity(0.6);
  }

  .provider-btn[data-provider="phone"]:hover:not(:disabled) .provider-icon,
  .provider-btn[data-provider="phone"]:focus:not(:disabled) .provider-icon {
    color: #3b82f6;
  }

  .provider-btn[data-provider="email"]:hover:not(:disabled) .provider-icon,
  .provider-btn[data-provider="email"]:focus:not(:disabled) .provider-icon {
    color: #8b5cf6;
  }

  /* Dark mode for GitHub icon */
  :global(.dark) .provider-btn[data-provider="github"] .provider-icon path {
    fill: #ffffff;
  }

  :global(.dark) .provider-btn[data-provider="github"]:hover .provider-icon path,
  :global(.dark) .provider-btn[data-provider="github"]:focus .provider-icon path {
    fill: #ffffff;
  }

  .provider-label {
    font-size: 0.7rem;
    font-weight: 500;
    color: rgb(107, 114, 128);
    transition: color 0.3s;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .provider-btn:hover:not(:disabled) .provider-label,
  .provider-btn:focus:not(:disabled) .provider-label {
    color: rgb(59, 130, 246);
  }

  .provider-btn:disabled .provider-label {
    opacity: 0.5;
  }

  :global(.dark) .provider-label {
    color: rgb(156, 163, 175);
  }

  :global(.dark) .provider-btn:hover:not(:disabled) .provider-label,
  :global(.dark) .provider-btn:focus:not(:disabled) .provider-label {
    color: rgb(147, 197, 253);
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .provider-btn {
      min-width: 3.75rem;
      width: 3.75rem;
      padding: 0.625rem;
      gap: 0.25rem;
    }

    .provider-icon {
      width: 1.375rem;
      height: 1.375rem;
    }

    .provider-label {
      font-size: 0.625rem;
    }
  }
</style>

<script>
  // Handle provider button clicks
  document.addEventListener("DOMContentLoaded", () => {
    const providerButtons = document.querySelectorAll(".provider-btn");

    providerButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const target = e.currentTarget as HTMLButtonElement;

        // Don't handle clicks on disabled buttons
        if (target.disabled) {
          return;
        }

        const provider = target.dataset.provider;
        console.log(`üîê Auth provider clicked: ${provider}`);

        // Handle specific providers
        switch (provider) {
          case "phone":
            window.location.href = "/auth/otp-login";
            break;
          case "email":
            window.location.href = "/auth/otp-login";
            break;
          case "google": {
            // Trigger Google OAuth: use global if set (login/register page), else dispatch event
            const handleGoogle = (window as any).handleGoogleSignup;
            if (typeof handleGoogle === "function") {
              handleGoogle();
            } else {
              document.dispatchEvent(new CustomEvent("auth-google-request"));
            }
            break;
          }
          case "facebook":
          case "slack":
          case "github":
            // These are disabled, so this shouldn't be reached
            console.log(`${provider} auth coming soon`);
            break;
        }
      });
    });
  });
</script>
