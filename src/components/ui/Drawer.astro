---
/**
 * Drawer - Reusable off-canvas panel using native Popover API.
 * Trigger: popovertarget="{id}" popovertargetaction="toggle" (or "show")
 * Close: CloseButton with popoverCloseTarget="{id}" or button with popovertarget="{id}" popovertargetaction="hide"
 * Drawer should be outside overflow-hidden containers for proper display.
 */
interface Props {
  id: string;
  title?: string;
  /** Flowbite placement: left | right | top | bottom */
  placement?: "left" | "right" | "top" | "bottom";
  /** Width: sm (w-80) | md (w-96) | lg (w-[28rem]) */
  size?: "sm" | "md" | "lg";
}

const { id, title = "", placement = "left", size = "md" } = Astro.props;

const sizeClasses: Record<string, string> = {
  sm: "w-80",
  md: "w-96",
  lg: "w-[28rem]",
};

const placementClasses: Record<string, string> = {
  left: "left-0 top-0",
  right: "right-0 top-0",
  top: "left-0 right-0 top-0",
  bottom: "left-0 right-0 bottom-0",
};

const zIndex = 1500;
import CloseButton from "../ui/CloseButton.astro";
---

<div
  id={id}
  popover="auto"
  data-placement={placement}
  class={`drawer-popover color-background fixed flex min-h-0 min-w-0 flex-col overflow-x-hidden overflow-y-hidden p-4 ${sizeClasses[size]} ${placementClasses[placement]}`}
  tabindex="-1"
  aria-labelledby={`${id}-label`}
  style={`z-index: ${zIndex}; min-height: calc(100dvh - 64px); height: calc(100dvh - 64px);`}
  data-dynamic-height="maxHeight"
  data-drawer-top-offset
>
  <div class="border-default relative mb-5 flex shrink-0 items-center border-b pb-4">
    <h5 id={`${id}-label`} class="inline-flex items-center truncate text-body text-lg font-medium">
      {title}
    </h5>
    <CloseButton popoverCloseTarget={id} tooltipText="Close drawer" />
  </div>
  <div class="flex min-h-0 flex-1 flex-col overflow-hidden">
    <slot />
  </div>
</div>

<style>
  .drawer-popover[popover]:popover-open {
    animation: drawer-open 0.3s ease-out;
  }
  .drawer-popover[data-placement="right"][popover]:popover-open {
    animation: drawer-slide-right 0.3s ease-out;
  }
  .drawer-popover[data-placement="left"][popover]:popover-open {
    animation: drawer-slide-left 0.3s ease-out;
  }
  .drawer-popover[data-placement="top"][popover]:popover-open {
    animation: drawer-slide-top 0.3s ease-out;
  }
  .drawer-popover[data-placement="bottom"][popover]:popover-open {
    animation: drawer-slide-bottom 0.3s ease-out;
  }
  @keyframes drawer-slide-right {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
  }
  @keyframes drawer-slide-left {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
  }
  @keyframes drawer-slide-top {
    from { transform: translateY(-100%); }
    to { transform: translateY(0); }
  }
  @keyframes drawer-slide-bottom {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  @keyframes drawer-open {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>
