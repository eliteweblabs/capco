---
/**
 * Account dropdown panel for the header avatar (AuthIcon).
 * Flowbite: trigger uses data-dropdown-toggle="account-dropdown"; this panel has id="account-dropdown".
 * Navbar.astro attaches the logout handler to #logout-btn.
 */
interface Props {
  currentUser: any;
  projects: any[];
  globalIconButtonClasses: string;
  id: string;
  title?: string;
}

import SimpleIcon from "../common/SimpleIcon.astro";
import CloseButton from "../ui/CloseButton.astro";
import AssignedProjects from "../common/AssignedProjects.astro";
const { id, title = "" } = Astro.props;
---

<!-- Account dropdown: Flowbite data-dropdown-toggle="account-dropdown" on AuthIcon trigger -->
<div
  id={`${id}-dropdown`}
  class="z-100 hidden w-full max-w-md rounded-b-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-900"
  data-popper-placement="bottom"
  aria-labelledby={`${id}-dropdown`}
  data-dropdown-trigger="click"
  data-dropdown-toggle={`${id}-dropdown`}
>
  <div class="flex max-h-[85vh] flex-col overflow-hidden">
    <div class="relative flex min-h-0 flex-1 flex-col">
      <div
        class="flex shrink-0 items-center justify-between border-b border-gray-200 p-3 dark:border-gray-700"
      >
        <slot name="title">
          {
            title && (
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white" set:html={title} />
            )
          }
        </slot>
        <CloseButton data-dismiss-target={`#${id}-dropdown`} tooltipText="Close" />
      </div>
      <slot />
    </div>
  </div>
</div>

<script is:inline>
  // Flowbite adds opacity/transition classes when closing; when reopening, only 'hidden' is
  // removed so the panel can stay invisible. Remove those classes on trigger click so dropdowns
  // (account, notifications) reopen correctly after being closed.
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("[id$='-dropdown']").forEach(function (panel) {
      var panelId = panel.id;
      if (!panelId) return;
      document
        .querySelectorAll("[data-dropdown-toggle='" + panelId + "']")
        .forEach(function (trigger) {
          trigger.addEventListener("click", function () {
            setTimeout(function () {
              if (panel && !panel.classList.contains("hidden")) {
                panel.classList.remove(
                  "opacity-0",
                  "transition-opacity",
                  "duration-300",
                  "ease-out"
                );
              }
            }, 10);
          });
        });
    });
  });
</script>
