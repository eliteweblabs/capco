---
interface Props {
  size?: "sm" | "md" | "lg";
  borderColor?: "primary" | "secondary" | "success" | "warning" | "danger" | "info";
  color?: "primary" | "secondary" | "success" | "warning" | "danger" | "info"; // Alias for borderColor
  loadingText?: string;
  className?: string;
  id?: string;
  typewriter?: boolean;
  message?: string;
}

const {
  size: sizeProp = "md",
  borderColor: borderColorProp,
  color,
  loadingText = "loading",
  className = "",
  id,
  typewriter = true,
  message = "loading",
} = Astro.props;

// Plain text for typewriter (strip HTML; dots become "...")
const typewriterText =
  typeof loadingText === "string"
    ? loadingText.replace(/<[^>]+>/g, "").trim() || "loading"
    : "loading";

// Normalize size - ensure it's a valid key
// Note: Tailwind only has border-2, border-4, and border-8 (no border-6)
const sizeClasses = {
  sm: "h-4 w-4 border-2",
  md: "h-6 w-6 border-4",
  lg: "h-12 w-12 border-8",
};

// Validate and normalize size - explicitly check against valid values
type SizeKey = keyof typeof sizeClasses;
// Normalize the prop to a string and check directly
const sizePropStr = sizeProp ? String(sizeProp).trim() : "";
// Check if it's one of the valid sizes
let size: SizeKey = "md"; // default
if (sizePropStr === "sm" || sizePropStr === "md" || sizePropStr === "lg") {
  size = sizePropStr as SizeKey;
}

// Normalize borderColor - use color prop as fallback
const borderColor = borderColorProp || color || "primary";

const borderColorClasses = {
  primary: "border-gray-200 border-t-primary-500",
  secondary: "border-gray-200 border-t-secondary-500",
  success: "border-gray-200 border-t-success-500",
  warning: "border-gray-200 border-t-warning-500",
  danger: "border-gray-200 border-t-danger-500",
  info: "border-gray-200 border-t-info-500",
};

// Get classes - size is guaranteed to be a valid key
const sizeClass = sizeClasses[size];
const borderColorClass =
  borderColorClasses[borderColor as keyof typeof borderColorClasses] || borderColorClasses.primary;
---

<div {id} class={`flex flex-col items-center space-y-4 ${className}`}>
  <!-- Spinning loader -->
  <div class="relative">
    <div class={`animate-spin rounded-full ${sizeClass} ${borderColorClass}`}></div>
  </div>

  <!-- Loading text with typewriter effect -->
  <p
    class="loading-spinner-text text-sm text-gray-600 dark:text-gray-400"
    data-text={typewriterText}
    data-loading-typewriter
  >
    <span>{loadingText}</span><span class="hop-1">.</span><span class="hop-2">.</span><span
      class="hop-3">.</span
    >
  </p>
</div>

<style>
  .loading-spinner-text .typewriter-text {
    display: inline-block;
    min-height: 1.25rem;
  }
  .loading-spinner-text .typewriter-text:not(.typewriter-complete)::after {
    animation: loading-spinner-cursor 0.8s step-end infinite;
    margin-left: 1px;
    content: "|";
  }
  @keyframes loading-spinner-cursor {
    50% {
      opacity: 0;
    }
  }
</style>
