---
/**
 * CMS Preloader Component
 * Animated zoom-in preloader using the library/CMS icon
 * Can be used as a page loader or for loading states
 */

interface Props {
  id?: string;
  showByDefault?: boolean; // Whether to show on page load
  zIndex?: string; // z-index class (e.g., "z-50")
}

const { id = "cms-preloader", showByDefault = false, zIndex = "z-50" } = Astro.props;
---

<div
  {id}
  class={`fixed inset-0 ${zIndex} flex items-center justify-center bg-white dark:bg-gray-900 transition-opacity duration-500 ${showByDefault ? "opacity-100" : "opacity-0 pointer-events-none"}`}
  aria-hidden="true"
>
  <!-- Icon Mask with Zoom Animation -->
  <div class="relative flex h-32 w-32 items-center justify-center">
    <!-- Animated Library/CMS Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="512"
      height="512"
      version="1.1"
      viewBox="0 0 512 512"
    >
      <defs>
        <style>
          .st0 {
            fill: none;
            stroke: #000;
            stroke-width: 40;
            stroke-miterlimit: 10;
            stroke-dasharray: 1;
            stroke-dashoffset: 1;
            animation: draw 3s ease-out infinite alternate;
          }

          @keyframes draw {
            to {
              stroke-dashoffset: 0;
            }
          }
        </style>
      </defs>

      <g>
        <path
          class="st0"
          pathLength="1"
          d="M174,197.7h129s40,.3,40,37.3-35,35-35,35h-134v62.2l-.3-61.9h122.8l82,113.5,49-29.3v-200.8L254.9,53.6l-172.7,100,1,201.1,171.7,100.5,78-44.6"
        ></path>
      </g>
    </svg>

    <!-- Pulsing Circle Background -->
    <div class="cms-pulse-ring"></div>
  </div>
</div>

<style>
  /* Zoom-in Animation for Icon */
  .cms-icon-animated {
    transform-origin: center;
    animation: cms-zoom-pulse 1.5s ease-in-out infinite;
  }

  @keyframes cms-zoom-pulse {
    0%,
    100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.15);
      opacity: 0.8;
    }
  }

  /* Pulsing Ring Effect */
  .cms-pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.3;
    animation: cms-ring-pulse 1.5s ease-out infinite;
    border: 3px solid currentColor;
    border-radius: 12px;
    width: 100%;
    height: 100%;
    color: var(--color-primary-600);
  }

  @media (prefers-color-scheme: dark) {
    .cms-pulse-ring {
      color: var(--color-primary-400);
    }
  }

  @keyframes cms-ring-pulse {
    0% {
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0.6;
    }
    100% {
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0;
    }
  }

  /* Alternative: Mask-based zoom effect (uncomment to use) */
  /*
  .cms-preloader-mask {
    -webkit-mask: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 19.5A2.5 2.5 0 0 1 6.5 17H20'/%3E%3Cpath d='M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z'/%3E%3C/svg%3E") center/contain no-repeat;
    mask: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 19.5A2.5 2.5 0 0 1 6.5 17H20'/%3E%3Cpath d='M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z'/%3E%3C/svg%3E") center/contain no-repeat;
    width: 128px;
    height: 128px;
    background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-400));
    animation: cms-mask-zoom 1.5s ease-in-out infinite;
  }

  @keyframes cms-mask-zoom {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.3);
    }
  }
  */
</style>

<script define:vars={{ id }}>
  // Client-side utilities for showing/hiding the preloader
  const preloader = document.getElementById(id);

  if (preloader) {
    // Global functions to control preloader
    window.cmsPreloader = {
      show: () => {
        preloader.classList.remove("opacity-0", "pointer-events-none");
        preloader.classList.add("opacity-100");
      },
      hide: () => {
        preloader.classList.remove("opacity-100");
        preloader.classList.add("opacity-0", "pointer-events-none");
      },
      toggle: () => {
        if (preloader.classList.contains("opacity-0")) {
          window.cmsPreloader.show();
        } else {
          window.cmsPreloader.hide();
        }
      },
    };
  }
</script>
