---
/**
 * CMS Preloader Component
 * Animated zoom-in preloader using the library/CMS icon
 * Can be used as a page loader or for loading states
 */

interface Props {
  id?: string;
  showByDefault?: boolean; // Whether to show on page load
  zIndex?: string; // z-index class (e.g., "z-50")
  globalCompanyName: string;
}

import SimpleIcon from "../common/SimpleIcon.astro";
const {
  id = "cms-preloader",
  showByDefault = false,
  zIndex = "z-[50000]",
  globalCompanyName,
} = Astro.props;

import PixelGrid from "./PixelGrid.astro";
---

<!-- <PixelGrid id="pixel-grid" /> -->
<div
  {id}
  class={`fixed inset-0 ${zIndex} flex items-center justify-center bg-gray-50 dark:bg-gray-950 transition-opacity duration-500 ${showByDefault ? "opacity-100" : "opacity-0 pointer-events-none"}`}
  aria-hidden="true"
>
  <!-- Icon Mask with Zoom Animation -->
  <div class="relative flex h-32 w-32 items-center justify-center">
    <!-- Animated Library/CMS Icon -->
    <!-- get animated icon from simple-icons -->
    <SimpleIcon name={globalCompanyName} size="lg" />
  </div>
</div>
{/* Preloader logic is in App.astro head (inline) so it runs early â€” see window.cmsPreloader */}

<!-- CMS Preloader: inline in head so it runs early; hides 2s after DOMContentLoaded -->
<script is:inline>
  (function () {
    var DISPLAY_MS = 250;
    function init() {
      var preloader = document.getElementById("cms-preloader");
      if (preloader) {
        window.cmsPreloader = {
          show: function () {
            preloader.classList.remove("opacity-0", "pointer-events-none");
            preloader.classList.add("opacity-100");
          },
          hide: function () {
            preloader.classList.remove("opacity-100");
            preloader.classList.add("opacity-0", "pointer-events-none");
          },
          toggle: function () {
            if (preloader.classList.contains("opacity-0")) {
              window.cmsPreloader.show();
            } else {
              window.cmsPreloader.hide();
            }
          },
        };
        setTimeout(function () {
          window.cmsPreloader.hide();
          window.dispatchEvent(new Event("cms-preloader-hidden"));
        }, DISPLAY_MS);
      }
    }
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();
</script>
