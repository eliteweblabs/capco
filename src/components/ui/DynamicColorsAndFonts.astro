---
/**
 * Client-side: load Google Fonts and apply palette + font-family CSS variables.
 * Palette is computed server-side so no import is needed in the inline script.
 */
import { generateColorPalette } from "@/lib/color-utils";

interface Props {
  primaryColor?: string;
  secondaryColor?: string;
  fontFamily?: string;
  secondaryFontFamily?: string;
}

const {
  primaryColor = "#825BDD",
  secondaryColor = "#0ea5e9",
  fontFamily = "Outfit Variable",
  secondaryFontFamily = "sans-serif",
} = Astro.props;

// Compute palettes server-side — passed as plain objects via define:vars
const primaryPaletteVars = generateColorPalette(primaryColor);
const secondaryPaletteVars = generateColorPalette(secondaryColor);
---

<script
  define:vars={{
    primaryPaletteVars,
    secondaryPaletteVars,
    fontFamily,
    secondaryFontFamily,
  }}
>
  // define:vars is implicitly is:inline — no import allowed here
  if (typeof window !== "undefined" && window["__jsOrderLog"]) window["__jsOrderLog"]("App dynamic colors");
  const font = fontFamily;
  const secondaryFont = secondaryFontFamily;
  const fontConfigs = {
    "Outfit Variable": null,
    Roboto: "https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap",
    "Open Sans": "https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap",
    Lato: "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",
    Montserrat: "https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap",
    Poppins: "https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap",
    Inter: "https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap",
    Raleway: "https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap",
    "Source Sans Pro": "https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap",
    Nunito: "https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap",
    "Playfair Display": "https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap",
    Merriweather: "https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap",
    Oswald: "https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600;700&display=swap",
    Lora: "https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap",
    "PT Sans": "https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap",
    Ubuntu: "https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;700&display=swap",
    "Noto Sans": "https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&display=swap",
    "Work Sans": "https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;600;700&display=swap",
    "Crimson Text": "https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;700&display=swap",
    "Fira Sans": "https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;600;700&display=swap",
    "Dancing Script": "https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap",
    "Bebas Neue": "https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap",
    Comfortaa: "https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;600;700&display=swap",
    Quicksand: "https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;600;700&display=swap",
    Rubik: "https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;700&display=swap",
    "Josefin Sans": "https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600;700&display=swap",
    "Libre Baskerville": "https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap",
    Cabin: "https://fonts.googleapis.com/css2?family=Cabin:wght@400;600;700&display=swap",
    Dosis: "https://fonts.googleapis.com/css2?family=Dosis:wght@300;400;600;700&display=swap",
    Arvo: "https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&display=swap",
    "Titillium Web": "https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap",
    Mukta: "https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;600;700&display=swap",
    Karla: "https://fonts.googleapis.com/css2?family=Karla:wght@300;400;600;700&display=swap",
    Barlow: "https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;600;700&display=swap",
    "DM Sans": "https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap",
    Manrope: "https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700&display=swap",
    "Space Grotesk": "https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap",
    "Plus Jakarta Sans": "https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap",
  };
  function loadFont(fontName) {
    const url = fontConfigs[fontName];
    if (!url) return;
    if (document.querySelector(`link[href="${url}"]`)) return;
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = url;
    link.crossOrigin = "anonymous";
    document.head.appendChild(link);
  }
  loadFont(font);
  loadFont(secondaryFont);
  const root = document.documentElement;
  Object.entries(primaryPaletteVars).forEach(([shade, color]) => {
    if (shade !== "DEFAULT" && !Number.isNaN(Number(shade))) {
      root.style.setProperty(`--color-primary-${shade}`, color);
    }
  });
  Object.entries(secondaryPaletteVars).forEach(([shade, color]) => {
    if (shade !== "DEFAULT" && !Number.isNaN(Number(shade))) {
      root.style.setProperty(`--color-secondary-${shade}`, color);
    }
  });
  root.style.setProperty("--font-family", font);
  root.style.setProperty("--font-family-secondary", secondaryFont);
</script>
