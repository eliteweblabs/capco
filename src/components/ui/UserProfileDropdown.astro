---
/**
 * Account dropdown panel for the header avatar (AuthIcon).
 * Flowbite: trigger uses data-dropdown-toggle="account-dropdown"; this panel has id="account-dropdown".
 * Navbar.astro attaches the logout handler to #logout-btn.
 */
interface Props {
  currentUser: any;
  projects: any[];
  globalIconButtonClasses: string;
}

const { currentUser, projects, globalIconButtonClasses } = Astro.props;
if (!currentUser) {
  return null;
}

const currentRole = currentUser?.profile?.role;
import SimpleIcon from "../common/SimpleIcon.astro";
import CloseButton from "../ui/CloseButton.astro";
import AssignedProjects from "../common/AssignedProjects.astro";
import Dropdown from "./Dropdown.astro";
---

<!-- Account dropdown: Flowbite data-dropdown-toggle="account-dropdown" on AuthIcon trigger -->
<Dropdown
  id="account"
  {currentUser}
  {projects}
  {globalIconButtonClasses}
  title={` <a
      class="align-center flex text-sm hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg"
      href="/profile"
    >
      <SimpleIcon name="logo" size="lg" class="m-0 sm:mr-2 w-8" />
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
        {currentUser?.profile?.companyName || "Add Company Name"} /
        {currentUser?.profile?.firstName}
        {currentUser?.profile?.lastName}
        <!-- <br />
              <span class="text-xs text-gray-500 whitespace-nowrap">
                {currentUser?.profile?.email} / edit
              </span> -->
      </h3>
    </a>`}
>
  <div class="p-3 overflow-y-auto flex-1 min-h-0">
    <div
      class="align-center flex items-center justify-between rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
    >
      <ul class="flex flex-col gap-2 text-sm font-medium text-gray-900 dark:text-white">
        <li>
          <a href="/profile" title="Profile" class={globalIconButtonClasses}>
            <SimpleIcon name="user-edit" size="md" class="text-black dark:text-white mr-2" />
            Profile
          </a>
        </li>
        <li>
          <a href="/project/dashboard" title="Dashboard" class={globalIconButtonClasses}>
            <SimpleIcon name="dashboard" size="md" class="text-black dark:text-white mr-2" />
            Dashboard
          </a>
        </li>

        {/* Assigned Projects */}
        {
          currentRole !== "Client" && (
            <AssignedProjects currentUser={currentUser} projects={projects} />
          )
        }
      </ul>

      {/* new section for sign out */}
      <ul
        class="flex flex-col gap-2 text-sm font-medium text-gray-900 dark:text-white border-t color-border"
      >
        <li>
          <a id="logout-btn" href="#" title="logout" class={globalIconButtonClasses}>
            <SimpleIcon name="log-out" size="md" class="text-black dark:text-white mr-2" />
            Sign Out
          </a>
        </li>
      </ul>

      {/* Page size toggle: larger elements for mobile/accessibility */}
      <ul
        class="flex flex-col gap-2 text-sm font-medium text-gray-900 dark:text-white border-t color-border"
      >
        <li>
          <button
            type="button"
            id="page-size-toggle"
            title="Toggle larger page elements (better on mobile)"
            class={`w-full text-left ${globalIconButtonClasses}`}
            aria-pressed="false"
          >
            <SimpleIcon name="zoom-in" size="md" class="text-black dark:text-white mr-2" />
            <span id="page-size-toggle-label">Larger page elements</span>
          </button>
        </li>
      </ul>
    </div>
  </div>
</Dropdown>
<!-- 
<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof window.initPageSizeToggle === "function") window.initPageSizeToggle();

    var panel = document.getElementById("account-dropdown");
    document.querySelectorAll('[data-dropdown-toggle="account-dropdown"]').forEach(function (el) {
      el.addEventListener("click", function () {
        setTimeout(function () {
          if (panel && !panel.classList.contains("hidden")) {
            panel.classList.remove("opacity-0", "transition-opacity", "duration-300", "ease-out");
          }
        }, 10);
      });
    });
  });
</script> -->
