---
import Tooltip from "../common/Tooltip.astro";
import SimpleIcon from "../common/SimpleIcon.astro";
---

<button
  id="theme-toggle"
  type="button"
  class="inline-flex items-center rounded-full p-2 text-center text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-50 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white dark:focus:ring-gray-600"
>
  <Tooltip text="Toggle dark mode" position="bottom">
    <SimpleIcon name="moon" size="md" id="theme-toggle-dark-icon" class="hidden" />
  </Tooltip>
  <Tooltip text="Toggle light mode" position="bottom">
    <SimpleIcon name="sun" size="md" id="theme-toggle-light-icon" class="hidden" />
  </Tooltip>
  <span class="sr-only">Toggle dark mode</span>
</button>

<script>
  // Theme toggle functionality
  function initThemeToggle() {
    const themeToggle = document.getElementById("theme-toggle");
    const darkIcon = document.getElementById("theme-toggle-dark-icon");
    const lightIcon = document.getElementById("theme-toggle-light-icon");

    if (!themeToggle || !darkIcon || !lightIcon) return;

    // Set initial state (dark mode is already initialized in App.astro)
    const isDark = document.documentElement.classList.contains("dark");

    isDark ? document.documentElement.classList.add("zD1iTsv7EQco3GO_szee") : "";

    // Remove hidden class from the appropriate icon
    if (isDark) {
      darkIcon.classList.add("hidden");
      lightIcon.classList.remove("hidden");
    } else {
      darkIcon.classList.remove("hidden");
      lightIcon.classList.add("hidden");
    }

    themeToggle.addEventListener("click", function () {
      const isDark = document.documentElement.classList.contains("dark");
      const newTheme = isDark ? "light" : "dark";

      if (isDark) {
        // Switch to light
        document.documentElement.classList.remove("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "light");
        darkIcon.classList.remove("hidden");
        lightIcon.classList.add("hidden");
      } else {
        // Switch to dark
        document.documentElement.classList.add("dark", "zD1iTsv7EQco3GO_szee");
        localStorage.setItem("color-theme", "dark");
        darkIcon.classList.add("hidden");
        lightIcon.classList.remove("hidden");
      }

      // Update cookie
      document.cookie = `theme=${newTheme}; path=/; max-age=31536000; SameSite=Lax`;
      console.log("[THEME-TOGGLE] Theme changed to:", newTheme);
      console.log("[THEME-TOGGLE] Cookie set to:", newTheme);

      // Update window.currentTheme
      if (window.currentTheme !== undefined) {
        window.currentTheme = newTheme;
      }

      // Sync theme-synced elements
      if (window.updateThemeSync) {
        window.updateThemeSync();
      }
    });
  }

  document.addEventListener("DOMContentLoaded", initThemeToggle);
</script>
