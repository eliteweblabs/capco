---
import Button from "../common/Button.astro";
import Tooltip from "../common/TooltipFloating.astro";
---

<style>
  :global(.mask-center::before) {
    mask: none;
    -webkit-mask: none;
  }
  .smoke-button {
    position: relative;
    display: inline-block;
  }

  .smoke-button::before,
  .smoke-button::after {
    content: "";
    position: absolute;
    top: 0;
    left: 50%;
    width: 4px;
    height: 4px;
    background: radial-gradient(
      circle,
      rgba(200, 200, 200, 0.8) 0%,
      rgba(150, 150, 150, 0.4) 40%,
      transparent 70%
    );
    border-radius: 50%;
    opacity: 0;
    animation: smoke 3s infinite ease-out;
    pointer-events: none;
    z-index: -1;
  }

  .smoke-button::after {
    animation-delay: 1.5s;
    left: 45%;
  }

  @keyframes smoke {
    0% {
      opacity: 0;
      transform: translate(-50%, 0) scale(1);
    }
    10% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
      transform: translate(calc(-50% + 15px), -80px) scale(8);
    }
    100% {
      opacity: 0;
      transform: translate(calc(-50% + 25px), -120px) scale(12);
    }
  }

  /* Multiple smoke particles */
  .smoke-particle {
    position: absolute;
    top: 1.5rem;
    left: 50%;
    width: 6px;
    height: 6px;
    background: radial-gradient(
      circle,
      rgba(220, 220, 220, 0.7) 0%,
      rgba(180, 180, 180, 0.3) 40%,
      transparent 70%
    );
    border-radius: 50%;
    opacity: 0;
    pointer-events: none;
    z-index: -1;
  }

  .smoke-particle:nth-child(1) {
    animation: smoke-particle 4s infinite ease-out;
    animation-delay: 1s;
  }

  .smoke-particle:nth-child(2) {
    animation: smoke-particle 4.5s infinite ease-out;
    animation-delay: 1.8s;
    left: 55%;
  }

  .smoke-particle:nth-child(3) {
    animation: smoke-particle 3.5s infinite ease-out;
    animation-delay: 2.6s;
    left: 45%;
  }

  .smoke-particle:nth-child(4) {
    animation: smoke-particle 4.2s infinite ease-out;
    animation-delay: 3.4s;
    left: 52%;
  }

  .smoke-particle:nth-child(5) {
    animation: smoke-particle 3.8s infinite ease-out;
    animation-delay: 4.2s;
    left: 48%;
  }

  @keyframes smoke-particle {
    0% {
      opacity: 0;
      transform: translate(-50%, 0) scale(1) rotate(0deg);
    }
    15% {
      opacity: 0.9;
    }
    60% {
      opacity: 0.5;
      transform: translate(calc(-50% + 20px), -100px) scale(10) rotate(180deg);
    }
    100% {
      opacity: 0;
      transform: translate(calc(-50% + 35px), -150px) scale(15) rotate(360deg);
    }
  }

  /* Dark mode adjustments */
  :global(.dark) .smoke-button::before,
  :global(.dark) .smoke-button::after {
    background: radial-gradient(
      circle,
      rgba(100, 100, 100, 0.6) 0%,
      rgba(70, 70, 70, 0.3) 40%,
      transparent 70%
    );
  }

  :global(.dark) .smoke-particle {
    background: radial-gradient(
      circle,
      rgba(120, 120, 120, 0.5) 0%,
      rgba(90, 90, 90, 0.2) 40%,
      transparent 70%
    );
  }

  .bg-radial-gradient::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    background: radial-gradient(
      ellipse 50% 80% at 30% 40%,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(255, 255, 255, 0.8) 20%,
      rgba(255, 255, 255, 0.6) 40%,
      rgba(255, 255, 255, 0.3) 60%,
      rgba(255, 255, 255, 0.1) 80%,
      transparent 100%
    );
  }

  /* Dark mode version - use :global() to match the HTML dark class */
  :global(.dark) .bg-radial-gradient::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    background: radial-gradient(
      ellipse 50% 80% at 30% 40%,
      rgba(0, 0, 0, 0.95) 0%,
      rgba(0, 0, 0, 0.8) 20%,
      rgba(0, 0, 0, 0.6) 40%,
      rgba(0, 0, 0, 0.3) 60%,
      rgba(0, 0, 0, 0.1) 80%,
      transparent 100%
    );
  }
</style>

<div
  class="flex w-full items-center justify-between max-w-screen-xl mx-auto h-[calc(100dvh-10rem)] md:h-[calc(100dvh-11rem)] lg:h-[calc(100dvh-12rem)]"
  style="overscroll-behavior-y: contain; touch-action: pan-x;"
>
  <div class="text-left mb-0 relative inline-block bg-radial-gradient">
    <a
      href="project/dashboard"
      class="inline-flex items-center justify-between px-1 py-1 pr-4 mb-6 text-sm text-gray-700 rounded-full dark:bg-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700"
      role="alert"
    >
      <span
        class="text-white rounded-full px-4 mr-2 bg-primary-600 hover:bg-primary-600 dark:bg-primary-500 dark:hover:bg-primary-600"
        >New</span
      >
      <span class="text-sm font-medium">Streamlined Web App Workflow</span>
      <svg
        class="w-5 h-5 ml-2"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
          clip-rule="evenodd"></path>
      </svg>
    </a>
    <h1 class="select-none text-5xl md:text-6xl font-bold mb-4">
      <span data-aos="fade-up" data-aos-delay="200">Expert Fire<br /></span>
      <span data-aos="fade-up" data-aos-delay="400">Alarm & Sprinkler<br /></span>
      <span data-aos="fade-up" data-aos-delay="600">Designers</span>
    </h1>
    <p class="max-w-2xl mb-6 text-gray-500 md:mx-0 md:mb-8 md:text-xl dark:text-gray-400">
      <span class="hidden md:block select-none" data-aos="fade-up" data-aos-delay="400"
        >Combined 50+ years of experience in permitting & expediting...<br /><br />
      </span>
      <span class="inline-block" data-aos="fade-up" data-aos-delay="800">
        Submittals delivered in 48 hours <span class="hidden md:inline"
          >with guaranteed approval at a fraction of the cost of traditional firms.<Tooltip
            position="right"
            className="text-red-500"
            text={`After deposit & document submission`}>*</Tooltip
          ></span
        >
      </span>
    </p>

    <div class="smoke-button hidden">
      <span class="smoke-particle"></span>
      <span class="smoke-particle"></span>
      <span class="smoke-particle"></span>
      <span class="smoke-particle"></span>
      <span class="smoke-particle"></span>
      <Button
        variant="outline"
        size="md"
        onclick="window.location.href='/auth/register'"
        class="pulse"
        dataAttributes={{
          "data-aos": "fade-up",
          "data-aos-delay": "1000",
        }}>Get Started</Button
      >
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const emailInput = document.getElementById("quick-register-email");
    const nextBtn = document.getElementById("next-btn");

    if (emailInput && nextBtn) {
      // Email validation function
      function isValidEmail(email: string) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      // Show/hide next button based on email validity
      function toggleNextButton() {
        const email = (emailInput as HTMLInputElement)?.value?.trim();
        if (isValidEmail(email)) {
          nextBtn?.classList.remove("hidden");
        } else {
          nextBtn?.classList.add("hidden");
        }
      }

      // Listen for input changes
      emailInput.addEventListener("input", toggleNextButton);
      emailInput.addEventListener("blur", toggleNextButton);

      // Handle next button click
      nextBtn.addEventListener("click", function () {
        const email = (emailInput as HTMLInputElement)?.value.trim();
        if (isValidEmail(email)) {
          const encodedEmail = encodeURIComponent(email);
          window.location.href = `/auth/register&email=${encodedEmail}`;
        }
      });

      // Handle Enter key on email input
      emailInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter" && !nextBtn.classList.contains("hidden")) {
          nextBtn.click();
        }
      });
    }
  });
</script>
