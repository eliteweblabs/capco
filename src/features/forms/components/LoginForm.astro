---
// Redirect logic moved to login.astro (page level) to avoid ResponseSentError.
// The page runs redirects before LayoutTwoColumn/App render; this component runs
// in a slot after App has started sending the response.
interface Props {
  redirectUrl?: string;
  id?: string;
}

const { redirectUrl = "/project/dashboard", id } = Astro.props;

import ConfigForm from "./ConfigForm.astro";
import { getLoginFormConfig } from "../../../lib/forms/form-config-from-site";

const loginFormConfig = await getLoginFormConfig();

import SimpleIcon from "../../../components/common/SimpleIcon.astro";
---

<div id={id} class="relative flex min-h-[300px] flex-col pb-24">
  <div class="mb-8">
    <ConfigForm config={loginFormConfig} initialData={{ redirect: redirectUrl }} />
  </div>
  <div
    class="absolute bottom-0 left-0 right-0 flex border-t border-gray-200 pt-3 dark:border-gray-700"
  >
    <a
      href="/auth/forgot-password"
      class="flex w-1/2 flex-col items-center justify-center gap-2 rounded-lg py-3 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800"
      title="Forgot password?"
    >
      <SimpleIcon name="key" size="lg" class="text-gray-500 dark:text-gray-400" />
      <span class="text-xs font-medium text-gray-600 dark:text-gray-300">Forgot password?</span>
    </a>
    <a
      href="/auth/register"
      class="flex w-1/2 flex-col items-center justify-center gap-2 rounded-lg py-3 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800"
      title="Need an account? Register"
    >
      <SimpleIcon name="user-plus" size="lg" class="text-gray-500 dark:text-gray-400" />
      <span class="text-xs font-medium text-gray-600 dark:text-gray-300">Register</span>
    </a>
  </div>
</div>

<!-- Script in separate .ts so it bundles as a real chunk (Astro 5 emits empty chunks for .astro inline scripts in prod). -->
<script src="./login-form-client.ts"></script>
