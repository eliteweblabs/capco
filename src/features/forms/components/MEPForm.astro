---
import { getMepFormConfig } from "../../../lib/forms/form-config-from-site";
import { buildFormInitialDataFromUser } from "../../../lib/forms/form-initial-data-from-user";
import ConfigForm from "@/features/forms/components/ConfigForm.astro";

// Session and company data are set in middleware for this route (sessionOptionalRoutes) to avoid top-level await
const user = Astro.locals.user;
const globalCompanyName = (Astro.locals as any).globalCompanyName ?? "Company";
const virtualAssistantName = (Astro.locals as any).virtualAssistantName;
const mepFormConfig = await getMepFormConfig(globalCompanyName, virtualAssistantName);
const initialData = buildFormInitialDataFromUser(user);
---

<ConfigForm config={mepFormConfig} {initialData} />
