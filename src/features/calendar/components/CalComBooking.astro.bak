---
// Cal.com Booking Component
// This component integrates with Cal.com for real appointment booking

interface Props {
  currentUser?: any;
  calLink?: string;
}

const { calLink = "capco/30min", currentUser } = Astro.props;
const calComBaseUrl =
  import.meta.env.PUBLIC_CALCOM_BASE_URL ||
  "https://calcom-web-app-production-0b16.up.railway.app";
const prefillData = currentUser
  ? {
      name: [currentUser?.profile?.firstName, currentUser?.profile?.lastName].filter(Boolean).join(" ") || "",
      email: currentUser?.email || "",
      company: currentUser?.profile?.companyName || "",
    }
  : null;
import LoadingSpinner from "../../../components/ui/LoadingSpinner.astro";
---

<!-- Cal.com Embed Container -->
<div
  id="cal-com-embed"
  class="min-h-[600px]"
  data-cal-link={calLink}
  data-cal-base-url={calComBaseUrl}
  data-prefill={prefillData ? JSON.stringify(prefillData) : ""}>
  <div class="color-background flex h-64 items-center justify-center rounded-lg">
    <LoadingSpinner size="lg" color="primary" className="mx-auto mb-4" />
  </div>
</div>

<script type="module">
  import { initCalComEmbed } from "../cal-com-embed";
  initCalComEmbed();
</script>
