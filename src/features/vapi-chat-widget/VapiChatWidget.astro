---
/**
 * VAPI Chat Widget - Simple Default Setup
 * Clean implementation with default Vapi button
 */

import { globalCompanyData } from "../../pages/api/global/global-company-data";

interface Props {
  assistantId?: string;
  publicKey?: string;
  basic?: boolean;
  primaryColor?: string;
  secondaryColor?: string;
  globalCompanyName?: string;
  theme?: "light" | "dark";
}

// Get company data from database
const companyData = await globalCompanyData();

const {
  assistantId = import.meta.env.PUBLIC_VAPI_ASSISTANT_ID || "",
  publicKey = import.meta.env.PUBLIC_VAPI_KEY || "",
  basic = false,
  primaryColor = Astro.props.primaryColor || companyData.primaryColor || "#000000",
  secondaryColor = Astro.props.secondaryColor || companyData.secondaryColor || "#000000",
  globalCompanyName = Astro.props.globalCompanyName || companyData.globalCompanyName || "",
} = Astro.props;

const themeCookie = Astro.cookies.get("theme");
const theme = themeCookie?.value || "light";
const baseBgColor = theme === "dark" ? "#ffffff" : "#000000";
const fgColor = theme === "dark" ? "#000000" : "#ffffff";
---

{
  basic && publicKey && assistantId && (
    <>
      <vapi-widget
        id="vapi-widget-basic"
        public-key={publicKey}
        assistant-id={assistantId}
        mode="chat"
        base-bg-color=""
        theme={theme}
        accent-color={primaryColor}
        cta-button-color={baseBgColor}
        cta-button-text-color={fgColor}
        border-radius="large"
        size="compact"
        position="bottom-right"
        title="Live"
        start-button-text="Start"
        end-button-text="End Call"
        chat-first-message={`Hi, this is Leah with ${globalCompanyName}. How can I help you today?`}
        chat-placeholder="Type your message..."
        voice-show-transcript="true"
        consent-required="false"
        consent-title="Terms and conditions"
        consent-content="By clicking Agree, and each time I interact with this AI agent, I consent to the recording, storage, and sharing of my communications with third-party service providers, and as otherwise described in our Terms of Service."
        consent-storage-key="vapi_widget_consent"
      />

      <script
        src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js"
        async
        type="text/javascript"
      />
    </>
  )
}
