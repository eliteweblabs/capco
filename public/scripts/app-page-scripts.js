(()=>{var H=Object.defineProperty;var z=(t,o,e)=>o in t?H(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var p=(t,o,e)=>z(t,typeof o!="symbol"?o+"":o,e);typeof window!="undefined"&&window.__jsOrderLog&&window.__jsOrderLog("hold-progress-init");function T(){if(!window.matchMedia("(hover: none)").matches)return;let o="press for 3s";function e(s){var E,L;if(s.getAttribute("data-hold-inited")==="true")return;let a=s.closest("form");if(a&&(a.getAttribute("id")==="login-form"||(a.action||"").includes("signin")))return;s.setAttribute("data-hold-inited","true");let n=parseInt((E=s.getAttribute("data-hold"))!=null?E:"3000",10)||3e3,r=null,d=null,l=0,c=()=>{r&&clearTimeout(r),d&&clearInterval(d),r=null,d=null,s.style.setProperty("--hold-progress","0")},m=s.tagName==="BUTTON"||s.tagName==="A"||s.getAttribute("data-hold-trigger-click")==="true",g=()=>{c(),s.style.setProperty("--hold-progress","1"),m?(s.setAttribute("data-hold-allowed","true"),s.click(),s.removeAttribute("data-hold-allowed")):s.dispatchEvent(new CustomEvent("holdcomplete",{bubbles:!0,detail:{target:s}}))},u=()=>{s.disabled||(l=Date.now(),d=setInterval(()=>{let h=Date.now()-l,f=Math.min(h/n,1);s.style.setProperty("--hold-progress",String(f))},50),r=setTimeout(g,n))};m&&s.addEventListener("click",h=>{if(s.getAttribute("data-hold-allowed")!=="true"){h.preventDefault(),h.stopPropagation();let f=s.closest("form");f&&window.showMultiStepFormValidationErrors&&window.showMultiStepFormValidationErrors(f)}},!0),s.addEventListener("touchstart",u,{passive:!0}),s.addEventListener("touchend",c,{passive:!0}),s.addEventListener("touchcancel",c,{passive:!0});let w=s.querySelector(".hold-button-text");if(w&&a){let h=((L=w.textContent)==null?void 0:L.trim())||"submit",f=()=>{w.textContent=a.checkValidity()?o:h};a.addEventListener("input",f),a.addEventListener("change",f),f()}}document.querySelectorAll("[data-hold]").forEach(e),new MutationObserver(s=>{s.forEach(a=>{a.addedNodes.forEach(n=>{var r,d;n instanceof HTMLElement&&((r=n.hasAttribute)!=null&&r.call(n,"data-hold")&&e(n),(d=n.querySelectorAll)==null||d.call(n,"[data-hold]").forEach(e))})})}).observe(document.body,{childList:!0,subtree:!0})}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T):T());typeof window!="undefined"&&window.__jsOrderLog&&window.__jsOrderLog("scroll-animations");var y=class{constructor(o={}){p(this,"observer",null);p(this,"options");p(this,"initialized",!1);var e,i,s;this.options={threshold:(e=o.threshold)!=null?e:.1,rootMargin:(i=o.rootMargin)!=null?i:"0px 0px -50px 0px",once:(s=o.once)!=null?s:!0}}tagMainContentForAnimation(){let o=document.querySelector("main");if(!o||o.getAttribute("data-animate-main")==="false")return;o.querySelectorAll("p, h1, h2, h3, h4, h5, h6, li, img, blockquote, figcaption, b, i").forEach(s=>{var n;if(s.hasAttribute("data-animate"))return;let a=s;(n=a.classList)!=null&&n.contains("skip")||a.closest(".skip")||(a.dataset.animate="fade-up-subtle")})}init(){if(!this.initialized){if(this.tagMainContentForAnimation(),window.matchMedia("(prefers-reduced-motion: reduce)").matches){this.showAllElements();return}this.createObserver(),this.observeElements(),this.initialized=!0}}createObserver(){this.observer=new IntersectionObserver(o=>{o.forEach(e=>{if(e.isIntersecting){let i=e.target,s=()=>{let a=i.dataset.animateDelay;a?setTimeout(()=>i.classList.add("is-visible"),parseInt(a)):i.classList.add("is-visible")};requestAnimationFrame(()=>{requestAnimationFrame(s)}),this.options.once&&this.observer&&this.observer.unobserve(i)}else this.options.once||e.target.classList.remove("is-visible")})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin})}observeElements(){if(!this.observer)return;document.querySelectorAll("[data-animate]").forEach(i=>{this.observer.observe(i)}),document.querySelectorAll("[data-animate-stagger]").forEach(i=>{this.observer.observe(i)})}showAllElements(){document.querySelectorAll("[data-animate], [data-animate-stagger]").forEach(e=>{e.classList.add("is-visible")})}refresh(){this.tagMainContentForAnimation(),this.observer&&this.observeElements()}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null,this.initialized=!1)}},v=null;function A(t){return v||(v=new y(t)),v.init(),v}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>A()):A());typeof window!="undefined"&&window.__jsOrderLog&&window.__jsOrderLog("lazy-load-images");function M(){if(typeof window=="undefined")return;let t=document.querySelectorAll("img.lazyload");if(t.length)if("IntersectionObserver"in window){let o=new IntersectionObserver((e,i)=>{e.forEach(s=>{if(s.isIntersecting){let a=s.target,n=a.getAttribute("data-src");if(n){a.src=n;let r=a.getAttribute("data-srcset");r&&(a.srcset=r),a.classList.add("lazyloading"),a.onload=()=>{a.classList.remove("lazyload","lazyloading","blur-sm"),a.classList.add("lazyloaded")},a.onerror=()=>{a.classList.remove("lazyload","lazyloading"),a.classList.add("lazyerror")}}i.unobserve(a)}})},{rootMargin:"50px 0px",threshold:.01});t.forEach(e=>o.observe(e))}else t.forEach(o=>{let e=o,i=e.getAttribute("data-src");if(i){e.src=i;let s=e.getAttribute("data-srcset");s&&(e.srcset=s)}})}typeof window!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M());var S={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"};function b(t,o="sm"){let e=(t||"").toLowerCase(),i=S[o]||S.sm;return e.includes("pdf")?`<svg class="${i} text-red-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
    </svg>`:e.includes("image")||e.includes("png")||e.includes("jpg")||e.includes("jpeg")||e.includes("gif")||e.includes("webp")||e.includes("svg")?`<svg class="${i} text-primary-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
    </svg>`:e.includes("word")||e.includes("doc")?`<svg class="${i} text-primary-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
    </svg>`:e.includes("excel")||e.includes("sheet")?`<svg class="${i} text-green-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
    </svg>`:e.includes("powerpoint")||e.includes("presentation")?`<svg class="${i} text-orange-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0  2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
    </svg>`:e.includes("zip")||e.includes("rar")||e.includes("archive")?`<svg class="${i} text-purple-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
      <path d="M9 12h6v2H9zm0 4h6v2H9z"/>
    </svg>`:e.includes("video")||e.includes("mp4")||e.includes("avi")||e.includes("mov")?`<svg class="${i} text-pink-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 15V9l5 3-5 3z"/>
    </svg>`:e.includes("audio")||e.includes("mp3")||e.includes("wav")?`<svg class="${i} text-indigo-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
    </svg>`:`<svg class="${i} text-gray-500" fill="currentColor" viewBox="0 0 24 24">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"/>
  </svg>`}function $(t){return t.title||t.fileName||t.file_name||t.name||(t.filePath||t.file_path||"").split("/").pop()||"File"}typeof window!="undefined"&&window.__jsOrderLog&&window.__jsOrderLog("project-item-handlers");window.updateProjectField=async function(t,o,e){let i=t.getAttribute("data-project-id"),s=t.getAttribute("data-meta");if(!i||!s){console.error("Missing data-project-id or data-meta attributes");return}let a=e?e(o):String(o);t.tagName==="INPUT"||t.tagName==="TEXTAREA"?t.value=a:t.textContent=a,t.setAttribute("data-meta-value",String(o)),t.hasAttribute("data-due-date")&&t.setAttribute("data-due-date",String(o)),t.setAttribute("data-edited","true"),t.classList.add("saving"),t.classList.remove("saved","save-error","fade-out");let n=`fieldTimeout_${i}_${s}`;window[n]&&clearTimeout(window[n]),window[n]=setTimeout(async()=>{console.log(`\u{1F4BE} [SAVE] Saving ${s} for project ${i}`);try{if(!(await fetch("/api/projects/upsert",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:parseInt(i),[s]:o})})).ok)throw new Error(`Failed to update ${s}`);t.classList.remove("saving"),t.classList.add("saved"),setTimeout(()=>{t.classList.add("fade-out"),setTimeout(()=>{t.classList.remove("saved","fade-out"),t.removeAttribute("data-edited")},300)},1e3)}catch(r){console.error(`Error updating ${s}:`,r),t.classList.remove("saving","saved"),t.classList.add("save-error"),setTimeout(()=>{t.classList.remove("save-error"),t.removeAttribute("data-edited")},2e3),typeof window!="undefined"&&window.showNotice&&window.showNotice("error","Update Failed",`Failed to update ${s}. Please try again.`,3e3)}},500)};window.adjustDueDate=async function(t,o){console.log(`\u{1F3AF} [ADJUST] adjustDueDate called: projectId=${t}, hours=${o}`);let e=document.getElementById(`stepper-${t}`);if(!e){console.error(`\u274C [ADJUST] Input not found for project ${t}`);return}let i=e.getAttribute("data-due-date");if(!i||i===""){let l=new Date,c=new Date(l);c.setMinutes(0,0,0),c.getTime()<=l.getTime()&&c.setHours(c.getHours()+1),i=c.toISOString(),console.log(`\u{1F550} [ADJUST] No current date for project ${t}; using next hour: ${i}`)}let s=new Date(i);if(isNaN(s.getTime())){console.error(`\u274C [ADJUST] Invalid date format for project ${t}:`,i);return}s.setHours(s.getHours()+o);let a=s.toISOString(),n=new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});e.value=n,e.setAttribute("data-due-date",a),e.setAttribute("data-meta-value",a),e.classList.add("saving"),e.classList.remove("saved","save-error","fade-out"),e.setAttribute("data-edited","true");let r="dueDate",d=`fieldTimeout_${t}_${r}`;window[d]&&(console.log(`\u23F1\uFE0F  [ADJUST] Clearing existing timeout for ${d}`),clearTimeout(window[d])),console.log(`\u23F1\uFE0F  [ADJUST] Setting new timeout for ${d} (200ms)`),window[d]=setTimeout(async()=>{console.log(`\u{1F4BE} [SAVE] Saving ${r} for project ${t} after debounce`);try{if(!(await fetch("/api/projects/upsert",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.toString(),dueDate:a})})).ok)throw new Error(`Failed to update ${r}`);console.log(`\u2705 [SAVE] Successfully saved ${r} for project ${t}`),e.classList.remove("saving"),e.classList.add("saved"),setTimeout(()=>{e.classList.add("fade-out"),setTimeout(()=>{e.classList.remove("saved","fade-out"),e.removeAttribute("data-edited")},300)},1e3)}catch(l){console.error(`Error updating ${r}:`,l),e.classList.remove("saving","saved"),e.classList.add("save-error"),setTimeout(()=>{e.classList.remove("save-error"),e.removeAttribute("data-edited")},2e3),typeof window!="undefined"&&window.showNotice&&window.showNotice("error","Update Failed",`Failed to update ${r}. Please try again.`,3e3)}},200)};window.updateTimeDisplay=function(){document.querySelectorAll("[data-time-since-update]").forEach(o=>{let e=o.getAttribute("data-updated-at");if(e){let i=new Date,s=new Date(e),a=i.getTime()-s.getTime(),n=Math.floor(a/1e3),r=Math.floor(n/60),d=Math.floor(r/60),l=Math.floor(d/24),c=Math.floor(l/7),m=Math.floor(l/30),g=Math.floor(l/365),u;g>0?u=`${g} year${g>1?"s":""} ago`:m>0?u=`${m} month${m>1?"s":""} ago`:c>0?u=`${c} week${c>1?"s":""} ago`:l>0?u=`${l} day${l>1?"s":""} ago`:d>0?u=`${d} hour${d>1?"s":""} ago`:r>0?u=`${r} minute${r>1?"s":""} ago`:u="Just now",o.textContent=u}})};window.getFileIcon=function(t,o="sm"){return b(t,o)};window.renderFileIcons=function(){console.log("\u{1F4C1} [RENDER-FILE-ICONS] Called");let t=document.querySelectorAll('[id^="project-files-"]');console.log(`\u{1F4C1} [RENDER-FILE-ICONS] Found ${t.length} file containers`),t.forEach(o=>{if(o.getAttribute("data-prerendered")==="true")return;let e=o.getAttribute("data-project-files");if(!e)return;let i=JSON.parse(e);if(console.log(`\u{1F4C1} [RENDER-FILE-ICONS] Container ${o.id} has ${(i==null?void 0:i.length)||0} files`),!i||i.length===0)return;o.innerHTML="";let s=o.getAttribute("data-file-size")||"sm",a=o.getAttribute("data-file-tooltips")!=="false";i.forEach(n=>{let r=document.createElement("div");r.className="cursor-pointer inline-flex";let d=$(n),l=n.fileType||n.file_type||"";a&&(r.title=d),r.innerHTML=b(l,s),o.appendChild(r)})})};window.__timeDisplayInitialized||(window.__timeDisplayInitialized=!0,window.updateTimeDisplay(),setInterval(window.updateTimeDisplay,6e4));window.updateStaffIcon=function(t,o,e,i){var a;console.log(`\u{1F504} [PROJECT-${t}] updateStaffIcon called`,{result:o,assignedToId:e,staffName:i});let s=document.querySelector(`#assign-staff-slot-machine-${t}`);if(!s){console.error(`\u{1F504} [PROJECT-${t}] Staff element not found`);return}if((a=o==null?void 0:o.updatedProject)!=null&&a.assignedToProfile){let n=o.updatedProject.assignedToProfile;console.log(`\u{1F504} [PROJECT-${t}] Updating with profile:`,n);let r=n.companyName||`${n.firstName||""} ${n.lastName||""}`.trim()||n.name||"User",d=r.split(" ").map(c=>c.charAt(0)).join("").toUpperCase().slice(0,2),l=`
        <span class="sr-only">Open user menu</span>
        <div class="w-8 h-8 text-sm rounded-full border-2 border-white shadow-sm bg-gradient-to-br from-primary-500 to-purple-600 flex items-center justify-center text-white font-medium cursor-pointer">
          ${d}
        </div>
    `;s.innerHTML=l,s instanceof HTMLElement&&(s.title=i||r),console.log(`\u{1F504} [PROJECT-${t}] Successfully updated staff icon with initials: ${d}`)}else if(!e||e===""){console.log(`\u{1F504} [PROJECT-${t}] Unassigning staff, showing default icon`);let n=`
      <span class="relative inline-block group w-8 h-8">
        <span class="sr-only">Open user menu</span>
        <svg
          class="inline-block avatar-fallback"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
        >
          <path d="M7.5 6.5C7.5 8.981 9.519 11 12 11s4.5-2.019 4.5-4.5S14.481 2 12 2 7.5 4.019 7.5 6.5zM20 21h1v-1c0-3.859-3.141-7-7-7h-4c-3.86 0-7 3.141-7 7v1h17z" />
        </svg>
      </span>
    `;s.innerHTML=n,s instanceof HTMLElement&&(s.title="Assign to Staff"),console.log(`\u{1F504} [PROJECT-${t}] Successfully updated to default icon`)}};document.addEventListener("change",async t=>{let o=t.target;if(o.getAttribute("data-meta")!=="featured"||!o.hasAttribute("data-project-id"))return;let e=o.getAttribute("data-project-id"),i=o.checked;try{if(!(await fetch("/api/projects/upsert",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:parseInt(e),featured:i})})).ok)throw new Error("Failed to update featured");window.showNotice&&window.showNotice("success",i?"Project featured":"Project unfeatured","",1500)}catch(s){console.error("Error updating featured:",s),o.checked=!i,window.showNotice&&window.showNotice("error","Update Failed","Failed to update featured.",3e3)}});document.addEventListener("DOMContentLoaded",()=>{typeof window.renderFileIcons=="function"&&window.renderFileIcons()});console.log("\u2705 [GLOBAL] Project item handlers loaded");})();
