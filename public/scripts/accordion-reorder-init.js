(()=>{var a="[AccordionReorder]";function T(){let b=!0,m=document.querySelectorAll("[data-accordion-reorder-init]:not([data-accordion-reorder-inited])");return console.log(a,"initAccordionReorder run, initEls:",m.length),m.forEach(d=>{let n=d.getAttribute("data-table-id"),y=d.getAttribute("data-trigger-class")||"accordion-trigger",L=d.getAttribute("data-detail-class")||"accordion-detail",l=d.getAttribute("data-reorder-callback");if(console.log(a,"tableId:",n,"triggerClass:",y,"callback:",l),!n||!l){console.warn(a,"missing tableId or callback, skipping");return}let c=document.getElementById(n+"-tbody");if(!c){console.warn(a,"tbody not found for id:",n+"-tbody");return}let v=window[l];if(typeof v!="function"){console.warn(a,"callback not found on window:",l,"available:",Object.keys(window).filter(e=>e.includes("Reorder")||e.includes("handle"))),b=!1;return}d.setAttribute("data-accordion-reorder-inited","true");let h=y.trim().split(/\s+/).filter(Boolean).join("."),i=()=>Array.from(c.querySelectorAll("tr."+h+"[data-reorder-id]")),E=i();console.log(a,"attaching to",E.length,"rows for table",n);let r=null,o=null,p=-1;E.forEach((e,A)=>{let g=e.nextElementSibling,k=g&&(g.classList.contains(L)||g.hasAttribute("data-slot"));e.addEventListener("dragstart",t=>{console.log(a,"dragstart",n,"row",A,"id:",e.getAttribute("data-reorder-id")),window.refreshManager?.setDragInProgress?.(!0),r=e,o=k?g:null,p=A,e.classList.add("opacity-50","cursor-grabbing"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.getAttribute("data-reorder-id")||""))}),e.addEventListener("dragend",()=>{window.refreshManager?.setDragInProgress?.(!1),r&&r.classList.remove("opacity-50","cursor-grabbing"),i().forEach(t=>t.classList.remove("border-t-2","border-primary-500")),r=null,o=null}),e.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),r&&e!==r&&e.classList.add("border-t-2","border-primary-500")}),e.addEventListener("dragleave",()=>{e.classList.remove("border-t-2","border-primary-500")}),e.addEventListener("drop",async t=>{if(console.log(a,"drop",n,"targetIdx:",i().indexOf(e)),t.preventDefault(),e.classList.remove("border-t-2","border-primary-500"),!r||r===e)return;let I=i().indexOf(e);if(p===I)return;o&&c.insertBefore(o,e),c.insertBefore(r,o||e);let R=i().map((s,D)=>({id:s.getAttribute("data-reorder-id"),displayOrder:D})).filter(s=>s.id);try{await v(R)}catch(s){console.error("Reorder failed:",s)}r=null,o=null})})}),b}var u=0,C=20;function f(){console.log(a,"run() called, readyState:",document.readyState,"retryCount:",u),!T()&&u<C&&(u++,console.log(a,"retrying in 50ms, retryCount:",u),requestAnimationFrame(()=>setTimeout(f,50)))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();document.addEventListener("astro:page-load",f);})();
