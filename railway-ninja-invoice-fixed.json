{
  "name": "ninja-invoice-production",
  "services": [
    {
      "name": "ninja-invoice-app",
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "composer install --optimize-autoloader --no-scripts --no-interaction --ignore-platform-req=ext-zip --ignore-platform-req=ext-bcmath --ignore-platform-req=ext-gd"
      },
      "environment": {
        "APP_ENV": "production",
        "APP_DEBUG": "false",
        "APP_URL": "${{RAILWAY_PUBLIC_DOMAIN}}",
        "DB_CONNECTION": "mysql",
        "DB_HOST": "${{MYSQL_HOST}}",
        "DB_PORT": "${{MYSQL_PORT}}",
        "DB_DATABASE": "${{MYSQL_DATABASE}}",
        "DB_USERNAME": "${{MYSQL_USER}}",
        "DB_PASSWORD": "${{MYSQL_PASSWORD}}",
        "CACHE_DRIVER": "redis",
        "SESSION_DRIVER": "redis",
        "QUEUE_CONNECTION": "redis",
        "REDIS_HOST": "${{REDIS_HOST}}",
        "REDIS_PORT": "${{REDIS_PORT}}",
        "REDIS_PASSWORD": "${{REDIS_PASSWORD}}",
        "MAIL_MAILER": "smtp",
        "MAIL_HOST": "${{SMTP_HOST}}",
        "MAIL_PORT": "${{SMTP_PORT}}",
        "MAIL_USERNAME": "${{SMTP_USERNAME}}",
        "MAIL_PASSWORD": "${{SMTP_PASSWORD}}",
        "MAIL_FROM_ADDRESS": "${{MAIL_FROM_ADDRESS}}",
        "MAIL_FROM_NAME": "Ninja Invoice",
        "PHP_EXTENSIONS": "zip,bcmath,gd,mbstring,pdo_mysql,redis"
      },
      "deploy": {
        "startCommand": "php artisan serve --host=0.0.0.0 --port=$PORT"
      }
    },
    {
      "name": "ninja-invoice-mysql",
      "image": "mysql:8.0",
      "environment": {
        "MYSQL_ROOT_PASSWORD": "${{MYSQL_ROOT_PASSWORD}}",
        "MYSQL_DATABASE": "${{MYSQL_DATABASE}}",
        "MYSQL_USER": "${{MYSQL_USER}}",
        "MYSQL_PASSWORD": "${{MYSQL_PASSWORD}}"
      },
      "volumes": [
        {
          "name": "mysql_data",
          "mountPath": "/var/lib/mysql"
        }
      ]
    },
    {
      "name": "ninja-invoice-redis",
      "image": "redis:7-alpine",
      "volumes": [
        {
          "name": "redis_data",
          "mountPath": "/data"
        }
      ]
    }
  ],
  "volumes": [
    {
      "name": "mysql_data"
    },
    {
      "name": "redis_data"
    }
  ]
}
