{
  "name": "capco-plausible-analytics",
  "services": [
    {
      "name": "plausible-db",
      "image": "postgres:15-alpine",
      "environment": {
        "POSTGRES_PASSWORD": "${{PLAUSIBLE_DB_PASSWORD}}",
        "POSTGRES_USER": "plausible",
        "POSTGRES_DB": "plausible"
      }
    },
    {
      "name": "plausible-events-db", 
      "image": "clickhouse/clickhouse-server:23.8-alpine"
    },
    {
      "name": "plausible",
      "image": "plausible/analytics:latest",
      "ports": ["8000"],
      "environment": {
        "BASE_URL": "${{RAILWAY_PUBLIC_DOMAIN}}",
        "SECRET_KEY_BASE": "${{PLAUSIBLE_SECRET_KEY}}",
        "DATABASE_URL": "postgres://plausible:${{PLAUSIBLE_DB_PASSWORD}}@plausible-db:5432/plausible",
        "CLICKHOUSE_DATABASE_URL": "http://plausible-events-db:8123/plausible_events_db",
        "MAILER_EMAIL": "${{PLAUSIBLE_MAILER_EMAIL}}",
        "SMTP_HOST_ADDR": "smtp.resend.com",
        "SMTP_HOST_PORT": "587",
        "SMTP_HOST_SSL_ENABLED": "false",
        "SMTP_USER_NAME": "resend",
        "SMTP_USER_PASSWORD": "${{RESEND_API_KEY}}",
        "SMTP_MX_LOOKUPS": "false",
        "SMTP_RETRIES": "2",
        "SMTP_VERIFY": "false",
        "DISABLE_REGISTRATION": "true",
        "ENABLE_EMAIL_VERIFICATION": "false",
        "DISABLE_SUBSCRIPTIONS": "true",
        "ADMIN_USER_EMAIL": "${{PLAUSIBLE_ADMIN_EMAIL}}",
        "ADMIN_USER_NAME": "CAPCo Admin",
        "ADMIN_USER_PWD": "${{PLAUSIBLE_ADMIN_PASSWORD}}"
      }
    }
  ]
}